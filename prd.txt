
[full coupon code ìƒì„± ê·œì¹™]

** ì¿ í° ì½”ë“œëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
    `{ë°œê¸‰ì_ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸}-{ì‚¬ìš©ê°€ëŠ¥ìš”ì¼}-{coupon_id(10ìë¦¬_ì œë¡œíŒ¨ë”©)}-{ê²°ì œ_ìœ í˜•_ì½”ë“œ}-{íŒ¨ë¦¬í‹°}`
    *   **ë°œê¸‰ì ë“±ë¡ë²ˆí˜¸**: `settings.json`ì—ì„œ ë¡œë“œí•¨.
    *   **ì‚¬ìš©ê°€ëŠ¥ì¼**: 0ê³¼ 1ë¡œëœ 7ìë¦¬ìˆ˜, ì‚¬ìš©ê°€ëŠ¥í•œ ìš”ì¼ì€ 1, ë¶ˆê°€ëŠ¥í•œ ìš”ì¼ì€ 0, ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí†  ìˆœìœ¼ë¡œ.
    *   **ì¿ í° ë²ˆí˜¸**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒëœ ì¿ í° ë²ˆí˜¸ë¥¼ 10ìë¦¬ë¡œ ì œë¡œ íŒ¨ë”©í•©ë‹ˆë‹¤.
    *   **ê²°ì œ ìœ í˜• ì½”ë“œ**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒëœ `payment_type`ì´ 'prepaid'ì´ë©´ '1', ê·¸ ì™¸ì—ëŠ” '2'ì…ë‹ˆë‹¤.
    *   **íŒ¨ë¦¬í‹°**: ëœë¤ ë„˜ë²„ë¡œ 3ìë¦¬ìˆ˜


ê¸°ì—…ì²´ ì§ì›ì—ê²Œ ì¿ í°ì„ ë°œí–‰í•˜ê³ , ê¸ˆì•¡ì„ ì¶©ì „í•˜ë©°, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ì°¨ê°í•˜ëŠ” ì‹œìŠ¤í…œì„ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆëŠ” í¬ê²Œ ì§ì› ì •ë³´, ì¿ í° ì •ë³´, ê·¸ë¦¬ê³  ì‚¬ìš© ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” ì„¸ ê°œì˜ í…Œì´ë¸”ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Employees í…Œì´ë¸”: ì§ì›ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

employee_id (PK): ì§ì›ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ID, ì‚¬ë²ˆ ë˜ëŠ” ëª¨ë°”ì¼ ì „í™”ë²ˆí˜¸

corporate_id(FK): ì§ì›ì´ ì†Œì†ëœ ê±°ë˜ì²˜ ê¸°ì—… ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ (ê±°ë˜ì²˜ ì‚¬ì—…ìë²ˆí˜¸ë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.)

name: ì§ì›ì˜ ì´ë¦„.

phone: í•¸ë“œí° ë²ˆí˜¸

email: ì£¼ì†Œ

department: ì§ì›ì˜ ë¶€ì„œ.


Coupons í…Œì´ë¸”: ë°œí–‰ëœ ì¿ í°ê³¼ ì”ì•¡ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

coupon_id (PK): ì¿ í°ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ID. auto_incrementalë¡œ 10ìë¦¬ ì œë¡œíŒ¨ë”©

full_coupon_code: 
    full coupon code ìƒì„± ê·œì¹™

    ** ì¿ í° ì½”ë“œëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
        `{ë°œê¸‰ì_ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸}-{ì‚¬ìš©ê°€ëŠ¥ìš”ì¼}-{coupon_id(10ìë¦¬_ì œë¡œíŒ¨ë”©)}-{ê²°ì œ_ìœ í˜•_ì½”ë“œ}-{íŒ¨ë¦¬í‹°}`
        *   **ë°œê¸‰ì ë“±ë¡ë²ˆí˜¸**: `settings.json`ì—ì„œ ë¡œë“œí•¨.
        *   **ì‚¬ìš©ê°€ëŠ¥ì¼**: 0ê³¼ 1ë¡œëœ 7ìë¦¬ìˆ˜, ì‚¬ìš©ê°€ëŠ¥í•œ ìš”ì¼ì€ 1, ë¶ˆê°€ëŠ¥í•œ ìš”ì¼ì€ 0, ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí†  ìˆœìœ¼ë¡œ.
        *   **ì¿ í° ë²ˆí˜¸**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒëœ ì¿ í° ë²ˆí˜¸ë¥¼ 10ìë¦¬ë¡œ ì œë¡œ íŒ¨ë”©í•©ë‹ˆë‹¤.
        *   **ê²°ì œ ìœ í˜• ì½”ë“œ**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒëœ `payment_type`ì´ 'prepaid'ì´ë©´ '1', ê·¸ ì™¸ì—ëŠ” '2'ì…ë‹ˆë‹¤.
        *   **íŒ¨ë¦¬í‹°**: ëœë¤ ë„˜ë²„ë¡œ 3ìë¦¬ìˆ˜

employee_id (FK): ì¿ í°ì´ ì†í•œ ì§ì›ì„ ë‚˜íƒ€ë‚´ëŠ” ID.

cash_balance: í˜„ì¬ ì¿ í°ì— ë‚¨ì•„ìˆëŠ” ì”ì•¡.

point_balance: í˜„ì¬ ì¿ í°ì— ë‚¨ì•„ìˆëŠ” ì”ì•¡.

expire_date: ì¿ í°ì˜ ë§Œê¸°ì¼ì.

status: ì¿ í°ì˜ ìƒíƒœ (ì˜ˆ: 'ì‚¬ìš© ê°€ëŠ¥', 'ë§Œë£Œë¨').



Transactions í…Œì´ë¸”: ì¿ í°ì˜ ì¶©ì „ ë° ì‚¬ìš© ë‚´ì—­ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

transaction_id (PK): ê±°ë˜ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ID.

coupon_id (FK): ê±°ë˜ê°€ ë°œìƒí•œ ì¿ í° ID.

amount: ê±°ë˜ ê¸ˆì•¡ (ì¶©ì „ ì‹œ ì–‘ìˆ˜, ì‚¬ìš© ì‹œ ìŒìˆ˜).

transaction_type: ê±°ë˜ ìœ í˜• (ì˜ˆ: 'ì¶©ì „', 'ì‚¬ìš©').

transaction_date: ê±°ë˜ê°€ ë°œìƒí•œ ë‚ ì§œì™€ ì‹œê°„.






 1. coupon_deliveries (ì¿ í° ë°œì†¡ ê¸°ë¡ í…Œì´ë¸”)      

  CREATE TABLE coupon_deliveries (
      delivery_id INTEGER PRIMARY KEY AUTOINCREMENT,
      coupon_id INTEGER NOT NULL,
      delivery_type VARCHAR(20) NOT NULL, -- 'EMAIL', 'SMS', 'KAKAO'
      delivery_status VARCHAR(20) NOT NULL DEFAULT 'PENDING', -- 'PENDING', 'SENT', 'DELIVERED', 'FAILED', 'BOUNCED'       
      recipient_address TEXT NOT NULL, -- ì´ë©”ì¼ ì£¼ì†Œ, ì „í™”ë²ˆí˜¸ ë“±
      sent_at DATETIME NULL,
      delivered_at DATETIME NULL,
      failed_at DATETIME NULL,
      retry_count INTEGER DEFAULT 0,
      last_retry_at DATETIME NULL,
      error_message TEXT NULL,
      sbj TEXT NULL, -- message subject      
      msg TEXT NULL, -- message
      metadata TEXT NULL, -- JSON í˜•íƒœì˜ ì¶”ê°€ ì •ë³´
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (coupon_id) REFERENCES coupons(coupon_id),
  );

  2. delivery_templates (ë°œì†¡ í…œí”Œë¦¿ í…Œì´ë¸”)

  CREATE TABLE delivery_templates (
      template_id INTEGER PRIMARY KEY AUTOINCREMENT,
      template_name VARCHAR(100) NOT NULL,
      template_type VARCHAR(20) NOT NULL, -- 'EMAIL', 'SMS', 'KAKAO'
      subject VARCHAR(100) NULL, -- ì´ë©”ì¼ ì œëª© (ì´ë©”ì¼ìš©)
      content TEXT NOT NULL,
      is_default BOOLEAN DEFAULT 0,
      is_active BOOLEAN DEFAULT 1,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );


  3. delivery_campaigns (ë°œì†¡ ìº í˜ì¸ í…Œì´ë¸”)

  CREATE TABLE delivery_campaigns (
      campaign_id INTEGER PRIMARY KEY AUTOINCREMENT,
      campaign_name VARCHAR(100) NOT NULL,
      corporate_id INTEGER NOT NULL,
      campaign_type VARCHAR(20) NOT NULL, -- 'BULK', 'INDIVIDUAL', 'SCHEDULED'
      delivery_types TEXT NOT NULL, -- JSON ë°°ì—´: ["EMAIL", "SMS", "KAKAO"]
      target_count INTEGER DEFAULT 0,
      sent_count INTEGER DEFAULT 0,
      delivered_count INTEGER DEFAULT 0,
      failed_count INTEGER DEFAULT 0,
      campaign_status VARCHAR(20) NOT NULL DEFAULT 'DRAFT', -- 'DRAFT', 'RUNNING', 'COMPLETED', 'CANCELLED', 'PAUSED'      
      scheduled_at DATETIME NULL,
      started_at DATETIME NULL,
      completed_at DATETIME NULL,
      created_by VARCHAR(50) NOT NULL,
      email_template_id INTEGER NULL,
      sms_template_id INTEGER NULL,
      kakao_template_id INTEGER NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (corporate_id) REFERENCES corporates(customer_id),
      FOREIGN KEY (email_template_id) REFERENCES delivery_templates(template_id),
      FOREIGN KEY (sms_template_id) REFERENCES delivery_templates(template_id),
      FOREIGN KEY (kakao_template_id) REFERENCES delivery_templates(template_id)
  );

  3. delivery_templates (ë°œì†¡ í…œí”Œë¦¿ í…Œì´ë¸”)

  CREATE TABLE delivery_templates (
      template_id INTEGER PRIMARY KEY AUTOINCREMENT,
      template_name VARCHAR(100) NOT NULL,
      template_type VARCHAR(20) NOT NULL, -- 'EMAIL', 'SMS', 'KAKAO'
      subject VARCHAR(100) NULL, -- ì´ë©”ì¼ ì œëª© (ì´ë©”ì¼ìš©)
      content TEXT NOT NULL,
      is_default BOOLEAN DEFAULT 0,
      is_active BOOLEAN DEFAULT 1,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );

  4. delivery_schedules (ë°œì†¡ ìŠ¤ì¼€ì¤„ í…Œì´ë¸”)

  CREATE TABLE delivery_schedules (
      schedule_id INTEGER PRIMARY KEY AUTOINCREMENT,
      campaign_id INTEGER NOT NULL,
      coupon_id INTEGER NOT NULL,
      employee_id INTEGER NOT NULL,
      delivery_type VARCHAR(20) NOT NULL,
      scheduled_at DATETIME NOT NULL,
      priority INTEGER DEFAULT 5, -- 1(ìµœê³ ) ~ 10(ìµœì €)
      schedule_status VARCHAR(20) NOT NULL DEFAULT 'SCHEDULED', -- 'SCHEDULED', 'PROCESSING', 'COMPLETED', 'CANCELLED'     
      processed_at DATETIME NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (campaign_id) REFERENCES delivery_campaigns(campaign_id),
      FOREIGN KEY (coupon_id) REFERENCES coupons(coupon_id),
      FOREIGN KEY (employee_id) REFERENCES employees(employee_id)
  );

  5. delivery_settings (ë°œì†¡ ì„¤ì • í…Œì´ë¸”)

  CREATE TABLE delivery_settings (
      setting_id INTEGER PRIMARY KEY AUTOINCREMENT,
      setting_category VARCHAR(50) NOT NULL, -- 'EMAIL', 'SMS', 'KAKAO', 'GENERAL'
      setting_key VARCHAR(100) NOT NULL,
      setting_value TEXT NOT NULL,
      setting_type VARCHAR(20) NOT NULL DEFAULT 'STRING', -- 'STRING', 'INTEGER', 'BOOLEAN', 'JSON'
      description TEXT NULL,
      is_encrypted BOOLEAN DEFAULT 0, -- ë¹„ë°€ë²ˆí˜¸ ë“± ë¯¼ê° ì •ë³´
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      UNIQUE(setting_category, setting_key)
  );

  6. delivery_blacklist (ë°œì†¡ ì°¨ë‹¨ ëª©ë¡ í…Œì´ë¸”)

  CREATE TABLE delivery_blacklist (
      blacklist_id INTEGER PRIMARY KEY AUTOINCREMENT,
      contact_type VARCHAR(20) NOT NULL, -- 'EMAIL', 'PHONE'
      contact_value VARCHAR(200) NOT NULL,
      blacklist_reason VARCHAR(200) NULL,
      blacklisted_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      blacklisted_by VARCHAR(50) NOT NULL,
      is_active BOOLEAN DEFAULT 1,
      UNIQUE(contact_type, contact_value)
  );

  7. delivery_statistics (ë°œì†¡ í†µê³„ í…Œì´ë¸”)

  CREATE TABLE delivery_statistics (
      stat_id INTEGER PRIMARY KEY AUTOINCREMENT,
      corporate_id INTEGER NULL,
      campaign_id INTEGER NULL,
      stat_date DATE NOT NULL,
      delivery_type VARCHAR(20) NOT NULL,
      total_sent INTEGER DEFAULT 0,
      total_delivered INTEGER DEFAULT 0,
      total_failed INTEGER DEFAULT 0,
      total_bounced INTEGER DEFAULT 0,
      total_opened INTEGER DEFAULT 0, -- ì´ë©”ì¼ ì—´ëŒ
      total_clicked INTEGER DEFAULT 0, -- ë§í¬ í´ë¦­
      delivery_rate DECIMAL(5,2) DEFAULT 0.00, -- ë°°ì†¡ ì„±ê³µë¥ 
      open_rate DECIMAL(5,2) DEFAULT 0.00, -- ì—´ëŒë¥ 
      click_rate DECIMAL(5,2) DEFAULT 0.00, -- í´ë¦­ë¥ 
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (corporate_id) REFERENCES corporates(customer_id),
      FOREIGN KEY (campaign_id) REFERENCES delivery_campaigns(campaign_id),
      UNIQUE(corporate_id, campaign_id, stat_date, delivery_type)
  );

  ğŸ“‹ ì¸ë±ìŠ¤ ì œì•ˆ

  -- ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤
  CREATE INDEX idx_coupon_deliveries_coupon_id ON coupon_deliveries(coupon_id);
  CREATE INDEX idx_coupon_deliveries_employee_id ON coupon_deliveries(employee_id);
  CREATE INDEX idx_coupon_deliveries_status ON coupon_deliveries(delivery_status);
  CREATE INDEX idx_coupon_deliveries_type ON coupon_deliveries(delivery_type);
  CREATE INDEX idx_coupon_deliveries_sent_at ON coupon_deliveries(sent_at);

  CREATE INDEX idx_delivery_campaigns_corporate_id ON delivery_campaigns(corporate_id);
  CREATE INDEX idx_delivery_campaigns_status ON delivery_campaigns(campaign_status);
  CREATE INDEX idx_delivery_campaigns_scheduled_at ON delivery_campaigns(scheduled_at);

  CREATE INDEX idx_delivery_schedules_scheduled_at ON delivery_schedules(scheduled_at);
  CREATE INDEX idx_delivery_schedules_status ON delivery_schedules(schedule_status);
  CREATE INDEX idx_delivery_schedules_priority ON delivery_schedules(priority);

  CREATE INDEX idx_delivery_statistics_date ON delivery_statistics(stat_date);
  CREATE INDEX idx_delivery_statistics_corporate ON delivery_statistics(corporate_id, stat_date);

  ğŸ”„ ê¸°ì¡´ í…Œì´ë¸”ê³¼ì˜ ê´€ê³„

  - coupons í…Œì´ë¸”: coupon_idë¡œ ì—°ê²°
  - employees í…Œì´ë¸”: employee_idë¡œ ì—°ê²°
  - corporates í…Œì´ë¸”: customer_idë¡œ ì—°ê²°

  ğŸ’¡ ì£¼ìš” íŠ¹ì§•

  1. ë°œì†¡ ìƒíƒœ ì¶”ì : ê° ë°œì†¡ ì±„ë„ë³„ ìƒì„¸í•œ ìƒíƒœ ê´€ë¦¬
  2. ìº í˜ì¸ ê´€ë¦¬: ëŒ€ëŸ‰ ë°œì†¡ì„ ìœ„í•œ ìº í˜ì¸ ë‹¨ìœ„ ê´€ë¦¬
  3. í…œí”Œë¦¿ ì‹œìŠ¤í…œ: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë°œì†¡ í…œí”Œë¦¿
  4. ìŠ¤ì¼€ì¤„ë§: ì˜ˆì•½ ë°œì†¡ ê¸°ëŠ¥
  5. í†µê³„ ë° ë¶„ì„: ë°œì†¡ ì„±ê³¼ ë¶„ì„
  6. ì°¨ë‹¨ ëª©ë¡: ìŠ¤íŒ¸ ë°©ì§€ ë° ì˜µíŠ¸ì•„ì›ƒ ê´€ë¦¬
  7. ì„¤ì • ê´€ë¦¬: ê° ë°œì†¡ ì±„ë„ë³„ ì„¤ì • ì €ì¥


