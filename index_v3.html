<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŸï¸ ì¿ í° ë§¤ë‹ˆì € ì‹œìŠ¤í…œ ê´€ë¦¬ V3</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŸï¸</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
        }

        /* Header with Navigation */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            color: #333;
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Navigation Dropdown */
        .nav-dropdown {
            position: relative;
            display: inline-block;
        }

        .nav-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .nav-button::after {
            content: 'â–¼';
            font-size: 12px;
            transition: transform 0.3s;
        }

        .nav-button.active::after {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            min-width: 280px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            z-index: 1001;
            margin-top: 8px;
            overflow: hidden;
        }

        .dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            display: block;
            color: #333;
            padding: 16px 20px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9ff;
            color: #667eea;
            padding-left: 24px;
        }

        .dropdown-item .icon {
            margin-right: 10px;
            font-size: 16px;
            width: 20px;
            display: inline-block;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* WebSocket Status Card */
        .websocket-status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-left: 4px solid #667eea;
        }

        /* Server Status Card */
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Content Area */
        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: #333;
            font-size: 1.8em;
            font-weight: 700;
        }

        .section-header .icon {
            font-size: 1.5em;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .form-row-4 {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        input[type="time"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Button Styles */
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #48bb78;
        }

        .btn-success:hover {
            background: #38a169;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: #f56565;
        }

        .btn-danger:hover {
            background: #e53e3e;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4a5568;
            box-shadow: 0 4px 12px rgba(113, 128, 150, 0.3);
        }

        .btn-warning {
            background: #ed8936;
        }

        .btn-warning:hover {
            background: #dd6b20;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-online {
            background: #f0fff4;
            color: #2f855a;
            border: 1px solid #9ae6b4;
        }

        .status-offline {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .status-connecting {
            background: #fefcbf;
            color: #b7791f;
            border: 1px solid #f6e05e;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Connection Information Display */
        .connection-info {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 20px;
            }
            
            .logo h1 {
                font-size: 1.4em;
            }

            .main-container {
                padding: 20px 15px;
            }

            .content-area {
                padding: 20px;
            }

            .section-header h2 {
                font-size: 1.4em;
            }
        }

        /* Message Log Styles */
        .message-log {
            background: #2d3748;
            color: #68d391;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            border: 1px solid #4a5568;
        }

        .message-log .timestamp {
            color: #9ca3af;
        }

        .message-log .info {
            color: #60a5fa;
        }

        .message-log .success {
            color: #34d399;
        }

        .message-log .error {
            color: #f87171;
        }

        .message-log .warning {
            color: #fbbf24;
        }

        /* Tab Button Styles */
        .management-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
        }

        .tab-button {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-bottom: 3px solid #e0e0e0;
            color: #666;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }

        .tab-button:hover {
            background: #f0f0f0;
            color: #333;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            font-weight: 700;
        }

        .management-tab-content {
            display: none;
        }

        .management-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Card Styles */
        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h4 {
            color: #555;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9ff;
        }

        /* Management Info Tabs */
        .management-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 0;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .management-tab-content {
            margin-top: 20px;
        }

        .stat-item {
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        /* Settings specific styles */
        .setting-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            transform: scale(1.2);
        }

        /* Developer Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #666;
        }

        .modal-body {
            padding: 20px 25px 25px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <span style="font-size: 1.5em;">ğŸŸï¸</span>
                <h1>ì¿ í° ë§¤ë‹ˆì € ì‹œìŠ¤í…œ ê´€ë¦¬ V3</h1>
            </div>
            
            <div class="nav-dropdown">
                <button class="nav-button" onclick="toggleDropdown()">
                    <span>ğŸ“‹ ë©”ë‰´</span>
                </button>
                <div class="dropdown-content" id="navDropdown">
                    <a class="dropdown-item" onclick="showSection('welcome')">
                        <span class="icon">ğŸ </span>í™ˆ
                    </a>
                    <a class="dropdown-item" onclick="showSection('connection')">
                        <span class="icon">ğŸ”—</span>ì—°ê²° ì„¤ì •
                    </a>
                    <a class="dropdown-item" onclick="showSection('corporate')" id="corporateMenu" style="display: none;">
                        <span class="icon">ğŸ¢</span>ê±°ë˜ì²˜ ê´€ë¦¬
                    </a>
                    <a class="dropdown-item" onclick="showSection('employee')" id="employeeMenu" style="display: none;">
                        <span class="icon">ğŸ‘¤</span>ì§ì› ê´€ë¦¬
                    </a>
                    <a class="dropdown-item" onclick="showSection('coupon')" id="couponMenu" style="display: none;">
                        <span class="icon">ğŸŸï¸</span>ì¿ í° ë°œí–‰
                    </a>
                    <a class="dropdown-item" onclick="showSection('couponManagement')" id="couponManagementMenu" style="display: none;">
                        <span class="icon">ğŸ“‹</span>ì¿ í° ê´€ë¦¬
                    </a>
                    <a class="dropdown-item" onclick="showSection('send')" id="sendMenu" style="display: none;">
                        <span class="icon">ğŸ“¤</span>ì¿ í° ë°œì†¡
                    </a>
                    <a class="dropdown-item" onclick="showSection('deliveryHistory')" id="deliveryHistoryMenu" style="display: none;">
                        <span class="icon">ğŸ“‹</span>ë°œì†¡ ê¸°ë¡
                    </a>
                    <a class="dropdown-item" onclick="showSection('emailConfig')" id="emailConfigMenu" style="display: none;">
                        <span class="icon">ğŸ“§</span>ì´ë©”ì¼ ì„¤ì •
                    </a>
                    <a class="dropdown-item" onclick="showSection('smsConfig')" id="smsConfigMenu" style="display: none;">
                        <span class="icon">ğŸ“±</span>SMS ì„¤ì •
                    </a>
                    <a class="dropdown-item" onclick="showSection('systemSettings')" id="systemSettingsMenu" style="display: none;">
                        <span class="icon">ğŸ’°</span>ê°€ê²© ì„¤ì •
                    </a>
                    <a class="dropdown-item" onclick="showSection('managementInfo')" id="managementInfoMenu" style="display: none;">
                        <span class="icon">ğŸ“Š</span>ê²½ì˜ì •ë³´
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- WebSocket Broker Status Card -->
        <div class="websocket-status-card">
            <h3 style="margin-bottom: 15px; color: #667eea;">ğŸŒ WebSocket ë¸Œë¡œì»¤ ì—°ê²° ìƒíƒœ</h3>
            <div class="status-grid">
                <div>
                    <div id="brokerConnectionStatus">
                        <div class="status-indicator status-offline">ğŸ”´ ë¸Œë¡œì»¤ ë¯¸ì—°ê²°</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>ë¸Œë¡œì»¤: <span id="connectedBrokerUrl">-</span></small><br>
                        <small>ì„œë²„ëª…: <span id="connectedServerName">-</span></small>
                    </div>
                </div>
                <div>
                    <div id="androidServerStatus">
                        <div class="status-indicator status-offline">ğŸ”´ Android ì„œë²„ ë¯¸ì—°ê²°</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>ì•ˆë“œë¡œì´ë“œ ì„œë²„: <span id="connectedAndroidServer">-</span></small><br>
                        <small>API ìƒíƒœ: <span id="androidApiStatus">-</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Welcome Section -->
            <div id="welcomeSection" class="content-section active">
                <div class="section-header">
                    <span class="icon">ğŸŸï¸</span>
                    <h2>ì¿ í° ë§¤ë‹ˆì € ì‹œìŠ¤í…œ V3ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h2>
                </div>
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="background: #e6f3ff; padding: 20px; border-radius: 12px; border-left: 4px solid #4299e1; margin-bottom: 40px;">
                        <h3 style="color: #2c5aa0; margin-bottom: 15px;">ğŸ†• V3 ì£¼ìš” ì—…ë°ì´íŠ¸</h3>
                        <p style="color: #2c5aa0; font-size: 16px; line-height: 1.6;">
                            â€¢ WebSocket ë¸Œë¡œì»¤ë¥¼ í†µí•œ ì•ˆì „í•œ ì—°ê²° êµ¬ì¡°<br>
                            â€¢ ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§<br>
                            â€¢ í–¥ìƒëœ ë³´ì•ˆ ë° ì—°ê²° ì•ˆì •ì„±<br>
                            â€¢ ë©”ì‹œì§€ ë¡œê¹… ë° ë””ë²„ê¹… ê¸°ëŠ¥
                        </p>
                    </div>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 30px;">
                        ì‹œì‘í•˜ë ¤ë©´ ë¨¼ì € <strong>ì—°ê²° ì„¤ì •</strong>ì—ì„œ WebSocket ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto;">
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s;" onclick="showSection('connection')">
                            <h3 style="color: #667eea;">ğŸ”— ì—°ê²° ì„¤ì •</h3>
                            <p style="color: #666; margin-top: 10px;">ë¸Œë¡œì»¤ ì—°ê²° ë° ì„¤ì •</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.')">
                            <h3 style="color: #999;">ğŸ¢ ê±°ë˜ì²˜ ê´€ë¦¬</h3>
                            <p style="color: #999; margin-top: 10px;">ê±°ë˜ì²˜ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.')">
                            <h3 style="color: #999;">ğŸ‘¤ ì§ì› ê´€ë¦¬</h3>
                            <p style="color: #999; margin-top: 10px;">ì§ì› ì •ë³´ ê´€ë¦¬</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.')">
                            <h3 style="color: #999;">ğŸŸï¸ ì¿ í° ë°œí–‰</h3>
                            <p style="color: #999; margin-top: 10px;">ì¿ í° ìƒì„± ë° ë°œí–‰</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connection Settings Section -->
            <div id="connectionSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸ”—</span>
                    <h2>ì—°ê²° ì„¤ì •</h2>
                </div>

                <!-- WebSocket Broker Connection -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ğŸŒ WebSocket ë¸Œë¡œì»¤ ì—°ê²°
                    </h3>
                    
                    <div class="form-row">
                        <div>
                            <label for="brokerUrl">ë¸Œë¡œì»¤ URL</label>
                            <input type="url" id="brokerUrl" value="ws://192.168.20.16:8765" placeholder="ws://192.168.20.16:8765">
                        </div>
                        <div>
                            <label for="clientId">í´ë¼ì´ì–¸íŠ¸ ID</label>
                            <input type="text" id="clientId" value="client001" placeholder="client001">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label for="clientPassword">í´ë¼ì´ì–¸íŠ¸ íŒ¨ìŠ¤ì›Œë“œ</label>
                            <input type="password" id="clientPassword" value="$2b$12$hashedpassword1" placeholder="ë¸Œë¡œì»¤ ì—°ê²° íŒ¨ìŠ¤ì›Œë“œ">
                        </div>
                        <div>
                            <label for="targetServerName">ëŒ€ìƒ ì„œë²„ëª…</label>
                            <input type="text" id="targetServerName" value="main_web_server" placeholder="ì—°ê²°í•  ì›¹ì„œë²„ëª…">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="connectToBroker()" class="btn btn-success" id="connectBrokerBtn">ğŸ”— ë¸Œë¡œì»¤ ì—°ê²°</button>
                        <button onclick="disconnectFromBroker()" class="btn btn-danger" id="disconnectBrokerBtn" disabled>ğŸ”Œ ì—°ê²° í•´ì œ</button>
                        <button onclick="testBrokerConnection()" class="btn btn-warning" id="testBrokerBtn" disabled>ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    </div>
                    
                    <!-- Connection Status -->
                    <div id="brokerConnectionInfo" class="connection-info" style="display: none;">
                        <div><strong>ì—°ê²° ìƒíƒœ:</strong> <span id="brokerStatusText">ì—°ê²° ì¤‘...</span></div>
                        <div><strong>ë¸Œë¡œì»¤ URL:</strong> <span id="brokerUrlText">-</span></div>
                        <div><strong>í´ë¼ì´ì–¸íŠ¸ ID:</strong> <span id="clientIdText">-</span></div>
                        <div><strong>ëŒ€ìƒ ì„œë²„:</strong> <span id="targetServerText">-</span></div>
                    </div>
                </div>

                <!-- Android Server Connection (via Broker) -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ğŸ“± Android ì„œë²„ ì—°ê²° (ë¸Œë¡œì»¤ë¥¼ í†µí•´)
                    </h3>
                    
                    <div class="form-row">
                        <div>
                            <label for="userId">ì‚¬ìš©ì ID</label>
                            <input type="text" id="userId" value="admin" placeholder="Android ì„œë²„ ì‚¬ìš©ì ID">
                        </div>
                        <div>
                            <label for="password">íŒ¨ìŠ¤ì›Œë“œ</label>
                            <input type="password" id="password" value="admin123" placeholder="Android ì„œë²„ íŒ¨ìŠ¤ì›Œë“œ">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="loginToAndroidServer()" class="btn btn-success" id="loginAndroidBtn" disabled>ğŸ” Android ì„œë²„ ë¡œê·¸ì¸</button>
                        <button onclick="logoutFromAndroidServer()" class="btn btn-danger" id="logoutAndroidBtn" disabled>ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                        <button onclick="testAndroidServerConnection()" class="btn" id="testAndroidBtn" disabled style="background: #4299e1; color: white;">ğŸ§ª ì„œë²„ í…ŒìŠ¤íŠ¸</button>
                    </div>
                    
                    <!-- Login Status -->
                    <div id="androidLoginInfo" class="connection-info" style="display: none;">
                        <div><strong>ë¡œê·¸ì¸ ìƒíƒœ:</strong> <span id="androidLoginStatusText">ë¡œê·¸ì¸ ì¤‘...</span></div>
                        <div><strong>ì•¡ì„¸ìŠ¤ í† í°:</strong> <span id="androidTokenText">-</span></div>
                        <div><strong>í† í° ë§Œë£Œ:</strong> <span id="androidTokenExpiryText">-</span></div>
                    </div>
                </div>

                <!-- Message Log -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ğŸ“‹ ì—°ê²° ë¡œê·¸
                        <button onclick="clearMessageLog()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px; margin-left: auto;">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
                    </h3>
                    <div id="messageLog" class="message-log">
                        <div class="info">[ì‹œìŠ¤í…œ] ì—°ê²° ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
                    </div>
                </div>

                <!-- Connection Instructions -->
                <div class="card" style="background: #f0f8ff; border-radius: 12px; padding: 25px; border-left: 4px solid #4299e1;">
                    <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">ğŸ“‹ ì—°ê²° ì ˆì°¨</h4>
                    <ol style="margin: 0; padding-left: 20px; color: #2c5aa0; line-height: 1.6;">
                        <li style="margin: 8px 0;"><strong>1ë‹¨ê³„:</strong> WebSocket ë¸Œë¡œì»¤ URLê³¼ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
                        <li style="margin: 8px 0;"><strong>2ë‹¨ê³„:</strong> 'ë¸Œë¡œì»¤ ì—°ê²°' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”</li>
                        <li style="margin: 8px 0;"><strong>3ë‹¨ê³„:</strong> ë¸Œë¡œì»¤ ì—°ê²°ì´ ì™„ë£Œë˜ë©´ Android ì„œë²„ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
                        <li style="margin: 8px 0;"><strong>4ë‹¨ê³„:</strong> 'Android ì„œë²„ ë¡œê·¸ì¸' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¸ì¦í•˜ì„¸ìš”</li>
                        <li style="margin: 8px 0;"><strong>5ë‹¨ê³„:</strong> ì—°ê²°ì´ ì™„ë£Œë˜ë©´ ìƒë‹¨ ë©”ë‰´ì—ì„œ ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    </ol>
                </div>
            </div>

            <!-- Corporate Management Section -->
            <div id="corporateSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸ¢</span>
                    <h2>ê±°ë˜ì²˜ ê´€ë¦¬</h2>
                </div>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showCreateCorporateForm()">+ ìƒˆ ê±°ë˜ì²˜ ì¶”ê°€</button>
                </div>
                <div class="card">
                    <h3>ğŸ” ê²€ìƒ‰</h3>
                    <div class="form-row">
                        <div>
                            <input type="text" id="searchInput" placeholder="íšŒì‚¬ëª…ìœ¼ë¡œ ê²€ìƒ‰...">
                        </div>
                        <div>
                            <button onclick="searchCorporates()" class="btn">ê²€ìƒ‰</button>
                            <button onclick="loadAllCorporates()" class="btn btn-success">ì „ì²´ ëª©ë¡</button>
                        </div>
                    </div>
                </div>
                <div id="corporateList">
                    <p style="text-align: center; color: #666; padding: 40px;">ë¡œê·¸ì¸ í›„ 'ì „ì²´ ëª©ë¡' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê±°ë˜ì²˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</p>
                </div>
            </div>

            <!-- Employee Management Section -->
            <div id="employeeSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸ‘¤</span>
                    <h2>ì§ì› ê´€ë¦¬</h2>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ì§ì› ê´€ë¦¬</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="corporateSelectForEmployee" style="min-width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                            <button class="btn btn-success" onclick="showCreateEmployeeForm()" id="addEmployeeBtn" disabled>+ ìƒˆ ì§ì› ì¶”ê°€</button>
                            <button class="btn btn-success" onclick="showBulkImportForm()" id="bulkImportBtn" disabled style="background: #38a169;">ğŸ“Š Excel ë¶™ì—¬ë„£ê¸°</button>
                        </div>
                    </div>

                    <!-- ì§ì› ëª©ë¡ -->
                    <div id="employeeList" style="margin-top: 20px;">
                        <p style="text-align: center; color: #666;">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ë©´ ì§ì› ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <div id="couponSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸŸï¸</span>
                    <h2>ì¿ í° ë°œí–‰</h2>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ’° ì¿ í° ë°œí–‰</h3>
                    </div>

                    <!-- ê±°ë˜ì²˜ ì„ íƒ -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="couponCorporateSelect">ë°œí–‰í•  ê±°ë˜ì²˜ ì„ íƒ:</label>
                        <select id="couponCorporateSelect" style="width: 100%; max-width: 400px; padding: 16px; border: 1px solid #ddd; border-radius: 4px;" onchange="loadEmployeesForCoupon()">
                            <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>

                    <!-- ë°œí–‰ ì„¤ì • -->
                    <div id="couponSettingsPanel" style="display: none;">
                        <div class="card" style="background: #f8f9fa; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 20px 0; color: #667eea;">ğŸ’³ ë°œí–‰ ì„¤ì •</h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <!-- ì´ í˜„ê¸ˆ ì¶©ì „ ê¸ˆì•¡ -->
                                <div class="form-group">
                                    <label for="totalCashAmount">ì´ í˜„ê¸ˆ ì¶©ì „ ê¸ˆì•¡:</label>
                                    <input type="text" id="totalCashAmount" placeholder="0" onchange="calculateDistribution()" oninput="formatCurrencyInput(this)" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                    <small style="color: #666;">ì§ì›ë“¤ì—ê²Œ ê· ë“± ë¶„ë°°ë©ë‹ˆë‹¤</small>
                                </div>

                                <!-- í¬ì¸íŠ¸ ì„¤ì • -->
                                <div class="form-group">
                                    <label>í¬ì¸íŠ¸ ì„¤ì •:</label>
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: inline-flex; align-items: center; margin-right: 15px; font-weight: normal;">
                                            <input type="radio" name="pointType" value="percentage" onchange="togglePointInput()" checked>
                                            <span style="margin-left: 5px;">ì •ë¥  (%)</span>
                                        </label>
                                        <label style="display: inline-flex; align-items: center; margin-right: 15px; font-weight: normal;">
                                            <input type="radio" name="pointType" value="fixed" onchange="togglePointInput()">
                                            <span style="margin-left: 5px;">ì •ì•¡ (ì¿ í°ë‹¹)</span>
                                        </label>
                                        <label style="display: inline-flex; align-items: center; font-weight: normal;">
                                            <input type="radio" name="pointType" value="total" onchange="togglePointInput()">
                                            <span style="margin-left: 5px;">ì´ í¬ì¸íŠ¸ (ê· ë“±ë°°ë¶„)</span>
                                        </label>
                                    </div>
                                    <input type="text" id="pointValue" placeholder="0" value="0" onchange="calculateDistribution()" oninput="formatPointInput(this)" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                    <small id="pointDescription" style="color: #666;">í˜„ê¸ˆ ì¶©ì „ì•¡ì˜ % ë§Œí¼ í¬ì¸íŠ¸ ì§€ê¸‰</small>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <!-- ë§Œë£Œì¼ ì„¤ì • -->
                                <div class="form-group">
                                    <label for="expireDate">ì¿ í° ë§Œë£Œì¼:</label>
                                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px; flex-wrap: wrap;">
                                        <button type="button" onclick="setExpireDate(1)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #4299e1; color: white;">1ê°œì›”</button>
                                        <button type="button" onclick="setExpireDate(3)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #48bb78; color: white;">3ê°œì›”</button>
                                        <button type="button" onclick="setExpireDate(6)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #ed8936; color: white;">6ê°œì›”</button>
                                        <span style="color: #666; font-size: 12px; margin-left: 5px;">ë˜ëŠ” ì§ì ‘ ì„ íƒ:</span>
                                    </div>
                                    <input type="date" id="expireDate" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                </div>

                                <!-- ì‚¬ìš© ê°€ëŠ¥ ìš”ì¼ -->
                                <div class="form-group">
                                    <label>ì‚¬ìš© ê°€ëŠ¥ ìš”ì¼:</label>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        <label style="font-weight: normal;"><input type="checkbox" value="sun" class="available-day"> ì¼</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="mon" class="available-day" checked> ì›”</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="tue" class="available-day" checked> í™”</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="wed" class="available-day" checked> ìˆ˜</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="thu" class="available-day" checked> ëª©</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="fri" class="available-day" checked> ê¸ˆ</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="sat" class="available-day"> í† </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì§ì› ëª©ë¡ ë° ë°°ë¶„ í˜„í™© -->
                        <div id="employeeDistributionPanel" style="display: none;">
                            <h4 style="margin: 0 0 15px 0; color: #667eea;">ğŸ‘¥ ì§ì›ë³„ ì¿ í° ë°°ë¶„ í˜„í™©</h4>
                            
                            <!-- ìš”ì•½ ì •ë³´ -->
                            <div id="distributionSummary" class="card" style="background: #e6f3ff; border-left: 4px solid #4299e1; margin-bottom: 20px;">
                            </div>

                            <!-- ì§ì› ëª©ë¡ í…Œì´ë¸” -->
                            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                                <table id="employeeDistributionTable" style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: #f8f9fa; position: sticky; top: 0;">
                                        <tr>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ì´ë¦„</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ì „í™”ë²ˆí˜¸</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ì´ë©”ì¼</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">í˜„ê¸ˆì¶©ì „ê¸ˆì•¡</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">í¬ì¸íŠ¸ì¶©ì „ê¸ˆì•¡</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeeDistributionBody">
                                    </tbody>
                                </table>
                            </div>

                            <!-- ë°œí–‰ ë²„íŠ¼ -->
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="issueCoupons()" class="btn btn-success" id="issueCouponsBtn" disabled style="padding: 15px 40px; font-size: 16px; font-weight: bold;">
                                    ğŸ« ì¿ í° ì¼ê´„ ë°œí–‰
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ì¿ í° ë°œí–‰ ì•ˆë‚´ -->
                    <div id="couponInstructions" class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1;">
                        <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">ğŸ“‹ ì¿ í° ë°œí–‰ ë°©ë²•</h4>
                        <ol style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                            <li style="margin: 8px 0;">ë°œí–‰í•  ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                            <li style="margin: 8px 0;">ì´ ì¶©ì „ ê¸ˆì•¡ê³¼ í¬ì¸íŠ¸ ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”</li>
                            <li style="margin: 8px 0;">ì¿ í° ë§Œë£Œì¼ê³¼ ì‚¬ìš©ê°€ëŠ¥ ìš”ì¼ì„ ì„¤ì •í•˜ì„¸ìš”</li>
                            <li style="margin: 8px 0;">ì§ì›ë³„ ë°°ë¶„ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</li>
                            <li style="margin: 8px 0;">'ì¿ í° ì¼ê´„ ë°œí–‰' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì™„ë£Œí•˜ì„¸ìš”</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Coupon Management Section -->
            <div id="couponManagementSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸ“‹</span>
                    <h2>ì¿ í° ê´€ë¦¬</h2>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ« ë°œí–‰ëœ ì¿ í° ê´€ë¦¬</h3>
                        <button onclick="loadAllCoupons()" class="btn btn-success">ğŸ”„ ì „ì²´ ëª©ë¡</button>
                    </div>

                    <!-- ê²€ìƒ‰ ë° í•„í„° -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px;">
                            <div>
                                <label for="couponSearchType">ê²€ìƒ‰ ìœ í˜•:</label>
                                <select id="couponSearchType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="couponCode">ì¿ í°ë²ˆí˜¸</option>
                                    <option value="corporateName">ê±°ë˜ì²˜ëª…</option>
                                    <option value="employeeName">ì§ì›ëª…</option>
                                    <option value="employeePhone">ì „í™”ë²ˆí˜¸</option>
                                </select>
                            </div>
                            <div>
                                <label for="couponSearchValue">ê²€ìƒ‰ì–´:</label>
                                <input type="text" id="couponSearchValue" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label for="couponStatusFilter">ìƒíƒœ í•„í„°:</label>
                                <select id="couponStatusFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">ì „ì²´</option>
                                    <option value="ACTIVE">ì‚¬ìš© ê°€ëŠ¥</option>
                                    <option value="SUSPENDED">ì¼ì‹œ ì¤‘ì§€</option>
                                    <option value="TERMINATED">í•´ì§€ë¨</option>
                                </select>
                            </div>
                            <button onclick="searchCoupons()" class="btn" style="background: #48bb78; color: white;">ğŸ” ê²€ìƒ‰</button>
                        </div>
                    </div>

                    <!-- ì„ íƒëœ ì¿ í° ì¼ê´„ ì‘ì—… -->
                    <div id="bulkActions" style="background: #fff8dc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f6ad55; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ì„ íƒëœ ì¿ í°:</strong> <span id="selectedCount">0</span>ê°œ
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="showBulkStatusModal()" class="btn" style="background: #4299e1; color: white;">ğŸ”„ ì¼ê´„ ìƒíƒœ ë³€ê²½</button>
                                <button onclick="showBulkDeleteModal()" class="btn btn-danger">ğŸ—‘ï¸ ì¼ê´„ ì‚­ì œ</button>
                                <button onclick="exportSelectedToExcel()" class="btn" style="background: #52c41a; color: white;">ğŸ“¥ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
                            </div>
                        </div>
                    </div>

                    <!-- ì¿ í° ëª©ë¡ í…Œì´ë¸” -->
                    <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                        <table id="couponTable" style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa; position: sticky; top: 0;">
                                <tr>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 50px;">
                                        <input type="checkbox" id="selectAllCoupons" onchange="toggleAllCoupons()">
                                    </th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 160px;">ì¿ í°ë²ˆí˜¸</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ê±°ë˜ì²˜</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ì§ì›ëª…</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ì „í™”ë²ˆí˜¸</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; width: 100px;">í˜„ê¸ˆì”ê³ </th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; width: 100px;">í¬ì¸íŠ¸ì”ê³ </th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">ìƒíƒœ</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 100px;">ë§Œë£Œì¼</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 120px;">ìƒì„±ì¼</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 180px;">ì•¡ì…˜</th>
                                </tr>
                            </thead>
                            <tbody id="couponListBody">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 40px; color: #666;">
                                        ë¡œê·¸ì¸ í›„ 'ì „ì²´ ëª©ë¡' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¿ í° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ì¿ í° ê´€ë¦¬ ì•ˆë‚´ -->
                <div class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1; margin-top: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">ğŸ“‹ ì¿ í° ê´€ë¦¬ ê¸°ëŠ¥</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                        <li style="margin: 8px 0;"><strong>ì¡°íšŒ:</strong> ê±°ë˜ì²˜, ìƒíƒœ, ì¿ í°ì½”ë“œ, ì§ì›ì •ë³´ë¡œ ê²€ìƒ‰ ê°€ëŠ¥</li>
                        <li style="margin: 8px 0;"><strong>ìˆ˜ì •:</strong> ê°œë³„ ì¿ í°ì˜ ì”ì•¡, ìƒíƒœ, ë§Œë£Œì¼ ìˆ˜ì • ê°€ëŠ¥</li>
                        <li style="margin: 8px 0;"><strong>ì‚­ì œ:</strong> í•„ìš”ì‹œ ì¿ í°ì„ ì™„ì „ ì‚­ì œ (ì£¼ì˜ í•„ìš”)</li>
                        <li style="margin: 8px 0;"><strong>ì¼ê´„ ì‘ì—…:</strong> ì—¬ëŸ¬ ì¿ í°ì„ ì„ íƒí•˜ì—¬ ìƒíƒœ ì¼ê´„ ë³€ê²½</li>
                        <li style="margin: 8px 0;"><strong>ë°ì´í„° ë‚´ë³´ë‚´ê¸°:</strong> Excel í˜¸í™˜ í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ë‹¤ìš´ë¡œë“œ</li>
                    </ul>
                </div>
            </div>

            <!-- System Settings Section -->
            <div id="systemSettingsSection" class="content-section">
                <div class="section-header">
                    <span class="icon">ğŸ’°</span>
                    <h2>ê°€ê²© ì„¤ì •</h2>
                </div>
                
                <!-- ê¸°ë³¸ ê°€ê²© ì„¤ì • (í•­ìƒ í‘œì‹œë˜ëŠ” ê¸°ë³¸ ì„¤ì •) -->
                <div class="card">
                    <h3>ğŸ•’ ê¸°ë³¸ ê°€ê²© ì„¤ì •</h3>
                    <div class="setting-item">
                        <div class="form-row">
                            <div>
                                <label>ê¸°ë³¸ í˜„ê¸ˆ ì°¨ê° (ì›)</label>
                                <input type="number" id="defaultCashDeduction" value="1000" min="0">
                            </div>
                            <div>
                                <label>í¬ì¸íŠ¸ ì°¨ê° ë°©ì‹</label>
                                <select id="pointDeductionMethod" onchange="showPointMethodWarning()">
                                    <option value="í›„ìˆœìœ„" selected>í¬ì¸íŠ¸ í›„ìˆœìœ„ ì°¨ê°</option>
                                    <option value="ë¹„ë¡€">í¬ì¸íŠ¸ ë¹„ë¡€ ì°¨ê°</option>
                                </select>
                            </div>
                        </div>
                        <small style="color: #666;" id="defaultSettingsDescription">
                            ì‹œê°„ëŒ€ë³„ ì°¨ê°ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° ì´ ê°’ë“¤ì´ ì‚¬ìš©ë©ë‹ˆë‹¤
                        </small>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #495057;">
                            <strong>ğŸ’¡ í¬ì¸íŠ¸ ì°¨ê° ë°©ì‹ ì„¤ëª…:</strong><br>
                            â€¢ <strong>í›„ìˆœìœ„ ì°¨ê°:</strong> í˜„ê¸ˆ ë¨¼ì € ì°¨ê° í›„ ë¶€ì¡±ë¶„ì„ í¬ì¸íŠ¸ë¡œ ì°¨ê°<br>
                            â€¢ <strong>ë¹„ë¡€ ì°¨ê°:</strong> í˜„ê¸ˆê³¼ í¬ì¸íŠ¸ë¥¼ ì¼ì • ë¹„ìœ¨ë¡œ ë™ì‹œ ì°¨ê°
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>â° ì‹œê°„ëŒ€ë³„ ì°¨ê° ì„¤ì •</h3>
                    
                    <div class="setting-item">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableTimeBasedDeduction" onchange="toggleTimeBasedControls()">
                            <label for="enableTimeBasedDeduction" style="margin: 0; font-weight: bold;">ì‹œê°„ëŒ€ë³„ ì°¨ê° ê¸°ëŠ¥ í™œì„±í™”</label>
                        </div>
                        <small style="color: #666;">ì²´í¬í•˜ë©´ ì‹œê°„ëŒ€ì— ë”°ë¼ ë‹¤ë¥¸ ê¸ˆì•¡ì´ ì°¨ê°ë©ë‹ˆë‹¤</small>
                    </div>

                    <!-- ì‹œê°„ëŒ€ë³„ ê°€ê²© ì„¤ì • ì»¨íŠ¸ë¡¤ë“¤ -->
                    <div id="timeBasedControls" style="opacity: 0.5; pointer-events: none;">
                    <div class="setting-item">
                        <h4>ğŸŒ… ì•„ì¹¨ ì„¤ì •</h4>
                        <div class="form-row">
                            <div>
                                <label>ì‹œì‘ ì‹œê°„</label>
                                <input type="time" id="breakfastStartTime" value="06:00">
                            </div>
                            <div>
                                <label>ì¢…ë£Œ ì‹œê°„</label>
                                <input type="time" id="breakfastEndTime" value="10:59">
                            </div>
                            <div>
                                <label>í˜„ê¸ˆ ì°¨ê° (ì›)</label>
                                <input type="number" id="breakfastCashDeduction" value="3000" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <h4>ğŸŒ ì ì‹¬ ì„¤ì •</h4>
                        <div class="form-row">
                            <div>
                                <label>ì‹œì‘ ì‹œê°„</label>
                                <input type="time" id="lunchStartTime" value="11:00">
                            </div>
                            <div>
                                <label>ì¢…ë£Œ ì‹œê°„</label>
                                <input type="time" id="lunchEndTime" value="14:59">
                            </div>
                            <div>
                                <label>í˜„ê¸ˆ ì°¨ê° (ì›)</label>
                                <input type="number" id="lunchCashDeduction" value="5000" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <h4>ğŸŒ™ ì €ë… ì„¤ì •</h4>
                        <div class="form-row">
                            <div>
                                <label>ì‹œì‘ ì‹œê°„</label>
                                <input type="time" id="dinnerStartTime" value="15:00">
                            </div>
                            <div>
                                <label>ì¢…ë£Œ ì‹œê°„</label>
                                <input type="time" id="dinnerEndTime" value="21:59">
                            </div>
                            <div>
                                <label>í˜„ê¸ˆ ì°¨ê° (ì›)</label>
                                <input type="number" id="dinnerCashDeduction" value="7000" min="0">
                            </div>
                        </div>
                    </div>

                    </div> <!-- timeBasedControls ì»¨í…Œì´ë„ˆ ì¢…ë£Œ -->
                </div>

                <div class="card">
                    <h3>ğŸ”§ ê¸°íƒ€ ì„¤ì •</h3>
                    <div class="setting-item">
                        <div class="checkbox-group">
                            <input type="checkbox" id="allowNegativeBalance">
                            <label for="allowNegativeBalance" style="margin: 0; font-weight: bold;">ë§ˆì´ë„ˆìŠ¤ ì”ê³  í—ˆìš©</label>
                        </div>
                        <small style="color: #666;">ì²´í¬í•˜ë©´ ì”ê³ ê°€ ë¶€ì¡±í•´ë„ QR ìŠ¤ìº”ì„ í—ˆìš©í•©ë‹ˆë‹¤</small>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="loadSystemSettings()" class="btn btn-secondary">ğŸ”„ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button onclick="saveSystemSettings()" class="btn btn-success">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                    <button onclick="testCurrentDeduction()" class="btn" style="background: #17a2b8; color: white; margin-left: 10px;">ğŸ§® í˜„ì¬ ì°¨ê°ì•¡ í…ŒìŠ¤íŠ¸</button>
                </div>

                <div id="settingsPreview" style="background: #e6f3ff; padding: 15px; border-radius: 8px; margin-top: 20px; display: none;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ“‹ í˜„ì¬ ì„¤ì • ë¯¸ë¦¬ë³´ê¸°</h4>
                    <div id="previewContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Send Section -->
    <div id="sendSection" class="content-section">
        <div class="section-header">
            <span class="icon">ğŸ“¤</span>
            <h2>ì¿ í° ë°œì†¡</h2>
        </div>
        
        <div class="card">
            <!-- ê±°ë˜ì²˜ ì„ íƒ -->
            <div class="form-group" style="margin-bottom: 30px;">
                <label for="sendCorporateSelect">ë°œì†¡í•  ê±°ë˜ì²˜ ì„ íƒ:</label>
                <select id="sendCorporateSelect" style="width: 100%; max-width: 400px; padding: 16px; border: 1px solid #ddd; border-radius: 4px;" onchange="loadCouponsForSend()">
                    <option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>

            <!-- ì¿ í° ëª©ë¡ ë° ë°œì†¡ í˜„í™© -->
            <div id="couponSendPanel" style="display: none;">
                <h4 style="margin: 0 0 15px 0; color: #667eea;">ğŸ« ì¿ í° ë°œì†¡ í˜„í™©</h4>
                
                <!-- ë°œì†¡ ìš”ì•½ ì •ë³´ -->
                <div id="sendSummary" class="card" style="background: #e6f3ff; border-left: 4px solid #4299e1; margin-bottom: 20px;">
                </div>

                <!-- ì¼ê´„ ë°œì†¡ ë²„íŠ¼ -->
                <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button onclick="sendAllEmails()" class="btn" style="background: #e53e3e; color: white;">ğŸ“§ ì „ì²´ ì´ë©”ì¼ ë°œì†¡</button>
                    <button onclick="sendAllSMS()" class="btn" style="background: #48bb78; color: white;">ğŸ“± ì „ì²´ SMS ë°œì†¡</button>
                    <button onclick="sendAllKakao()" class="btn" style="background: #f6ad55; color: white;">ğŸ’¬ ì „ì²´ ì¹´ì¹´ì˜¤í†¡ ë°œì†¡</button>
                </div>

                <!-- ì¿ í° ëª©ë¡ í…Œì´ë¸” -->
                <div style="max-height: 500px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="couponSendTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ì¿ í°ë²ˆí˜¸</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 100px;">ì´ë¦„</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ì „í™”ë²ˆí˜¸</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 180px;">ì´ë©”ì¼ì£¼ì†Œ</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">ë°œì†¡ì—¬ë¶€</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 250px;">ë°œì†¡ ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody id="couponSendBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì¿ í° ë°œì†¡ ì•ˆë‚´ -->
            <div id="sendInstructions" class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1; margin-top: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">ğŸ“‹ ì¿ í° ë°œì†¡ ë°©ë²•</h4>
                <ol style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                    <li style="margin: 8px 0;">ë°œì†¡í•  ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                    <li style="margin: 8px 0;">í•´ë‹¹ ê±°ë˜ì²˜ì˜ ì¿ í° ëª©ë¡ì´ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤</li>
                    <li style="margin: 8px 0;">ê°œë³„ ë°œì†¡: ê° ì¿ í°ë³„ë¡œ ì´ë©”ì¼/SMS/ì¹´ì¹´ì˜¤í†¡ ë²„íŠ¼ í´ë¦­</li>
                    <li style="margin: 8px 0;">ì¼ê´„ ë°œì†¡: ìƒë‹¨ì˜ ì „ì²´ ë°œì†¡ ë²„íŠ¼ í´ë¦­</li>
                    <li style="margin: 8px 0;">ë°œì†¡ ìƒíƒœëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</li>
                </ol>
                <div style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 4px; border-left: 3px solid #28a745;">
                    <strong>âœ… ìƒíƒœ:</strong> ì¿ í° ë°œì†¡ ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ APIë“¤ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
                    <ul style="margin-top: 5px; margin-bottom: 0;">
                        <li>/api/coupon-send/email - ì´ë©”ì¼ ë°œì†¡</li>
                        <li>/api/coupon-send/sms - SMS ë°œì†¡</li>
                        <li>/api/coupon-send/kakao - ì¹´ì¹´ì˜¤í†¡ ë°œì†¡</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery History Section -->
    <div id="deliveryHistorySection" class="content-section">
        <div class="section-header">
            <span class="icon">ğŸ“‹</span>
            <h2>ë°œì†¡ ê¸°ë¡</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>ğŸ“Š ì¿ í° ë°œì†¡ ê¸°ë¡</h3>
                <button onclick="loadDeliveryHistory()" class="btn btn-success">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <!-- ê²€ìƒ‰ ë° í•„í„° -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                    <div>
                        <label for="deliverySearchType">ê²€ìƒ‰ ìœ í˜•:</label>
                        <select id="deliverySearchType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">ì „ì²´</option>
                            <option value="email">ì´ë©”ì¼</option>
                            <option value="sms">SMS</option>
                            <option value="kakao">ì¹´ì¹´ì˜¤í†¡</option>
                        </select>
                    </div>
                    <div>
                        <label for="deliverySearchStatus">ë°œì†¡ ìƒíƒœ:</label>
                        <select id="deliverySearchStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">ì „ì²´</option>
                            <option value="pending">ëŒ€ê¸°</option>
                            <option value="sent">ë°œì†¡ë¨</option>
                            <option value="failed">ì‹¤íŒ¨</option>
                        </select>
                    </div>
                    <div>
                        <label for="deliverySearchDate">ë°œì†¡ì¼:</label>
                        <input type="date" id="deliverySearchDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <button onclick="filterDeliveryHistory()" class="btn" style="background: #48bb78; color: white;">ğŸ” í•„í„°</button>
                </div>
            </div>

            <!-- í†µê³„ ìš”ì•½ -->
            <div id="deliveryStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                <!-- í†µê³„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <!-- ë°œì†¡ ê¸°ë¡ í…Œì´ë¸” -->
            <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                <table id="deliveryHistoryTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8f9fa; position: sticky; top: 0;">
                        <tr>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ID</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ì¿ í°ë²ˆí˜¸</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ë°œì†¡ìœ í˜•</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ìˆ˜ì‹ ì</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 180px;">ì œëª©</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ìƒíƒœ</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 150px;">ë°œì†¡ì¼ì‹œ</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody id="deliveryHistoryBody">
                        <tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">ë°œì†¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div id="deliveryPagination" style="margin-top: 20px; text-align: center;">
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- Email Configuration Section -->
    <div id="emailConfigSection" class="content-section">
        <div class="section-header">
            <span class="icon">ğŸ“§</span>
            <h2>ì´ë©”ì¼ ì„¤ì •</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>ğŸ“§ ì´ë©”ì¼ ì„œë²„ ì„¤ì •</h3>
                <button onclick="testEmailConnection()" class="btn" style="background: #38a169; color: white;">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            </div>

            <!-- í”„ë¡œë°”ì´ë” í”„ë¦¬ì…‹ -->
            <div class="card" style="background: #f8f9fa;">
                <h4 style="margin-top: 0; color: #667eea;">âš¡ ë¹ ë¥¸ ì„¤ì • (í”„ë¡œë°”ì´ë” í”„ë¦¬ì…‹)</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="applyGmailPreset()" class="btn" style="background: #ea4335; color: white;">Gmail</button>
                    <button onclick="applyOutlookPreset()" class="btn" style="background: #0078d4; color: white;">Outlook</button>
                    <button onclick="applyYahooPreset()" class="btn" style="background: #720e9e; color: white;">Yahoo</button>
                    <button onclick="applyNaverPreset()" class="btn" style="background: #03c75a; color: white;">Naver</button>
                    <button onclick="applyEcountPreset()" class="btn" style="background: #f39c12; color: white;">Ecount</button>
                </div>
            </div>

            <!-- SMTP ì„œë²„ ì„¤ì • -->
            <div class="card">
                <h4 style="margin-top: 0; color: #667eea;">ğŸ”§ SMTP ì„œë²„ ì„¤ì •</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="smtpHost">SMTP í˜¸ìŠ¤íŠ¸ *</label>
                        <input type="text" id="smtpHost" placeholder="smtp.gmail.com" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smtpPort">SMTP í¬íŠ¸ *</label>
                        <input type="number" id="smtpPort" placeholder="587" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label>ë³´ì•ˆ ì„¤ì •</label>
                    <div style="display: flex; gap: 20px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="none" style="margin-right: 5px;">
                            ë³´ì•ˆ ì—†ìŒ
                        </label>
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="tls" checked style="margin-right: 5px;">
                            TLS
                        </label>
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="ssl" style="margin-right: 5px;">
                            SSL
                        </label>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="smtpUsername">ì‚¬ìš©ìëª… *</label>
                        <input type="text" id="smtpUsername" placeholder="your-email@gmail.com" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smtpPassword">ë¹„ë°€ë²ˆí˜¸ *</label>
                        <input type="password" id="smtpPassword" placeholder="ì•± ë¹„ë°€ë²ˆí˜¸" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="loadEmailConfig()" class="btn btn-secondary">ğŸ”„ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button onclick="saveEmailConfig()" class="btn btn-success">ğŸ’¾ ì„¤ì • ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- SMS Configuration Section -->
    <div id="smsConfigSection" class="content-section">
        <div class="section-header">
            <span class="icon">ğŸ“±</span>
            <h2>SMS ì„¤ì •</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>ğŸ“± SMS ì„œë¹„ìŠ¤ ì„¤ì •</h3>
                <button onclick="testSmsConnection()" class="btn" style="background: #38a169; color: white;">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            </div>

            <div class="card">
                <h4 style="margin-top: 0; color: #667eea;">ğŸ”§ SMS API ì„¤ì •</h4>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="smsApiUrl">SMS API URL *</label>
                    <input type="text" id="smsApiUrl" placeholder="https://api.coolsms.co.kr" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="smsSenderNumber">ë°œì‹ ë²ˆí˜¸ *</label>
                        <input type="text" id="smsSenderNumber" placeholder="010-0000-0000" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smsSenderName">ë°œì‹ ìëª…</label>
                        <input type="text" id="smsSenderName" placeholder="ì¿ í°ë§¤ë‹ˆì €" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="smsTestMode" style="margin-right: 8px;">
                        í…ŒìŠ¤íŠ¸ ëª¨ë“œ (ì‹¤ì œ ë°œì†¡í•˜ì§€ ì•ŠìŒ)
                    </label>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="loadSmsConfig()" class="btn btn-secondary">ğŸ”„ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button onclick="saveSmsConfig()" class="btn btn-success">ğŸ’¾ ì„¤ì • ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Management Information Section -->
    <div id="managementInfoSection" class="content-section">
        <div class="section-header">
            <span class="icon">ğŸ“Š</span>
            <h2>ê²½ì˜ì •ë³´</h2>
        </div>
        
        <!-- Tab Navigation -->
        <div class="management-tabs" style="margin-bottom: 30px;">
            <button class="tab-button active" onclick="showManagementTab('statistics')" id="statisticsTabBtn">
                ğŸ“Š ê±°ë˜ì²˜ë³„ í†µê³„
            </button>
            <button class="tab-button" onclick="showManagementTab('monthlyReport')" id="monthlyReportTabBtn">
                ğŸ“ˆ ì›”ê°„ì •ì‚°ë³´ê³ ì„œ
            </button>
        </div>

        <!-- Statistics Tab -->
        <div id="statisticsTab" class="management-tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ“Š ê±°ë˜ì²˜ë³„ í†µê³„</h3>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="loadManagementStats()" class="btn btn-success">ğŸ”„ í†µê³„ ì¡°íšŒ</button>
                        <button onclick="exportStatsToExcel()" class="btn" style="background: #52c41a; color: white;">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>

                <!-- Date Range Selector -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
                        <div>
                            <label for="statsStartDate">ì‹œì‘ì¼:</label>
                            <input type="date" id="statsStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label for="statsEndDate">ì¢…ë£Œì¼:</label>
                            <input type="date" id="statsEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="setCurrentMonth()" class="btn btn-secondary">ì´ë²ˆ ë‹¬</button>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div id="summaryStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalCorporates">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">ì´ ê±°ë˜ì²˜ ìˆ˜</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #38a169 0%, #48bb78 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalIssuedCoupons">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">ë°œí–‰ëœ ì¿ í° ìˆ˜</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #3182ce 0%, #4299e1 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalUsedCoupons">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">ì‚¬ìš©ëœ ì¿ í° ìˆ˜</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #e53e3e 0%, #f56565 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="overallUsageRate">0%</div>
                        <div style="font-size: 14px; opacity: 0.9;">ì „ì²´ ì‚¬ìš©ë¥ </div>
                    </div>
                </div>

                <!-- Corporate Statistics Table -->
                <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="corporateStatsTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ê±°ë˜ì²˜ëª…</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì§ì› ìˆ˜</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ë°œí–‰</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì‚¬ìš©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ë¯¸ì‚¬ìš©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì‚¬ìš©ë¥ </th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í˜„ê¸ˆ ê°€ì¹˜</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í¬ì¸íŠ¸ ê°€ì¹˜</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ìƒì„¸ë³´ê¸°</th>
                            </tr>
                        </thead>
                        <tbody id="corporateStatsBody">
                            <tr><td colspan="9" style="text-align: center; padding: 40px; color: #666;">'í†µê³„ ì¡°íšŒ' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Monthly Report Tab -->
        <div id="monthlyReportTab" class="management-tab-content" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ“ˆ ì›”ê°„ì •ì‚°ë³´ê³ ì„œ</h3>
                    <button onclick="loadMonthlyReport()" class="btn btn-success">ğŸ”„ ë³´ê³ ì„œ ì¡°íšŒ</button>
                </div>

                <!-- Year/Month and Corporate Filter -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: end;">
                        <div>
                            <label for="reportYear">ì—°ë„:</label>
                            <select id="reportYear" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <!-- Years will be populated by JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label for="reportMonth">ì›”:</label>
                            <select id="reportMonth" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="1">1ì›”</option>
                                <option value="2">2ì›”</option>
                                <option value="3">3ì›”</option>
                                <option value="4">4ì›”</option>
                                <option value="5">5ì›”</option>
                                <option value="6">6ì›”</option>
                                <option value="7">7ì›”</option>
                                <option value="8">8ì›”</option>
                                <option value="9">9ì›”</option>
                                <option value="10">10ì›”</option>
                                <option value="11">11ì›”</option>
                                <option value="12">12ì›”</option>
                            </select>
                        </div>
                        <div>
                            <label for="reportCorporateFilter">ê±°ë˜ì²˜:</label>
                            <select id="reportCorporateFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">ì „ì²´</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Monthly Summary -->
                <div id="monthlySummary" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div class="stat-item" style="background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyUsageCount">0</div>
                        <div style="font-size: 12px; opacity: 0.9;">ì´ ì‚¬ìš© íšŸìˆ˜</div>
                    </div>
                    <div class="stat-item" style="background: #48bb78; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyTotalCashDeducted">0ì›</div>
                        <div style="font-size: 12px; opacity: 0.9;">ì´ ì°¨ê° í˜„ê¸ˆ</div>
                    </div>
                    <div class="stat-item" style="background: #4299e1; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyTotalPointsDeducted">0P</div>
                        <div style="font-size: 12px; opacity: 0.9;">ì´ ì°¨ê° í¬ì¸íŠ¸</div>
                    </div>
                    <div class="stat-item" style="background: #38a169; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyRemainingCash">0ì›</div>
                        <div style="font-size: 12px; opacity: 0.9;">í˜„ê¸ˆ ì”ì•¡</div>
                    </div>
                    <div class="stat-item" style="background: #9f7aea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyRemainingPoints">0P</div>
                        <div style="font-size: 12px; opacity: 0.9;">í¬ì¸íŠ¸ ì”ì•¡</div>
                    </div>
                </div>

                <!-- Monthly Detail Table -->
                <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="monthlyReportTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ê±°ë˜ì²˜ëª…</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ì§ì›ëª…</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì‚¬ìš© íšŸìˆ˜</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">ì°¨ê° í˜„ê¸ˆ</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">ì°¨ê° í¬ì¸íŠ¸</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í˜„ê¸ˆ ì”ì•¡</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í¬ì¸íŠ¸ ì”ì•¡</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyReportBody">
                            <tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">'ë³´ê³ ì„œ ì¡°íšŒ' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Corporate Detail Modal -->
    <div id="corporateDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="corporateDetailTitle">ê±°ë˜ì²˜ ìƒì„¸ ì •ë³´</h3>
                <button onclick="closeCorporateDetailModal()" class="btn btn-secondary">âœ• ë‹«ê¸°</button>
            </div>
            
            <div id="corporateDetailContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
            <h3 id="employeeModalTitle">ìƒˆ ì§ì› ì¶”ê°€</h3>
            <form id="employeeForm" onsubmit="submitEmployeeForm(event)">
                <input type="hidden" id="employeeId" value="">
                <input type="hidden" id="employeeCorporateId" value="">
                
                <div class="form-group">
                    <label for="employeeCorporateName">ì†Œì† ê±°ë˜ì²˜</label>
                    <input type="text" id="employeeCorporateName" readonly style="background: #f0f0f0; padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeName">ì´ë¦„ *</label>
                    <input type="text" id="employeeName" required style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeePhone">í•¸ë“œí° ë²ˆí˜¸ *</label>
                    <input type="text" id="employeePhone" placeholder="010-0000-0000" required style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeEmail">ì´ë©”ì¼</label>
                    <input type="email" id="employeeEmail" placeholder="employee@example.com" style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeDepartment">ë¶€ì„œ</label>
                    <input type="text" id="employeeDepartment" placeholder="ì˜ˆ: ê°œë°œíŒ€, ì˜ì—…íŒ€" style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeEmployeeModal()" class="btn btn-secondary">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-success">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let brokerWebSocket = null;
        let brokerConnected = false;
        let androidServerConnected = false;
        let currentToken = localStorage.getItem('apiToken') || '';
        let messageId = 0;
        let pendingRequests = new Map(); // Store pending API requests
        let couponEmployees = []; // Store employees for coupon distribution
        let currentSection = 'welcome'; // Current active section

        // Navigation functions - Define these first so they're available for HTML onclick handlers
        function toggleDropdown() {
            const dropdown = document.getElementById('navDropdown');
            const button = document.querySelector('.nav-button');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
            } else {
                dropdown.classList.add('show');
                button.classList.add('active');
            }
        }

        // Enhanced showSection function to handle section initialization
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionName;
                
                // Close dropdown
                const dropdown = document.getElementById('navDropdown');
                const button = document.querySelector('.nav-button');
                dropdown.classList.remove('show');
                button.classList.remove('active');
                
                logMessage('ì„¹ì…˜ ì „í™˜: ' + sectionName, 'info');
                
                // Initialize section-specific functions
                if (sectionName === 'systemSettings') {
                    // Auto-load settings when section is shown
                    // loadSystemSettings();
                } else if (sectionName === 'employee') {
                    loadCorporatesForEmployeeTab();
                } else if (sectionName === 'coupon') {
                    loadCorporatesForCouponTab();
                } else if (sectionName === 'couponManagement') {
                    if (androidServerConnected) {
                        loadAllCoupons();
                    }
                } else if (sectionName === 'send') {
                    loadCorporatesForSendTab();
                } else if (sectionName === 'deliveryHistory') {
                    // Don't automatically load delivery history since API might not exist
                    // User can click the refresh button to load manually
                } else if (sectionName === 'emailConfig') {
                    loadEmailConfig();
                } else if (sectionName === 'smsConfig') {
                    loadSmsConfig();
                }
            }
        }

        // Initialize page
        window.onload = function() {
            showSection('welcome');
            logMessage('ì‹œìŠ¤í…œì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        };

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.nav-button') && !event.target.closest('.nav-dropdown')) {
                const dropdown = document.getElementById('navDropdown');
                const button = document.querySelector('.nav-button');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                    button.classList.remove('active');
                }
            }
        }


        // Message logging function
        function logMessage(message, type = 'info') {
            const logElement = document.getElementById('messageLog');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const typeClass = type;
            
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="${typeClass}">[${type.toUpperCase()}]</span> ${message}`;
            
            logElement.appendChild(messageElement);
            logElement.scrollTop = logElement.scrollHeight;

            // Keep only last 100 messages
            while (logElement.children.length > 100) {
                logElement.removeChild(logElement.firstChild);
            }
        }

        // Clear message log
        function clearMessageLog() {
            document.getElementById('messageLog').innerHTML = '<div class="info">[ì‹œìŠ¤í…œ] ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
        }

        // WebSocket Broker Connection Functions
        async function connectToBroker() {
            const brokerUrl = document.getElementById('brokerUrl').value;
            const clientId = document.getElementById('clientId').value;
            const clientPassword = document.getElementById('clientPassword').value;
            const targetServerName = document.getElementById('targetServerName').value;

            if (!brokerUrl || !clientId || !targetServerName) {
                alert('ë¸Œë¡œì»¤ URL, í´ë¼ì´ì–¸íŠ¸ ID, ëŒ€ìƒ ì„œë²„ëª…ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            logMessage('ë¸Œë¡œì»¤ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤...', 'info');
            updateBrokerUI('connecting');

            try {
                // Build connection URL with query parameters
                const baseUrl = brokerUrl.replace(/\/?$/, '/');
                const params = new URLSearchParams({
                    web_server: targetServerName,
                    client_id: clientId,
                    type: 'client',
                    password: clientPassword || ''
                });
                const connectionUrl = `${baseUrl}?${params.toString()}`;
                
                logMessage(`ì—°ê²° URL: ${connectionUrl}`, 'info');
                brokerWebSocket = new WebSocket(connectionUrl);

                brokerWebSocket.onopen = function(event) {
                    logMessage('ë¸Œë¡œì»¤ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    logMessage(`ëŒ€ìƒ ì„œë²„: ${targetServerName}, í´ë¼ì´ì–¸íŠ¸ ID: ${clientId}`, 'info');
                };

                brokerWebSocket.onmessage = function(event) {
                    logMessage('ë¸Œë¡œì»¤ë¡œë¶€í„° ì›ì‹œ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + event.data.substring(0, 200), 'info');
                    try {
                        const message = JSON.parse(event.data);
                        logMessage('íŒŒì‹±ëœ ë©”ì‹œì§€ íƒ€ì…: ' + message.type, 'info');
                        handleBrokerMessage(message);
                    } catch (e) {
                        logMessage('ì˜ëª»ëœ ë©”ì‹œì§€ í˜•ì‹ì„ ë°›ì•˜ìŠµë‹ˆë‹¤: ' + event.data, 'error');
                        logMessage('íŒŒì‹± ì˜¤ë¥˜: ' + e.message, 'error');
                    }
                };

                brokerWebSocket.onclose = function(event) {
                    logMessage('ë¸Œë¡œì»¤ ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                    brokerConnected = false;
                    androidServerConnected = false;
                    updateBrokerUI('disconnected');
                    updateAndroidUI('disconnected');
                    updateMenuVisibility();
                };

                brokerWebSocket.onerror = function(error) {
                    logMessage('ë¸Œë¡œì»¤ ì—°ê²° ì˜¤ë¥˜: ' + error, 'error');
                    updateBrokerUI('error');
                };

            } catch (error) {
                logMessage('ë¸Œë¡œì»¤ ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
                updateBrokerUI('error');
            }
        }

        function disconnectFromBroker() {
            if (brokerWebSocket) {
                brokerWebSocket.close();
                brokerWebSocket = null;
                logMessage('ë¸Œë¡œì»¤ ì—°ê²°ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤.', 'info');
            }
            brokerConnected = false;
            androidServerConnected = false;
            currentToken = '';
            localStorage.removeItem('apiToken');
            updateBrokerUI('disconnected');
            updateAndroidUI('disconnected');
            updateMenuVisibility();
        }

        function testBrokerConnection() {
            if (!brokerConnected || !brokerWebSocket) {
                alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const testMessage = {
                type: 'ping',
                timestamp: new Date().toISOString()
            };

            brokerWebSocket.send(JSON.stringify(testMessage));
            logMessage('ë¸Œë¡œì»¤ì— ping ë©”ì‹œì§€ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.', 'info');
        }


        // Android server login via broker
        async function loginToAndroidServer() {
            if (!brokerConnected) {
                alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;

            if (!userId || !password) {
                alert('ì‚¬ìš©ì IDì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            logMessage('Android ì„œë²„ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤...', 'info');
            
            const requestId = ++messageId;
            const loginRequest = {
                type: 'api_request',
                id: requestId,
                method: 'POST',
                endpoint: '/api/login',
                data: { userId, password }
            };

            logMessage('ë¡œê·¸ì¸ ìš”ì²­ ì „ì†¡: ' + JSON.stringify(loginRequest), 'info');
            
            try {
                brokerWebSocket.send(JSON.stringify(loginRequest));
                logMessage('ë¸Œë¡œì»¤ì— ë¡œê·¸ì¸ ìš”ì²­ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤. (ìš”ì²­ ID: ' + requestId + ')', 'info');
            } catch (error) {
                logMessage('ë¸Œë¡œì»¤ ì „ì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
                return;
            }
            
            // Store the pending request
            pendingRequests.set(requestId, {
                type: 'login',
                timestamp: Date.now()
            });
            logMessage('ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì— ì¶”ê°€ë¨. í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ ìˆ˜: ' + pendingRequests.size, 'info');
        }

        function logoutFromAndroidServer() {
            androidServerConnected = false;
            currentToken = '';
            localStorage.removeItem('apiToken');
            updateAndroidUI('disconnected');
            updateMenuVisibility();
            logMessage('Android ì„œë²„ì—ì„œ ë¡œê·¸ì•„ì›ƒí–ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function testAndroidServerConnection() {
            if (!brokerConnected) {
                alert('ë¨¼ì € ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            logMessage('Android ì„œë²„ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤...', 'info');
            
            const testRequest = {
                type: 'api_request',
                id: ++messageId,
                method: 'GET',
                endpoint: '/api',
                data: {}
            };

            brokerWebSocket.send(JSON.stringify(testRequest));
            
            pendingRequests.set(messageId, {
                type: 'test',
                timestamp: Date.now()
            });
        }

        // Handle API responses from Android server via broker
        function handleApiResponse(message) {
            logMessage('API ì‘ë‹µ ìˆ˜ì‹ : ' + JSON.stringify(message), 'info');
            
            const requestInfo = pendingRequests.get(message.id);
            if (!requestInfo) {
                logMessage('ì•Œ ìˆ˜ ì—†ëŠ” API ì‘ë‹µ: ' + message.id, 'warning');
                return;
            }

            pendingRequests.delete(message.id);

            if (requestInfo.type === 'login') {
                if (message.success && message.data && message.data.success) {
                    currentToken = message.data.accessToken;
                    localStorage.setItem('apiToken', currentToken);
                    androidServerConnected = true;
                    updateAndroidUI('connected');
                    updateMenuVisibility();
                    logMessage('Android ì„œë²„ ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                } else {
                    const errorMsg = message.error || message.data?.message || message.data?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    logMessage('Android ì„œë²„ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + errorMsg, 'error');
                    logMessage('ì „ì²´ ì‘ë‹µ: ' + JSON.stringify(message), 'error');
                    updateAndroidUI('login_failed');
                }
            } else if (requestInfo.type === 'test') {
                if (message.success) {
                    logMessage('Android ì„œë²„ í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                } else {
                    logMessage('Android ì„œë²„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + (message.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } else if (requestInfo.type === 'generic') {
                if (message.success) {
                    logMessage(`API ìš”ì²­ ì„±ê³µ: ${requestInfo.method} ${requestInfo.endpoint}`, 'success');
                    requestInfo.resolve(message.data);
                } else {
                    let errorMsg = message.error || message.data?.error || message.data?.message || 'API request failed';
                    
                    // 404 ì—ëŸ¬ íŠ¹ë³„ ì²˜ë¦¬
                    if (message.data === 404 || errorMsg.includes('404') || errorMsg.includes('cannot be converted to JSONObject')) {
                        errorMsg = `API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${requestInfo.endpoint}`;
                        logMessage(`âš ï¸ 404 ì˜¤ë¥˜: ${requestInfo.endpoint} - Android ì„œë²„ì— í•´ë‹¹ APIê°€ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`, 'error');
                    }
                    
                    logMessage(`API ìš”ì²­ ì‹¤íŒ¨: ${requestInfo.method} ${requestInfo.endpoint} - ${errorMsg}`, 'error');
                    logMessage(`ì‹¤íŒ¨ ì‘ë‹µ ì „ì²´: ${JSON.stringify(message)}`, 'error');
                    requestInfo.reject(new Error(errorMsg));
                }
            }
        }

        // UI Update functions
        function updateBrokerUI(status) {
            const statusElement = document.getElementById('brokerConnectionStatus');
            const infoElement = document.getElementById('brokerConnectionInfo');
            const connectBtn = document.getElementById('connectBrokerBtn');
            const disconnectBtn = document.getElementById('disconnectBrokerBtn');
            const testBtn = document.getElementById('testBrokerBtn');

            switch (status) {
                case 'connecting':
                    statusElement.innerHTML = '<div class="status-indicator status-connecting">ğŸŸ¡ ë¸Œë¡œì»¤ ì—°ê²° ì¤‘...</div>';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    testBtn.disabled = true;
                    infoElement.style.display = 'block';
                    document.getElementById('brokerStatusText').textContent = 'ì—°ê²° ì¤‘...';
                    document.getElementById('brokerUrlText').textContent = document.getElementById('brokerUrl').value;
                    document.getElementById('clientIdText').textContent = document.getElementById('clientId').value;
                    document.getElementById('targetServerText').textContent = document.getElementById('targetServerName').value;
                    break;

                case 'connected':
                    statusElement.innerHTML = '<div class="status-indicator status-online">ğŸŸ¢ ë¸Œë¡œì»¤ ì—°ê²°ë¨</div>';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    testBtn.disabled = false;
                    document.getElementById('brokerStatusText').textContent = 'ì—°ê²°ë¨ (ì¸ì¦ ì™„ë£Œ)';
                    document.getElementById('connectedBrokerUrl').textContent = document.getElementById('brokerUrl').value;
                    document.getElementById('connectedServerName').textContent = document.getElementById('targetServerName').value;
                    break;

                case 'disconnected':
                case 'error':
                case 'auth_failed':
                    statusElement.innerHTML = '<div class="status-indicator status-offline">ğŸ”´ ë¸Œë¡œì»¤ ë¯¸ì—°ê²°</div>';
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                    testBtn.disabled = true;
                    infoElement.style.display = 'none';
                    document.getElementById('connectedBrokerUrl').textContent = '-';
                    document.getElementById('connectedServerName').textContent = '-';
                    break;
            }
        }

        function updateAndroidUI(status) {
            const statusElement = document.getElementById('androidServerStatus');
            const infoElement = document.getElementById('androidLoginInfo');
            const loginBtn = document.getElementById('loginAndroidBtn');
            const logoutBtn = document.getElementById('logoutAndroidBtn');
            const testBtn = document.getElementById('testAndroidBtn');

            switch (status) {
                case 'connected':
                    statusElement.innerHTML = '<div class="status-indicator status-online">ğŸŸ¢ Android ì„œë²„ ì—°ê²°ë¨</div>';
                    loginBtn.disabled = true;
                    logoutBtn.disabled = false;
                    testBtn.disabled = false;
                    infoElement.style.display = 'block';
                    document.getElementById('androidLoginStatusText').textContent = 'ë¡œê·¸ì¸ë¨';
                    document.getElementById('androidTokenText').textContent = currentToken ? currentToken.substring(0, 20) + '...' : '-';
                    document.getElementById('androidTokenExpiryText').textContent = 'ì„¸ì…˜ í™œì„±';
                    document.getElementById('connectedAndroidServer').textContent = document.getElementById('targetServerName').value;
                    document.getElementById('androidApiStatus').textContent = 'ì¸ì¦ë¨';
                    break;

                case 'disconnected':
                case 'login_failed':
                    statusElement.innerHTML = '<div class="status-indicator status-offline">ğŸ”´ Android ì„œë²„ ë¯¸ì—°ê²°</div>';
                    loginBtn.disabled = !brokerConnected;
                    logoutBtn.disabled = true;
                    testBtn.disabled = !brokerConnected;
                    infoElement.style.display = 'none';
                    document.getElementById('connectedAndroidServer').textContent = '-';
                    document.getElementById('androidApiStatus').textContent = '-';
                    break;
            }
        }

        function updateMenuVisibility() {
            const menuItems = [
                'corporateMenu', 
                'employeeMenu', 
                'couponMenu', 
                'couponManagementMenu',
                'sendMenu',
                'deliveryHistoryMenu',
                'emailConfigMenu',
                'smsConfigMenu',
                'systemSettingsMenu',
                'managementInfoMenu'
            ];
            const shouldShow = brokerConnected && androidServerConnected;

            menuItems.forEach(menuId => {
                const menuElement = document.getElementById(menuId);
                if (menuElement) {
                    menuElement.style.display = shouldShow ? 'block' : 'none';
                }
            });
        }

        // Generic API request function via broker
        function sendApiRequest(method, endpoint, data = {}) {
            if (!brokerConnected || !brokerWebSocket) {
                const error = 'ë¸Œë¡œì»¤ì— ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.';
                logMessage(`API ìš”ì²­ ì‹¤íŒ¨: ${error}`, 'error');
                throw new Error(error);
            }

            if (!androidServerConnected && endpoint !== '/api/login' && endpoint !== '/api') {
                const error = 'Android ì„œë²„ì— ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.';
                logMessage(`API ìš”ì²­ ì‹¤íŒ¨: ${error}`, 'error');
                throw new Error(error);
            }

            const requestId = ++messageId;
            const apiRequest = {
                type: 'api_request',
                id: requestId,
                method: method,
                endpoint: endpoint,
                data: data,
                token: currentToken
            };

            logMessage(`API ìš”ì²­ ì „ì†¡: ${method} ${endpoint} (ìš”ì²­ ID: ${requestId})`, 'info');
            logMessage(`ìš”ì²­ ë°ì´í„°: ${JSON.stringify(data)}`, 'info');

            try {
                brokerWebSocket.send(JSON.stringify(apiRequest));
            } catch (error) {
                logMessage(`ë¸Œë¡œì»¤ ì „ì†¡ ì˜¤ë¥˜: ${error.message}`, 'error');
                throw error;
            }

            return new Promise((resolve, reject) => {
                pendingRequests.set(requestId, {
                    type: 'generic',
                    resolve: resolve,
                    reject: reject,
                    timestamp: Date.now(),
                    endpoint: endpoint,
                    method: method
                });

                // Set timeout for request
                setTimeout(() => {
                    if (pendingRequests.has(requestId)) {
                        pendingRequests.delete(requestId);
                        logMessage(`API ìš”ì²­ íƒ€ì„ì•„ì›ƒ: ${method} ${endpoint} (ìš”ì²­ ID: ${requestId})`, 'error');
                        reject(new Error(`Request timeout: ${method} ${endpoint}`));
                    }
                }, 30000); // 30 second timeout
            });
        }

        // Clean up old pending requests
        setInterval(() => {
            const now = Date.now();
            for (let [id, request] of pendingRequests.entries()) {
                if (now - request.timestamp > 60000) { // 1 minute timeout
                    pendingRequests.delete(id);
                    if (request.reject) {
                        request.reject(new Error('Request expired'));
                    }
                }
            }
        }, 30000);

        // Enhanced handleApiResponse to handle generic requests
        function handleApiResponse(message) {
            const requestInfo = pendingRequests.get(message.id);
            if (!requestInfo) {
                logMessage('ì•Œ ìˆ˜ ì—†ëŠ” API ì‘ë‹µ: ' + message.id, 'warning');
                return;
            }

            pendingRequests.delete(message.id);

            if (requestInfo.type === 'login') {
                if (message.success && message.data.success) {
                    currentToken = message.data.accessToken;
                    localStorage.setItem('apiToken', currentToken);
                    androidServerConnected = true;
                    updateAndroidUI('connected');
                    updateMenuVisibility();
                    logMessage('Android ì„œë²„ ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                } else {
                    logMessage('Android ì„œë²„ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (message.data?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                    updateAndroidUI('login_failed');
                }
            } else if (requestInfo.type === 'test') {
                if (message.success) {
                    logMessage('Android ì„œë²„ í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                } else {
                    logMessage('Android ì„œë²„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + (message.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } else if (requestInfo.type === 'generic') {
                if (message.success) {
                    logMessage(`API ìš”ì²­ ì„±ê³µ: ${requestInfo.method} ${requestInfo.endpoint}`, 'success');
                    requestInfo.resolve(message.data);
                } else {
                    let errorMsg = message.error || message.data?.error || message.data?.message || 'API request failed';
                    
                    // 404 ì—ëŸ¬ íŠ¹ë³„ ì²˜ë¦¬
                    if (message.data === 404 || errorMsg.includes('404') || errorMsg.includes('cannot be converted to JSONObject')) {
                        errorMsg = `API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${requestInfo.endpoint}`;
                        logMessage(`âš ï¸ 404 ì˜¤ë¥˜: ${requestInfo.endpoint} - Android ì„œë²„ì— í•´ë‹¹ APIê°€ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`, 'error');
                    }
                    
                    logMessage(`API ìš”ì²­ ì‹¤íŒ¨: ${requestInfo.method} ${requestInfo.endpoint} - ${errorMsg}`, 'error');
                    logMessage(`ì‹¤íŒ¨ ì‘ë‹µ ì „ì²´: ${JSON.stringify(message)}`, 'error');
                    requestInfo.reject(new Error(errorMsg));
                }
            }
        }

        // Handle messages from broker
        function handleBrokerMessage(message) {
            // Log all incoming messages for debugging
            logMessage(`ë¸Œë¡œì»¤ ë©”ì‹œì§€ ìˆ˜ì‹ : ${message.type}`, 'info');
            
            if (message.type === 'connected') {
                // Handle initial connection confirmation
                brokerConnected = true;
                updateBrokerUI('connected');
                updateMenuVisibility();
                logMessage('ë¸Œë¡œì»¤ ì—°ê²°ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                logMessage(`ì„¸ì…˜ ID: ${message.session_id || 'N/A'}`, 'info');
                logMessage(`ì›¹ì„œë²„: ${message.web_server_name || 'N/A'}`, 'info');
                logMessage(`í´ë¼ì´ì–¸íŠ¸ ID: ${message.client_id || 'N/A'}`, 'info');
                
                // Enable Android server login button
                document.getElementById('loginAndroidBtn').disabled = false;
            } else if (message.type === 'connection_status') {
                // Handle connection status updates
                updateConnectionStatus(message);
            } else if (message.type === 'api_response') {
                // Handle API responses
                handleApiResponse(message);
            } else if (message.type === 'error') {
                // Handle error messages
                logMessage(`ë¸Œë¡œì»¤ ì˜¤ë¥˜: ${message.message}`, 'error');
            } else {
                // Handle other message types
                logMessage(`ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ íƒ€ì…: ${message.type}`, 'warning');
            }
        }

        // Auto-reconnect functionality
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        const reconnectDelay = 5000; // 5 seconds

        function attemptReconnect() {
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                logMessage(`ì¬ì—°ê²° ì‹œë„ ${reconnectAttempts}/${maxReconnectAttempts}...`, 'info');
                
                setTimeout(() => {
                    connectToBroker();
                }, reconnectDelay);
            } else {
                logMessage('ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì—°ê²°í•˜ì„¸ìš”.', 'error');
                reconnectAttempts = 0;
            }
        }

        // Reset reconnect attempts on successful connection
        function resetReconnectAttempts() {
            reconnectAttempts = 0;
        }

        // Enhanced broker WebSocket handlers
        brokerWebSocket?.addEventListener('open', resetReconnectAttempts);
        brokerWebSocket?.addEventListener('close', (event) => {
            if (event.code !== 1000) { // If not a normal closure
                attemptReconnect();
            }
        });

        // ========== Global variables for application state ==========
        let currentCoupons = [];
        let selectedCouponIds = [];

        // ========== Utility functions ==========

        // Date formatting
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleString('ko-KR');
            } catch (e) {
                return dateString;
            }
        }

        // Business number formatting
        function formatBusinessNumber(businessNumber) {
            if (!businessNumber || businessNumber.length !== 10) return businessNumber;
            return businessNumber.substring(0, 3) + '-' + businessNumber.substring(3, 5) + '-' + businessNumber.substring(5);
        }

        // Currency formatting
        function formatCurrencyInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value === '') {
                input.value = '';
                calculateDistribution();
                return;
            }
            let formattedValue = parseInt(value).toLocaleString();
            input.value = formattedValue;
            calculateDistribution();
        }

        // Point input formatting
        function formatPointInput(input) {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            
            if (pointType === 'percentage') {
                let value = input.value.replace(/[^\d.]/g, '');
                let parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                input.value = value;
            } else {
                let value = input.value.replace(/[^\d]/g, '');
                if (value === '') {
                    input.value = '';
                } else {
                    input.value = parseInt(value).toLocaleString();
                }
            }
            calculateDistribution();
        }

        // Get numeric value from formatted string
        function getNumericValue(formattedString) {
            if (!formattedString) return 0;
            return parseFloat(formattedString.replace(/,/g, '')) || 0;
        }

        // ========== Corporate Management Functions ==========

        async function loadAllCorporates() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const corporateList = document.getElementById('corporateList');
            corporateList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> ê±°ë˜ì²˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('ê±°ë˜ì²˜ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                displayCorporateList(corporates);
            } catch (error) {
                corporateList.innerHTML = `<p style="text-align: center; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
                logMessage('ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function displayCorporateList(corporates) {
            const corporateList = document.getElementById('corporateList');
            
            if (!corporates || corporates.length === 0) {
                corporateList.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = `<div style="margin-bottom: 10px; font-weight: bold; color: #667eea;">ì´ ${corporates.length}ê°œì˜ ê±°ë˜ì²˜</div>`;
            html += '<div style="display: grid; gap: 15px;">';
            
            corporates.forEach(corporate => {
                html += `
                    <div class="card" style="padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="color: #333; margin: 0 0 10px 0; font-size: 18px;">${corporate.name}</h4>
                                <div style="color: #666; font-size: 14px; line-height: 1.5;">
                                    ${corporate.businessNumber ? `<div><strong>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸:</strong> ${formatBusinessNumber(corporate.businessNumber)}</div>` : ''}
                                    ${corporate.representative ? `<div><strong>ëŒ€í‘œì:</strong> ${corporate.representative}</div>` : ''}
                                    ${corporate.phone ? `<div><strong>ì—°ë½ì²˜:</strong> ${corporate.phone}</div>` : ''}
                                    ${corporate.email ? `<div><strong>ì´ë©”ì¼:</strong> ${corporate.email}</div>` : ''}
                                    ${corporate.address ? `<div><strong>ì£¼ì†Œ:</strong> ${corporate.address}</div>` : ''}
                                    ${corporate.createdAt ? `<div style="margin-top: 10px; color: #999; font-size: 12px;"><strong>ë“±ë¡ì¼:</strong> ${formatDate(corporate.createdAt)}</div>` : ''}
                                </div>
                            </div>
                            <div style="margin-left: 20px;">
                                <button onclick="editCorporate(${corporate.customerId})" class="btn btn-success" style="padding: 8px 15px; font-size: 14px; margin-right: 5px;">ìˆ˜ì •</button>
                                <button onclick="deleteCorporate(${corporate.customerId}, '${corporate.name}')" class="btn btn-danger" style="padding: 8px 15px; font-size: 14px;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            corporateList.innerHTML = html;
        }

        async function searchCorporates() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('ê²€ìƒ‰í•  íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const corporateList = document.getElementById('corporateList');
            corporateList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> ê²€ìƒ‰ ì¤‘...</p>';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/search?name=${encodeURIComponent(searchTerm)}`);
                displayCorporateList(data);
            } catch (error) {
                corporateList.innerHTML = `<p style="text-align: center; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
                logMessage('ê±°ë˜ì²˜ ê²€ìƒ‰ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function showCreateCorporateForm() {
            // This would show a modal for creating corporates
            alert('ê±°ë˜ì²˜ ìƒì„± ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        async function editCorporate(corporateId) {
            // This would show a modal for editing corporates
            alert('ê±°ë˜ì²˜ ìˆ˜ì • ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        async function deleteCorporate(corporateId, corporateName) {
            if (!confirm(`ì •ë§ë¡œ "${corporateName}" ê±°ë˜ì²˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/corporates/${corporateId}`);
                alert('ê±°ë˜ì²˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadAllCorporates();
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
                logMessage('ê±°ë˜ì²˜ ì‚­ì œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== Employee Management Functions ==========

        async function loadCorporatesForEmployeeTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('ì§ì›íƒ­ ê±°ë˜ì²˜ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ì§ì›íƒ­ - ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('corporateSelectForEmployee');
                select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    option.dataset.corporateName = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`ì§ì›íƒ­ì— ${corporates.length}ê°œ ê±°ë˜ì²˜ ë¡œë“œ ì™„ë£Œ`, 'success');
                
                select.onchange = function() {
                    if (this.value) {
                        loadEmployeesByCorporate(this.value);
                        document.getElementById('addEmployeeBtn').disabled = false;
                        document.getElementById('bulkImportBtn').disabled = false;
                    } else {
                        document.getElementById('employeeList').innerHTML = '<p style="text-align: center; color: #666;">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ë©´ ì§ì› ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';
                        document.getElementById('addEmployeeBtn').disabled = true;
                        document.getElementById('bulkImportBtn').disabled = true;
                    }
                };
            } catch (error) {
                logMessage('ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                const select = document.getElementById('corporateSelectForEmployee');
                select.innerHTML = '<option value="">ì˜¤ë¥˜: ê±°ë˜ì²˜ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }

        async function loadEmployeesByCorporate(corporateId) {
            const employeeList = document.getElementById('employeeList');
            employeeList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> ì§ì› ëª©ë¡ ë¡œë”© ì¤‘...</p>';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                logMessage('ì§ì› ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract employees array from response
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ì§ì› ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                logMessage(`ê±°ë˜ì²˜ ${corporateId}ì˜ ì§ì› ${employees.length}ëª… ë¡œë“œ`, 'info');
                displayEmployeeList(employees);
            } catch (error) {
                employeeList.innerHTML = '<p style="text-align: center; color: red;">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                logMessage('ì§ì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function displayEmployeeList(employees) {
            const employeeList = document.getElementById('employeeList');
            
            if (!employees || employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            employees.forEach(employee => {
                html += `
                    <div class="card" style="padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">${employee.name || employee.phone}</h4>
                                <div style="color: #666; font-size: 14px;">
                                    <p style="margin: 5px 0;"><strong>ë¶€ì„œ:</strong> ${employee.department || '-'}</p>
                                    <p style="margin: 5px 0;"><strong>í•¸ë“œí°:</strong> ${employee.phone}</p>
                                    <p style="margin: 5px 0;"><strong>ì´ë©”ì¼:</strong> ${employee.email || '-'}</p>
                                    <p style="margin: 5px 0; font-size: 12px; color: #999;">ë“±ë¡ì¼: ${formatDate(employee.createdAt)}</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="editEmployee(${employee.employeeId})" class="btn btn-success" style="padding: 8px 15px; font-size: 14px;">ìˆ˜ì •</button>
                                <button onclick="deleteEmployee(${employee.employeeId}, '${employee.name}')" class="btn btn-danger" style="padding: 8px 15px; font-size: 14px;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            employeeList.innerHTML = html;
        }

        // ìƒˆ ì§ì› ì¶”ê°€ í¼ í‘œì‹œ
        function showCreateEmployeeForm() {
            const select = document.getElementById('corporateSelectForEmployee');
            const corporateId = select.value;
            const corporateName = select.options[select.selectedIndex].dataset.corporateName;
            
            if (!corporateId) {
                alert('ë¨¼ì € ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('employeeModalTitle').textContent = 'ìƒˆ ì§ì› ì¶”ê°€';
            document.getElementById('employeeId').value = '';
            document.getElementById('employeeCorporateId').value = corporateId;
            document.getElementById('employeeCorporateName').value = corporateName;
            document.getElementById('employeeName').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeEmail').value = '';
            document.getElementById('employeeDepartment').value = '';
            
            document.getElementById('employeeModal').style.display = 'block';
        }

        function showBulkImportForm() {
            alert('Excel ì¼ê´„ ë“±ë¡ ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ì§ì› ìˆ˜ì •
        async function editEmployee(employeeId) {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/employees/${employeeId}`);
                
                if (data.success || data) {
                    const employee = data.data || data;
                    const select = document.getElementById('corporateSelectForEmployee');
                    const corporateName = select.options[select.selectedIndex].dataset.corporateName;
                    
                    document.getElementById('employeeModalTitle').textContent = 'ì§ì› ì •ë³´ ìˆ˜ì •';
                    document.getElementById('employeeId').value = employee.employeeId;
                    document.getElementById('employeeCorporateId').value = employee.corporateId;
                    document.getElementById('employeeCorporateName').value = corporateName;
                    document.getElementById('employeeName').value = employee.name;
                    document.getElementById('employeePhone').value = employee.phone;
                    document.getElementById('employeeEmail').value = employee.email || '';
                    document.getElementById('employeeDepartment').value = employee.department || '';
                    
                    document.getElementById('employeeModal').style.display = 'block';
                } else {
                    alert('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
                logMessage('ì§ì› ì •ë³´ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        async function deleteEmployee(employeeId, employeeName) {
            if (!confirm(`ì •ë§ë¡œ "${employeeName}" ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/employees/${employeeId}`);
                alert('ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                const corporateId = document.getElementById('corporateSelectForEmployee').value;
                if (corporateId) {
                    loadEmployeesByCorporate(corporateId);
                }
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
                logMessage('ì§ì› ì‚­ì œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì§ì› ëª¨ë‹¬ ë‹«ê¸°
        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }

        // ì§ì› í¼ ì œì¶œ
        async function submitEmployeeForm(event) {
            event.preventDefault();
            
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const employeeId = document.getElementById('employeeId').value;
            const isUpdate = employeeId !== '';
            
            const employeeData = {
                corporateId: parseInt(document.getElementById('employeeCorporateId').value),
                name: document.getElementById('employeeName').value.trim(),
                phone: document.getElementById('employeePhone').value.trim(),
                email: document.getElementById('employeeEmail').value.trim(),
                department: document.getElementById('employeeDepartment').value.trim()
            };
            
            if (!employeeData.phone) {
                alert('í•¸ë“œí° ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì „í™”ë²ˆí˜¸ ì¤‘ë³µ ê²€ì‚¬ (ìƒˆ ì§ì› ë“±ë¡ ì‹œ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ë³€ê²½ ì‹œ)
            try {
                const checkResponse = await sendApiRequest('POST', '/api/employees/check-phone', { 
                    phone: employeeData.phone,
                    excludeEmployeeId: isUpdate ? employeeId : null
                });
                
                if (checkResponse.phoneExists) {
                    const existingEmployee = checkResponse.existingEmployee;
                    const corporateName = checkResponse.corporateName;
                    
                    const confirmMessage = `ì´ë¯¸ ë“±ë¡ëœ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.\n\n` +
                        `ë“±ë¡ëœ ì§ì› ì •ë³´:\n` +
                        `â€¢ ì´ë¦„: ${existingEmployee.name}\n` +
                        `â€¢ ì†Œì† ê±°ë˜ì²˜: ${corporateName}\n` +
                        `â€¢ ë¶€ì„œ: ${existingEmployee.department || 'ë¯¸ì§€ì •'}\n\n` +
                        `ê·¸ë˜ë„ ì´ ì „í™”ë²ˆí˜¸ë¡œ ì§ì›ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                    
                    if (!confirm(confirmMessage)) {
                        return; // ì‚¬ìš©ìê°€ ì·¨ì†Œë¥¼ ì„ íƒí•œ ê²½ìš°
                    }
                }
            } catch (error) {
                logMessage('ì „í™”ë²ˆí˜¸ ì¤‘ë³µ ê²€ì‚¬ ì‹¤íŒ¨: ' + error.message, 'warning');
                // ì¤‘ë³µ ê²€ì‚¬ ì‹¤íŒ¨ ì‹œì—ë„ ê³„ì† ì§„í–‰ (ì„œë²„ì—ì„œ ì²˜ë¦¬)
            }
            
            try {
                const url = isUpdate ? `/api/employees/${employeeId}` : '/api/employees';
                const method = isUpdate ? 'PUT' : 'POST';
                
                const data = await sendApiRequest(method, url, employeeData);
                
                if (data.success || data) {
                    // ê²½ê³  ë©”ì‹œì§€ê°€ ìˆëŠ” ê²½ìš° ë¨¼ì € í‘œì‹œ
                    if (data.warning) {
                        alert('ê²½ê³ : ' + data.warning + '\n\n' + (data.message || 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'));
                    } else {
                        alert(isUpdate ? 'ì§ì› ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                    closeEmployeeModal();
                    loadEmployeesByCorporate(employeeData.corporateId);
                } else {
                    alert('ì˜¤ë¥˜: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
                logMessage('ì§ì› ì €ì¥ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== Coupon Functions ==========

        async function loadCorporatesForCouponTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('ì¿ í°íƒ­ ê±°ë˜ì²˜ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ì¿ í°íƒ­ - ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('couponCorporateSelect');
                select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('ì¿ í° ë°œí–‰ìš© ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`ì¿ í°íƒ­ì— ${corporates.length}ê°œ ê±°ë˜ì²˜ ë¡œë“œ ì™„ë£Œ`, 'success');
            } catch (error) {
                logMessage('ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                const select = document.getElementById('couponCorporateSelect');
                select.innerHTML = '<option value="">ì˜¤ë¥˜: ê±°ë˜ì²˜ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }

        async function loadEmployeesForCoupon() {
            const corporateId = document.getElementById('couponCorporateSelect').value;
            const settingsPanel = document.getElementById('couponSettingsPanel');
            const instructions = document.getElementById('couponInstructions');

            if (!corporateId) {
                settingsPanel.style.display = 'none';
                instructions.style.display = 'block';
                couponEmployees = [];
                return;
            }

            instructions.style.display = 'none';
            settingsPanel.style.display = 'block';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                logMessage('ì¿ í° ë°œí–‰ìš© ì§ì› ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract employees array from response
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else {
                    logMessage('ì¿ í° ë°œí–‰ìš© ì§ì› - ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                couponEmployees = employees;
                logMessage(`ê±°ë˜ì²˜ì˜ ì§ì› ${employees.length}ëª…ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`, 'success');
            } catch (error) {
                alert('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                logMessage('ì§ì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function togglePointInput() {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointDescription = document.getElementById('pointDescription');
            const pointValue = document.getElementById('pointValue');
            
            if (pointType === 'percentage') {
                pointDescription.textContent = 'í˜„ê¸ˆ ì¶©ì „ì•¡ì˜ % ë§Œí¼ í¬ì¸íŠ¸ ì§€ê¸‰';
                pointValue.placeholder = '10';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'fixed') {
                pointDescription.textContent = 'ì¿ í° 1ì¥ë‹¹ ê³ ì • í¬ì¸íŠ¸ ì§€ê¸‰';
                pointValue.placeholder = '1,000';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'total') {
                pointDescription.textContent = 'ì´ í¬ì¸íŠ¸ë¥¼ ì§ì›ë“¤ì—ê²Œ ê· ë“± ë¶„ë°°';
                pointValue.placeholder = '100,000';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            }
            
            calculateDistribution();
        }

        function calculateDistribution() {
            if (couponEmployees.length === 0) {
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            
            const employeeCount = couponEmployees.length;
            const cashPerEmployee = totalCash / employeeCount;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee);
            updateDistributionSummary(totalCash, pointPerEmployee * employeeCount, employeeCount);
            
            document.getElementById('employeeDistributionPanel').style.display = 'block';
            
            const canIssue = totalCash > 0 && document.getElementById('expireDate').value;
            document.getElementById('issueCouponsBtn').disabled = !canIssue;
        }

        function updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee) {
            const tbody = document.getElementById('employeeDistributionBody');
            let html = '';
            
            couponEmployees.forEach(employee => {
                const displayName = employee.name || employee.phone;
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${displayName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.phone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.email || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #e53e3e;">
                            â‚©${cashPerEmployee.toLocaleString()}
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #38a169;">
                            ${pointPerEmployee.toLocaleString()}P
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function updateDistributionSummary(totalCash, totalPoints, employeeCount) {
            const summary = document.getElementById('distributionSummary');
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = document.getElementById('pointValue').value;
            
            let pointDescription = '';
            if (pointType === 'percentage') {
                pointDescription = `í˜„ê¸ˆì˜ ${pointValue}%`;
            } else if (pointType === 'fixed') {
                pointDescription = `ì¿ í°ë‹¹ ${pointValue.toLocaleString()}P`;
            } else if (pointType === 'total') {
                pointDescription = `ì´ ${pointValue.toLocaleString()}P ê· ë“±ë°°ë¶„`;
            }
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">ğŸ‘¥ ëŒ€ìƒ ì§ì›:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${employeeCount}ëª…</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">ğŸ’° ì´ í˜„ê¸ˆ:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">â‚©${totalCash.toLocaleString()}</span>
                    </div>
                    <div>
                        <strong style="color: #38a169;">ğŸ¯ ì´ í¬ì¸íŠ¸:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalPoints.toLocaleString()}P</span><br>
                        <small style="color: #666;">(${pointDescription})</small>
                    </div>
                    <div>
                        <strong style="color: #667eea;">ğŸ“Š ì§ì›ë‹¹ í‰ê· :</strong><br>
                        <span style="font-size: 14px;">í˜„ê¸ˆ: â‚©${(totalCash/employeeCount).toLocaleString()}</span><br>
                        <span style="font-size: 14px;">í¬ì¸íŠ¸: ${(totalPoints/employeeCount).toLocaleString()}P</span>
                    </div>
                </div>
            `;
        }

        function setExpireDate(months) {
            const today = new Date();
            const expireDate = new Date(today);
            expireDate.setMonth(expireDate.getMonth() + months);
            
            const formattedDate = expireDate.toISOString().split('T')[0];
            document.getElementById('expireDate').value = formattedDate;
            
            calculateDistribution();
        }

        function getAvailableDaysString() {
            const dayOrder = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
            let binaryString = '';
            
            for (const day of dayOrder) {
                const checkbox = document.querySelector(`.available-day[value="${day}"]`);
                binaryString += checkbox && checkbox.checked ? '1' : '0';
            }
            
            return binaryString;
        }

        async function issueCoupons() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            if (couponEmployees.length === 0) {
                alert('ë°œí–‰í•  ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            const expireDate = document.getElementById('expireDate').value;
            const availableDays = getAvailableDaysString();

            if (!totalCash || !expireDate) {
                alert('í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const employeeCount = couponEmployees.length;
            const cashPerEmployee = Math.round((totalCash / employeeCount) * 100) / 100;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            const corporateName = document.getElementById('couponCorporateSelect').options[document.getElementById('couponCorporateSelect').selectedIndex].textContent;
            
            if (!confirm(`${corporateName}ì˜ ${employeeCount}ëª… ì§ì›ì—ê²Œ ì¿ í°ì„ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
                        `â€¢ ì§ì›ë‹¹ í˜„ê¸ˆ: â‚©${cashPerEmployee.toLocaleString()}\n` +
                        `â€¢ ì§ì›ë‹¹ í¬ì¸íŠ¸: ${pointPerEmployee.toLocaleString()}P\n` +
                        `â€¢ ë§Œë£Œì¼: ${expireDate}`)) {
                return;
            }

            const issueBtn = document.getElementById('issueCouponsBtn');
            issueBtn.disabled = true;
            issueBtn.textContent = 'ë°œí–‰ ì¤‘...';
            
            let successCount = 0;
            let failCount = 0;
            const errors = [];

            try {
                for (let i = 0; i < couponEmployees.length; i++) {
                    const employee = couponEmployees[i];
                    
                    try {
                        const couponData = {
                            employeeId: employee.employeeId,
                            cashBalance: cashPerEmployee,
                            pointBalance: pointPerEmployee,
                            expireDate: expireDate,
                            status: 'ACTIVE',
                            paymentType: 'PREPAID',
                            availableDays: availableDays
                        };

                        await sendApiRequest('POST', '/api/coupons', couponData);
                        successCount++;
                    } catch (error) {
                        failCount++;
                        const displayName = employee.name || employee.phone;
                        errors.push(`${displayName}: ${error.message}`);
                    }

                    issueBtn.textContent = `ë°œí–‰ ì¤‘... (${i + 1}/${couponEmployees.length})`;
                }

                let message = `ì¿ í° ë°œí–‰ ì™„ë£Œ!\nì„±ê³µ: ${successCount}ê±´, ì‹¤íŒ¨: ${failCount}ê±´`;
                if (errors.length > 0) {
                    message += '\n\nì‹¤íŒ¨ ë‚´ì—­:\n' + errors.slice(0, 5).join('\n');
                    if (errors.length > 5) {
                        message += `\n... ì™¸ ${errors.length - 5}ê±´ ë”`;
                    }
                }

                alert(message);
                logMessage(`ì¿ í° ë°œí–‰ ì™„ë£Œ: ì„±ê³µ ${successCount}ê±´, ì‹¤íŒ¨ ${failCount}ê±´`, successCount > 0 ? 'success' : 'warning');

                if (successCount > 0) {
                    document.getElementById('totalCashAmount').value = '';
                    document.getElementById('pointValue').value = '';
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                }

            } catch (error) {
                alert('ì¿ í° ë°œí–‰ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì¿ í° ë°œí–‰ ì˜¤ë¥˜: ' + error.message, 'error');
            } finally {
                issueBtn.disabled = false;
                issueBtn.textContent = 'ğŸ« ì¿ í° ì¼ê´„ ë°œí–‰';
            }
        }

        // ========== Coupon Management Functions ==========

        async function loadAllCoupons() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const tbody = document.getElementById('couponListBody');
            tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 20px;"><span class="loading"></span> ì¿ í° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

            try {
                const data = await sendApiRequest('GET', '/api/coupons');
                logMessage('ì¿ í° ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract coupons array from response (similar to other data loading functions)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ì¿ í° ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                displayCouponList(coupons);
                logMessage(`ì¿ í° ${coupons.length}ê°œë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`, 'success');
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="11" style="text-align: center; padding: 20px; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</td></tr>`;
                logMessage('ì¿ í° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function displayCouponList(coupons) {
            currentCoupons = coupons;
            const tbody = document.getElementById('couponListBody');
            
            if (!coupons || coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 20px; color: #666;">ë“±ë¡ëœ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            let html = '';
            coupons.forEach(coupon => {
                const statusColor = coupon.status === 'ACTIVE' ? '#48bb78' : coupon.status === 'SUSPENDED' ? '#f6ad55' : '#f56565';
                const statusText = coupon.status === 'ACTIVE' ? 'ì‚¬ìš©ê°€ëŠ¥' : coupon.status === 'SUSPENDED' ? 'ì¼ì‹œì¤‘ì§€' : 'í•´ì§€ë¨';

                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <input type="checkbox" class="coupon-checkbox" value="${coupon.couponId}" onchange="updateSelectedCount()">
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${coupon.code || coupon.couponCode || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.corporateName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.recipientName || coupon.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.recipientPhone || coupon.employeePhone || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold;">â‚©${parseInt(coupon.cashBalance).toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold;">${parseInt(coupon.pointBalance).toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">${statusText}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; font-size: 12px;">${formatDate(coupon.expireDate)}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; font-size: 12px;">${formatDate(coupon.createdAt)}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="editCoupon(${coupon.couponId})" class="btn" style="padding: 4px 8px; font-size: 12px; margin-right: 4px; background: #4299e1; color: white;">ìˆ˜ì •</button>
                            <button onclick="deleteCoupon(${coupon.couponId})" class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.coupon-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = count;
            
            const bulkActions = document.getElementById('bulkActions');
            bulkActions.style.display = count > 0 ? 'block' : 'none';

            selectedCouponIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
        }

        function toggleAllCoupons() {
            const masterCheckbox = document.getElementById('selectAllCoupons');
            const checkboxes = document.querySelectorAll('.coupon-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = masterCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        async function searchCoupons() {
            const searchType = document.getElementById('couponSearchType').value;
            const searchValue = document.getElementById('couponSearchValue').value.trim();
            const statusFilter = document.getElementById('couponStatusFilter').value;

            if (!searchValue && !statusFilter) {
                alert('ê²€ìƒ‰ì–´ë‚˜ ìƒíƒœ í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                let endpoint = '/api/coupons/search?';
                const params = new URLSearchParams();
                
                if (searchValue) {
                    params.append(searchType, searchValue);
                }
                if (statusFilter) {
                    params.append('status', statusFilter);
                }

                const data = await sendApiRequest('GET', `/api/coupons/search?${params.toString()}`);
                
                // Extract coupons array from response (similar to other data loading functions)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ì¿ í° ê²€ìƒ‰ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                displayCouponList(coupons);
                logMessage(`ê²€ìƒ‰ ê²°ê³¼: ${coupons.length}ê°œ ì¿ í°`, 'info');
            } catch (error) {
                alert('ê²€ìƒ‰ ì‹¤íŒ¨: ' + error.message);
                logMessage('ì¿ í° ê²€ìƒ‰ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        async function editCoupon(couponId) {
            alert('ì¿ í° ìˆ˜ì • ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        async function deleteCoupon(couponId) {
            if (!confirm('ì •ë§ë¡œ ì´ ì¿ í°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/coupons/${couponId}`);
                alert('ì¿ í°ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadAllCoupons();
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
                logMessage('ì¿ í° ì‚­ì œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function showBulkStatusModal() {
            alert('ì¼ê´„ ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        function showBulkDeleteModal() {
            if (selectedCouponIds.length === 0) {
                alert('ì„ íƒëœ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            alert(`ì„ íƒëœ ${selectedCouponIds.length}ê°œ ì¿ í° ì¼ê´„ ì‚­ì œ ëª¨ë‹¬ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.`);
        }

        function exportSelectedToExcel() {
            alert('Excel ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ========== Coupon Sending Functions ==========

        // ì¿ í° ë°œì†¡ì„ ìœ„í•œ ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ
        async function loadCorporatesForSendTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('ë°œì†¡íƒ­ ê±°ë˜ì²˜ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ë°œì†¡íƒ­ - ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('sendCorporateSelect');
                select.innerHTML = '<option value="">ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('ë°œì†¡ìš© ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    option.dataset.corporateName = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`ë°œì†¡íƒ­ì— ${corporates.length}ê°œ ê±°ë˜ì²˜ ë¡œë“œ ì™„ë£Œ`, 'success');
                
            } catch (error) {
                logMessage('ë°œì†¡ìš© ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                const select = document.getElementById('sendCorporateSelect');
                select.innerHTML = '<option value="">ì˜¤ë¥˜: ê±°ë˜ì²˜ ë¡œë“œ ì‹¤íŒ¨</option>';
            }
        }

        // ë°œì†¡í•  ì¿ í° ëª©ë¡ ë¡œë“œ
        async function loadCouponsForSend() {
            const corporateId = document.getElementById('sendCorporateSelect').value;
            
            if (!corporateId) {
                document.getElementById('couponSendPanel').style.display = 'none';
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/coupons`);
                
                // Extract coupons array from response (similar to loadAllCoupons)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ë°œì†¡ìš© ì¿ í° ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                if (coupons && coupons.length > 0) {
                    displayCouponsForSend(coupons);
                    updateSendSummary(coupons);
                    document.getElementById('couponSendPanel').style.display = 'block';
                    logMessage(`ë°œì†¡ìš© ì¿ í° ${coupons.length}ê°œ ë¡œë“œ`, 'success');
                } else {
                    alert('í•´ë‹¹ ê±°ë˜ì²˜ì— ë°œì†¡í•  ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.');
                    document.getElementById('couponSendPanel').style.display = 'none';
                }
                
            } catch (error) {
                alert('ì¿ í° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
                logMessage('ë°œì†¡ìš© ì¿ í° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì¿ í° ë°œì†¡ ëª©ë¡ í‘œì‹œ
        function displayCouponsForSend(coupons) {
            const tbody = document.getElementById('couponSendBody');
            let html = '';
            
            coupons.forEach(coupon => {
                const recipientName = coupon.recipientName || coupon.employeeName || 'ì´ë¦„ ì—†ìŒ';
                const recipientPhone = coupon.recipientPhone || coupon.employeePhone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ';
                const recipientEmail = coupon.recipientEmail || coupon.employeeEmail || '';
                
                html += `
                    <tr id="couponRow_${coupon.couponId}">
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${coupon.fullCouponCode || coupon.couponCode || coupon.code || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientPhone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientEmail}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;" id="sendStatus_${coupon.couponId}">
                            <span style="color: #f6ad55;">â³ ëŒ€ê¸°</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="sendEmail(${coupon.couponId}, '${recipientEmail}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #e53e3e; color: white;" 
                                ${!recipientEmail ? 'disabled' : ''}>ğŸ“§</button>
                            <button onclick="sendSMS(${coupon.couponId}, '${recipientPhone}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #48bb78; color: white;">ğŸ“±</button>
                            <button onclick="sendKakao(${coupon.couponId}, '${recipientPhone}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #f6ad55; color: white;">ğŸ’¬</button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // ë°œì†¡ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSendSummary(coupons) {
            const summary = document.getElementById('sendSummary');
            const totalCount = coupons.length;
            const emailAvailable = coupons.filter(c => c.recipientEmail || c.employeeEmail).length;
            const phoneAvailable = coupons.filter(c => c.recipientPhone || c.employeePhone).length;
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">ğŸ« ì´ ì¿ í°:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalCount}ê°œ</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">ğŸ“§ ì´ë©”ì¼ ê°€ëŠ¥:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${emailAvailable}ê°œ</span>
                    </div>
                    <div>
                        <strong style="color: #48bb78;">ğŸ“± SMS ê°€ëŠ¥:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${phoneAvailable}ê°œ</span>
                    </div>
                    <div>
                        <strong style="color: #f6ad55;">ğŸ’¬ ì¹´ì¹´ì˜¤ ê°€ëŠ¥:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${phoneAvailable}ê°œ</span>
                    </div>
                </div>
            `;
        }

        // ê°œë³„ ì´ë©”ì¼ ë°œì†¡
        async function sendEmail(couponId, email) {
            if (!email) {
                alert('ì´ë©”ì¼ ì£¼ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">ğŸ“§ ë°œì†¡ì¤‘...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/email', {
                    couponId: couponId,
                    recipientEmail: email
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">âœ… ì´ë©”ì¼ ë°œì†¡ë¨</span>';
                    logMessage(`ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ: ì¿ í° ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                    logMessage(`ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ì¿ í° ${couponId} - ${data.message}`, 'error');
                    alert('ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                logMessage(`ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜: ì¿ í° ${couponId} - ${error.message}`, 'error');
                alert('ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ê°œë³„ SMS ë°œì†¡
        async function sendSMS(couponId, phone) {
            if (!phone) {
                alert('ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">ğŸ“± ë°œì†¡ì¤‘...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/sms', {
                    couponId: couponId,
                    recipientPhone: phone
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">âœ… SMS ë°œì†¡ë¨</span>';
                    logMessage(`SMS ë°œì†¡ ì„±ê³µ: ì¿ í° ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                    logMessage(`SMS ë°œì†¡ ì‹¤íŒ¨: ì¿ í° ${couponId} - ${data.message}`, 'error');
                    alert('SMS ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                logMessage(`SMS ë°œì†¡ ì˜¤ë¥˜: ì¿ í° ${couponId} - ${error.message}`, 'error');
                alert('SMS ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ê°œë³„ ì¹´ì¹´ì˜¤í†¡ ë°œì†¡
        async function sendKakao(couponId, phone) {
            if (!phone) {
                alert('ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">ğŸ’¬ ë°œì†¡ì¤‘...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/kakao', {
                    couponId: couponId,
                    recipientPhone: phone
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">âœ… ì¹´ì¹´ì˜¤ ë°œì†¡ë¨</span>';
                    logMessage(`ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ ì„±ê³µ: ì¿ í° ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                    logMessage(`ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ ì‹¤íŒ¨: ì¿ í° ${couponId} - ${data.message}`, 'error');
                    alert('ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">âŒ ë°œì†¡ ì‹¤íŒ¨</span>';
                logMessage(`ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ ì˜¤ë¥˜: ì¿ í° ${couponId} - ${error.message}`, 'error');
                alert('ì¹´ì¹´ì˜¤í†¡ ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ì „ì²´ ì´ë©”ì¼ ë°œì†¡
        async function sendAllEmails() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('ë¨¼ì € ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            if (!confirm('ì„ íƒí•œ ê±°ë˜ì²˜ì˜ ëª¨ë“  ì¿ í°ì— ëŒ€í•´ ì´ë©”ì¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/email/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`ì´ë©”ì¼ ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´, ì‹¤íŒ¨ ${data.failCount || 0}ê±´`);
                    loadCouponsForSend(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    logMessage(`ì´ë©”ì¼ ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´`, 'success');
                } else {
                    alert('ì´ë©”ì¼ ì¼ê´„ ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì´ë©”ì¼ ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì´ë©”ì¼ ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì „ì²´ SMS ë°œì†¡
        async function sendAllSMS() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('ë¨¼ì € ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            if (!confirm('ì„ íƒí•œ ê±°ë˜ì²˜ì˜ ëª¨ë“  ì¿ í°ì— ëŒ€í•´ SMSë¥¼ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/sms/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`SMS ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´, ì‹¤íŒ¨ ${data.failCount || 0}ê±´`);
                    loadCouponsForSend(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    logMessage(`SMS ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´`, 'success');
                } else {
                    alert('SMS ì¼ê´„ ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('SMS ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
                logMessage('SMS ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì „ì²´ ì¹´ì¹´ì˜¤í†¡ ë°œì†¡
        async function sendAllKakao() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('ë¨¼ì € ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            if (!confirm('ì„ íƒí•œ ê±°ë˜ì²˜ì˜ ëª¨ë“  ì¿ í°ì— ëŒ€í•´ ì¹´ì¹´ì˜¤í†¡ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/kakao/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`ì¹´ì¹´ì˜¤í†¡ ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´, ì‹¤íŒ¨ ${data.failCount || 0}ê±´`);
                    loadCouponsForSend(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    logMessage(`ì¹´ì¹´ì˜¤í†¡ ì¼ê´„ ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${data.successCount || 0}ê±´`, 'success');
                } else {
                    alert('ì¹´ì¹´ì˜¤í†¡ ì¼ê´„ ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì¹´ì¹´ì˜¤í†¡ ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì¹´ì¹´ì˜¤í†¡ ì¼ê´„ ë°œì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== Delivery History Functions ==========

        // ë°œì†¡ ê¸°ë¡ ë¡œë“œ
        async function loadDeliveryHistory() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const tbody = document.getElementById('deliveryHistoryBody');
            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;"><span class="loading"></span> ë°œì†¡ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

            try {
                const data = await sendApiRequest('GET', '/api/coupon-send/history');
                
                // Extract delivery history array from response
                let deliveryHistory = [];
                if (Array.isArray(data)) {
                    deliveryHistory = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    deliveryHistory = data.data;
                } else if (data && data.history && Array.isArray(data.history)) {
                    deliveryHistory = data.history;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ë°œì†¡ ê¸°ë¡ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                displayDeliveryHistory(deliveryHistory);
                updateDeliveryStats(deliveryHistory);
                logMessage(`ë°œì†¡ ê¸°ë¡ ${deliveryHistory.length}ê°œ ë¡œë“œ`, 'success');
                
            } catch (error) {
                if (error.message.includes('404') || error.message.includes('Not Found')) {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">ğŸ“­ ë°œì†¡ ê¸°ë¡ APIê°€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br><small>ë‚˜ì¤‘ì— êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.</small></td></tr>`;
                    logMessage('ë°œì†¡ ê¸°ë¡ API ì—†ìŒ: ' + error.message, 'warning');
                } else {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</td></tr>`;
                    logMessage('ë°œì†¡ ê¸°ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                }
            }
        }

        // ë°œì†¡ ê¸°ë¡ í‘œì‹œ
        function displayDeliveryHistory(history) {
            const tbody = document.getElementById('deliveryHistoryBody');
            
            if (!history || history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">ë°œì†¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            let html = '';
            history.forEach(record => {
                const typeColor = record.deliveryType === 'EMAIL' ? '#e53e3e' : record.deliveryType === 'SMS' ? '#48bb78' : '#f6ad55';
                const statusColor = record.deliveryStatus === 'SENT' ? '#48bb78' : record.deliveryStatus === 'FAILED' ? '#f56565' : '#f6ad55';
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${record.deliveryId}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${record.couponCode || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">
                            <span style="background: ${typeColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${record.deliveryType}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${record.recipientAddress || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;" title="${record.message || ''}">${(record.subject || record.message || '').substring(0, 20)}${(record.subject || record.message || '').length > 20 ? '...' : ''}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">
                            <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${record.deliveryStatus}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-size: 12px;">${formatDate(record.sentAt) || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="resendDelivery(${record.deliveryId})" class="btn" style="padding: 4px 8px; font-size: 12px; background: #4299e1; color: white;">ì¬ë°œì†¡</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // ë°œì†¡ í†µê³„ ì—…ë°ì´íŠ¸
        function updateDeliveryStats(history) {
            const stats = document.getElementById('deliveryStats');
            
            const totalCount = history.length;
            const emailCount = history.filter(h => h.deliveryType === 'EMAIL').length;
            const smsCount = history.filter(h => h.deliveryType === 'SMS').length;
            const kakaoCount = history.filter(h => h.deliveryType === 'KAKAO').length;
            const sentCount = history.filter(h => h.deliveryStatus === 'SENT').length;
            const failedCount = history.filter(h => h.deliveryStatus === 'FAILED').length;
            
            stats.innerHTML = `
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #2c5aa0;">ğŸ“Š ì´ ë°œì†¡</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #333;">${totalCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #48bb78;">âœ… ì„±ê³µ</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #48bb78;">${sentCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #f56565;">âŒ ì‹¤íŒ¨</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #f56565;">${failedCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #667eea;">ğŸ“§ ì´ë©”ì¼</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #e53e3e;">${emailCount}</div>
                </div>
            `;
        }

        // ë°œì†¡ ê¸°ë¡ í•„í„°
        async function filterDeliveryHistory() {
            // í•„í„° ê¸°ëŠ¥ êµ¬í˜„ (placeholder)
            alert('ë°œì†¡ ê¸°ë¡ í•„í„° ê¸°ëŠ¥ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ì¬ë°œì†¡
        async function resendDelivery(deliveryId) {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            if (!confirm('ì´ ë°œì†¡ì„ ë‹¤ì‹œ ì‹œë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', `/api/delivery-history/${deliveryId}/resend`);

                if (data.success || data) {
                    alert('ì¬ë°œì†¡ì´ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadDeliveryHistory(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    logMessage(`ë°œì†¡ ì¬ì‹œë„: ${deliveryId}`, 'success');
                } else {
                    alert('ì¬ë°œì†¡ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì¬ë°œì†¡ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì¬ë°œì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== Email Configuration Functions ==========

        // ì´ë©”ì¼ ì„¤ì • í”„ë¦¬ì…‹ ì ìš©
        function applyGmailPreset() {
            document.getElementById('smtpHost').value = 'smtp.gmail.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Gmail ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        }

        function applyOutlookPreset() {
            document.getElementById('smtpHost').value = 'smtp-mail.outlook.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Outlook ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        }

        function applyYahooPreset() {
            document.getElementById('smtpHost').value = 'smtp.mail.yahoo.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Yahoo ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        }

        function applyNaverPreset() {
            document.getElementById('smtpHost').value = 'smtp.naver.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Naver ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        }

        function applyEcountPreset() {
            alert('Ecount ì„¤ì • í”„ë¦¬ì…‹ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ì´ë©”ì¼ ì„¤ì • ì €ì¥
        async function saveEmailConfig() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const emailConfig = {
                smtpHost: document.getElementById('smtpHost').value,
                smtpPort: parseInt(document.getElementById('smtpPort').value),
                security: document.querySelector('input[name="security"]:checked').value,
                username: document.getElementById('smtpUsername').value,
                password: document.getElementById('smtpPassword').value
            };

            if (!emailConfig.smtpHost || !emailConfig.smtpPort || !emailConfig.username || !emailConfig.password) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/email', emailConfig);

                if (data.success || data) {
                    alert('ì´ë©”ì¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    logMessage('ì´ë©”ì¼ ì„¤ì • ì €ì¥ ì™„ë£Œ', 'success');
                } else {
                    alert('ì´ë©”ì¼ ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì´ë©”ì¼ ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì´ë©”ì¼ ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì´ë©”ì¼ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadEmailConfig() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('GET', '/api/config/email');

                if (data.success || data) {
                    const config = data.data || data;
                    document.getElementById('smtpHost').value = config.smtpHost || '';
                    document.getElementById('smtpPort').value = config.smtpPort || '';
                    document.getElementById('smtpUsername').value = config.username || '';
                    document.getElementById('smtpPassword').value = config.password || '';
                    
                    if (config.security) {
                        const securityRadio = document.querySelector(`input[name="security"][value="${config.security}"]`);
                        if (securityRadio) securityRadio.checked = true;
                    }

                    alert('ì´ë©”ì¼ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                    logMessage('ì´ë©”ì¼ ì„¤ì • ë¡œë“œ ì™„ë£Œ', 'success');
                } else {
                    alert('ì´ë©”ì¼ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ì´ë©”ì¼ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì´ë©”ì¼ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testEmailConnection() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/email/test');

                if (data.success || data) {
                    alert('ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!');
                    logMessage('ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                } else {
                    alert('ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì´ë©”ì¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== SMS Configuration Functions ==========

        // SMS ì„¤ì • ì €ì¥
        async function saveSmsConfig() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const smsConfig = {
                apiUrl: document.getElementById('smsApiUrl').value,
                senderNumber: document.getElementById('smsSenderNumber').value,
                senderName: document.getElementById('smsSenderName').value,
                testMode: document.getElementById('smsTestMode').checked
            };

            if (!smsConfig.apiUrl || !smsConfig.senderNumber) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/sms', smsConfig);

                if (data.success || data) {
                    alert('SMS ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    logMessage('SMS ì„¤ì • ì €ì¥ ì™„ë£Œ', 'success');
                } else {
                    alert('SMS ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('SMS ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message);
                logMessage('SMS ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // SMS ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSmsConfig() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('GET', '/api/config/sms');

                if (data.success || data) {
                    const config = data.data || data;
                    document.getElementById('smsApiUrl').value = config.apiUrl || '';
                    document.getElementById('smsSenderNumber').value = config.senderNumber || '';
                    document.getElementById('smsSenderName').value = config.senderName || '';
                    document.getElementById('smsTestMode').checked = config.testMode || false;

                    alert('SMS ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                    logMessage('SMS ì„¤ì • ë¡œë“œ ì™„ë£Œ', 'success');
                } else {
                    alert('SMS ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('SMS ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
                logMessage('SMS ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // SMS ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testSmsConnection() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/sms/test');

                if (data.success || data) {
                    alert('SMS ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!');
                    logMessage('SMS ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                } else {
                    alert('SMS ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('SMS ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message);
                logMessage('SMS ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== Coupon Distribution Functions ==========

        // ì¿ í° ë°œí–‰ì„ ìœ„í•œ ì§ì› ëª©ë¡ ë¡œë“œ
        async function loadEmployeesForCoupon() {
            const corporateId = document.getElementById('couponCorporateSelect').value;
            
            if (!corporateId) {
                document.getElementById('couponSettingsPanel').style.display = 'none';
                document.getElementById('employeeDistributionPanel').style.display = 'none';
                return;
            }

            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                
                // Extract employees array from response (similar to other employee loading functions)
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ ì§ì› ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                if (employees && employees.length > 0) {
                    couponEmployees = employees;
                    document.getElementById('couponSettingsPanel').style.display = 'block';
                    calculateDistribution();
                    logMessage(`ì¿ í° ë°œí–‰ìš© ì§ì› ${employees.length}ëª… ë¡œë“œ`, 'success');
                } else {
                    alert('í•´ë‹¹ ê±°ë˜ì²˜ì— ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.');
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                }
                
            } catch (error) {
                alert('ì§ì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì¿ í° ë°œí–‰ìš© ì§ì› ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // í¬ì¸íŠ¸ ì…ë ¥ ë°©ì‹ í† ê¸€
        function togglePointInput() {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointDescription = document.getElementById('pointDescription');
            const pointValue = document.getElementById('pointValue');
            
            if (pointType === 'percentage') {
                pointDescription.textContent = 'í˜„ê¸ˆ ì¶©ì „ì•¡ì˜ % ë§Œí¼ í¬ì¸íŠ¸ ì§€ê¸‰';
                pointValue.placeholder = '10';
                // ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ í¬ë§· ë‹¤ì‹œ ì ìš©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'fixed') {
                pointDescription.textContent = 'ì¿ í° 1ì¥ë‹¹ ê³ ì • í¬ì¸íŠ¸ ì§€ê¸‰';
                pointValue.placeholder = '1,000';
                // ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ í¬ë§· ë‹¤ì‹œ ì ìš©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'total') {
                pointDescription.textContent = 'ì´ í¬ì¸íŠ¸ë¥¼ ì§ì›ë“¤ì—ê²Œ ê· ë“± ë¶„ë°°';
                pointValue.placeholder = '100,000';
                // ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ í¬ë§· ë‹¤ì‹œ ì ìš©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            }
            
            calculateDistribution();
        }

        // ì²œë‹¨ìœ„ ì½¤ë§ˆ í¬ë§·íŒ… í•¨ìˆ˜
        function formatCurrencyInput(input) {
            // ì…ë ¥ê°’ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
            let value = input.value.replace(/[^\d]/g, '');
            
            // ë¹ˆ ê°’ ì²˜ë¦¬
            if (value === '') {
                input.value = '';
                calculateDistribution();
                return;
            }
            
            // ì²œë‹¨ìœ„ë§ˆë‹¤ ì½¤ë§ˆ ì¶”ê°€
            let formattedValue = parseInt(value).toLocaleString();
            input.value = formattedValue;
            
            // ë°°ë¶„ ì¬ê³„ì‚°
            calculateDistribution();
        }

        // í¬ì¸íŠ¸ ì…ë ¥ í¬ë§·íŒ… í•¨ìˆ˜ (ì •ë¥ ì¼ ë•ŒëŠ” ì†Œìˆ˜ì  í—ˆìš©, ì •ì•¡/ì´í¬ì¸íŠ¸ì¼ ë•ŒëŠ” ì½¤ë§ˆ í‘œì‹œ)
        function formatPointInput(input) {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            
            if (pointType === 'percentage') {
                // ì •ë¥ ì¼ ë•ŒëŠ” ì†Œìˆ˜ì  í—ˆìš©, ì½¤ë§ˆ ì—†ìŒ
                let value = input.value.replace(/[^\d.]/g, '');
                // ì†Œìˆ˜ì ì´ ì—¬ëŸ¬ ê°œ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ë§Œ ìœ ì§€
                let parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                input.value = value;
            } else {
                // ì •ì•¡/ì´í¬ì¸íŠ¸ì¼ ë•ŒëŠ” ì²œë‹¨ìœ„ ì½¤ë§ˆ ì ìš©
                let value = input.value.replace(/[^\d]/g, '');
                if (value === '') {
                    input.value = '';
                } else {
                    input.value = parseInt(value).toLocaleString();
                }
            }
            
            calculateDistribution();
        }

        // ì½¤ë§ˆê°€ í¬í•¨ëœ ë¬¸ìì—´ì—ì„œ ìˆ«ìê°’ ì¶”ì¶œ
        function getNumericValue(formattedString) {
            if (!formattedString) return 0;
            return parseFloat(formattedString.replace(/,/g, '')) || 0;
        }

        // ë°°ë¶„ ê³„ì‚°
        function calculateDistribution() {
            if (couponEmployees.length === 0) {
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            
            const employeeCount = couponEmployees.length;
            const cashPerEmployee = totalCash / employeeCount;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100; // ì†Œìˆ˜ì  2ìë¦¬
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                // ì´ í¬ì¸íŠ¸ë¥¼ ì§ì› ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ê· ë“± ë°°ë¶„
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee);
            
            // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            updateDistributionSummary(totalCash, pointPerEmployee * employeeCount, employeeCount);
            
            // íŒ¨ë„ í‘œì‹œ
            document.getElementById('employeeDistributionPanel').style.display = 'block';
            
            // ë°œí–‰ ë²„íŠ¼ í™œì„±í™” ì¡°ê±´ ì²´í¬
            const canIssue = totalCash > 0 && document.getElementById('expireDate').value;
            document.getElementById('issueCouponsBtn').disabled = !canIssue;
        }

        // ì§ì›ë³„ ë°°ë¶„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee) {
            const tbody = document.getElementById('employeeDistributionBody');
            let html = '';
            
            couponEmployees.forEach(employee => {
                const displayName = employee.name || employee.phone;
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${displayName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.phone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.email || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #e53e3e;">
                            â‚©${cashPerEmployee.toLocaleString()}
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #38a169;">
                            ${pointPerEmployee.toLocaleString()}P
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // ë°°ë¶„ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDistributionSummary(totalCash, totalPoints, employeeCount) {
            const summary = document.getElementById('distributionSummary');
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = document.getElementById('pointValue').value;
            
            let pointDescription = '';
            if (pointType === 'percentage') {
                pointDescription = `í˜„ê¸ˆì˜ ${pointValue}%`;
            } else if (pointType === 'fixed') {
                pointDescription = `ì¿ í°ë‹¹ ${pointValue.toLocaleString()}P`;
            } else if (pointType === 'total') {
                pointDescription = `ì´ ${pointValue.toLocaleString()}P ê· ë“±ë°°ë¶„`;
            }
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">ğŸ‘¥ ëŒ€ìƒ ì§ì›:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${employeeCount}ëª…</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">ğŸ’° ì´ í˜„ê¸ˆ:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">â‚©${totalCash.toLocaleString()}</span>
                    </div>
                    <div>
                        <strong style="color: #38a169;">ğŸ¯ ì´ í¬ì¸íŠ¸:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalPoints.toLocaleString()}P</span><br>
                        <small style="color: #666;">(${pointDescription})</small>
                    </div>
                    <div>
                        <strong style="color: #667eea;">ğŸ“Š ì§ì›ë‹¹ í‰ê· :</strong><br>
                        <span style="font-size: 14px;">í˜„ê¸ˆ: â‚©${(totalCash/employeeCount).toLocaleString()}</span><br>
                        <span style="font-size: 14px;">í¬ì¸íŠ¸: ${(totalPoints/employeeCount).toLocaleString()}P</span>
                    </div>
                </div>
            `;
        }

        // ë§Œë£Œì¼ ì„¤ì • í•¨ìˆ˜
        function setExpireDate(months) {
            const today = new Date();
            today.setMonth(today.getMonth() + months);
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('expireDate').value = dateString;
            
            // ë°°ë¶„ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            calculateDistribution();
        }

        // ì‚¬ìš© ê°€ëŠ¥ ìš”ì¼ ë¬¸ìì—´ ìƒì„± (7ìë¦¬ 0ê³¼ 1ë¡œ êµ¬ì„±ëœ ë¬¸ìì—´)
        // ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí†  ìˆœì„œë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ë©´ 1, ë¶ˆê°€ëŠ¥í•˜ë©´ 0
        function getAvailableDaysString() {
            const dayOrder = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
            let binaryString = '';
            
            for (const day of dayOrder) {
                const checkbox = document.querySelector(`.available-day[value="${day}"]`);
                binaryString += checkbox && checkbox.checked ? '1' : '0';
            }
            
            return binaryString;
        }

        // ì¿ í° ì¼ê´„ ë°œí–‰
        async function issueCoupons() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (couponEmployees.length === 0) {
                alert('ë°œí–‰í•  ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            const expireDate = document.getElementById('expireDate').value;
            const availableDays = getAvailableDaysString();

            if (!totalCash || !expireDate) {
                alert('í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const employeeCount = couponEmployees.length;
            const cashPerEmployee = Math.round((totalCash / employeeCount) * 100) / 100;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            const corporateName = document.getElementById('couponCorporateSelect').options[document.getElementById('couponCorporateSelect').selectedIndex].textContent;
            
            if (!confirm(`${corporateName}ì˜ ${employeeCount}ëª… ì§ì›ì—ê²Œ ì¿ í°ì„ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
                        `â€¢ ì§ì›ë‹¹ í˜„ê¸ˆ: â‚©${cashPerEmployee.toLocaleString()}\n` +
                        `â€¢ ì§ì›ë‹¹ í¬ì¸íŠ¸: ${pointPerEmployee.toLocaleString()}P\n` +
                        `â€¢ ë§Œë£Œì¼: ${expireDate}`)) {
                return;
            }

            const issueBtn = document.getElementById('issueCouponsBtn');
            
            issueBtn.disabled = true;
            issueBtn.textContent = 'ë°œí–‰ ì¤‘...';
            
            let successCount = 0;
            let failCount = 0;
            const errors = [];

            try {
                for (let i = 0; i < couponEmployees.length; i++) {
                    const employee = couponEmployees[i];
                    
                    try {
                        // ì¿ í° ë°ì´í„° ì¤€ë¹„
                        // Full coupon codeëŠ” ì„œë²„ì—ì„œ ìë™ ìƒì„±ë¨:
                        // {ë°œê¸‰ì_ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸}-{ì‚¬ìš©ê°€ëŠ¥ìš”ì¼(7ìë¦¬)}-{coupon_id(10ìë¦¬)}-{ê²°ì œìœ í˜•ì½”ë“œ}-{íŒ¨ë¦¬í‹°(3ìë¦¬)}
                        const couponData = {
                            employeeId: employee.employeeId,
                            cashBalance: cashPerEmployee,
                            pointBalance: pointPerEmployee,
                            expireDate: expireDate,
                            status: 'ACTIVE',
                            paymentType: 'PREPAID',  // ê²°ì œìœ í˜•: PREPAID(1) or POSTPAID(2)
                            availableDays: availableDays  // 7ìë¦¬ ì´ì§„ ë¬¸ìì—´ (ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† )
                        };

                        const data = await sendApiRequest('POST', '/api/coupons', couponData);

                        if (data.success || data) {
                            successCount++;
                            logMessage(`ì¿ í° ë°œí–‰ ì„±ê³µ: ${employee.name || employee.phone}`, 'success');
                        } else {
                            failCount++;
                            const displayName = employee.name || employee.phone;
                            errors.push(`${displayName}: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                            logMessage(`ì¿ í° ë°œí–‰ ì‹¤íŒ¨: ${displayName} - ${data.message}`, 'error');
                        }
                    } catch (error) {
                        failCount++;
                        const displayName = employee.name || employee.phone;
                        errors.push(`${displayName}: ${error.message}`);
                        logMessage(`ì¿ í° ë°œí–‰ ì˜¤ë¥˜: ${displayName} - ${error.message}`, 'error');
                    }

                    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                    issueBtn.textContent = `ë°œí–‰ ì¤‘... (${i + 1}/${couponEmployees.length})`;
                }

                // ê²°ê³¼ ì•Œë¦¼
                let message = `ì¿ í° ë°œí–‰ ì™„ë£Œ!\nì„±ê³µ: ${successCount}ê±´, ì‹¤íŒ¨: ${failCount}ê±´`;
                if (errors.length > 0) {
                    message += '\n\nì‹¤íŒ¨ ë‚´ì—­:\n' + errors.slice(0, 5).join('\n');
                    if (errors.length > 5) {
                        message += `\n... ì™¸ ${errors.length - 5}ê±´ ë”`;
                    }
                }

                alert(message);

                if (successCount > 0) {
                    // ì„±ê³µ ì‹œ í¼ ë¦¬ì…‹
                    document.getElementById('totalCashAmount').value = '';
                    document.getElementById('pointValue').value = '';
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                    
                    logMessage(`ì¿ í° ì¼ê´„ ë°œí–‰ ì™„ë£Œ - ì„±ê³µ: ${successCount}ê±´, ì‹¤íŒ¨: ${failCount}ê±´`, 'success');
                }

            } catch (error) {
                alert('ì¿ í° ë°œí–‰ ì˜¤ë¥˜: ' + error.message);
                logMessage('ì¿ í° ë°œí–‰ ì‹œìŠ¤í…œ ì˜¤ë¥˜: ' + error.message, 'error');
            } finally {
                issueBtn.disabled = false;
                issueBtn.textContent = 'ğŸ« ì¿ í° ì¼ê´„ ë°œí–‰';
            }
        }

        // ========== System Settings Functions ==========

        function toggleTimeBasedControls() {
            const checkbox = document.getElementById('enableTimeBasedDeduction');
            const controls = document.getElementById('timeBasedControls');
            
            if (checkbox.checked) {
                controls.style.opacity = '1';
                controls.style.pointerEvents = 'auto';
            } else {
                controls.style.opacity = '0.5';
                controls.style.pointerEvents = 'none';
            }
        }

        async function loadSystemSettings() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            try {
                const settings = await sendApiRequest('GET', '/api/system/settings');
                applySettingsToUI(settings);
                logMessage('ì‹œìŠ¤í…œ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
                alert('ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
                logMessage('ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        async function saveSystemSettings() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const settings = {
                enable_time_based_deduction: document.getElementById('enableTimeBasedDeduction').checked.toString(),
                breakfast_start_time: document.getElementById('breakfastStartTime').value,
                breakfast_end_time: document.getElementById('breakfastEndTime').value,
                breakfast_cash_deduction: document.getElementById('breakfastCashDeduction').value,
                lunch_start_time: document.getElementById('lunchStartTime').value,
                lunch_end_time: document.getElementById('lunchEndTime').value,
                lunch_cash_deduction: document.getElementById('lunchCashDeduction').value,
                dinner_start_time: document.getElementById('dinnerStartTime').value,
                dinner_end_time: document.getElementById('dinnerEndTime').value,
                dinner_cash_deduction: document.getElementById('dinnerCashDeduction').value,
                default_cash_deduction: document.getElementById('defaultCashDeduction').value,
                point_deduction_method: document.getElementById('pointDeductionMethod').value,
                allow_negative_balance: document.getElementById('allowNegativeBalance').checked.toString()
            };

            try {
                await sendApiRequest('POST', '/api/system/settings', settings);
                alert('ì‹œìŠ¤í…œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                logMessage('ì‹œìŠ¤í…œ ì„¤ì •ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
                alert('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + error.message);
                logMessage('ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function applySettingsToUI(settings) {
            document.getElementById('enableTimeBasedDeduction').checked = settings.enable_time_based_deduction === 'true';
            document.getElementById('breakfastStartTime').value = settings.breakfast_start_time || '06:00';
            document.getElementById('breakfastEndTime').value = settings.breakfast_end_time || '10:59';
            document.getElementById('breakfastCashDeduction').value = settings.breakfast_cash_deduction || '3000';
            document.getElementById('lunchStartTime').value = settings.lunch_start_time || '11:00';
            document.getElementById('lunchEndTime').value = settings.lunch_end_time || '14:59';
            document.getElementById('lunchCashDeduction').value = settings.lunch_cash_deduction || '5000';
            document.getElementById('dinnerStartTime').value = settings.dinner_start_time || '15:00';
            document.getElementById('dinnerEndTime').value = settings.dinner_end_time || '21:59';
            document.getElementById('dinnerCashDeduction').value = settings.dinner_cash_deduction || '7000';
            document.getElementById('defaultCashDeduction').value = settings.default_cash_deduction || '1000';
            document.getElementById('pointDeductionMethod').value = settings.point_deduction_method || 'í›„ìˆœìœ„';
            document.getElementById('allowNegativeBalance').checked = settings.allow_negative_balance === 'true';
            
            toggleTimeBasedControls();
        }

        function testCurrentDeduction() {
            alert('ì°¨ê°ì•¡ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
        }


        // ========== Management Information Functions ==========

        // Tab switching functionality
        function showManagementTab(tabName) {
            // Hide all tabs
            document.getElementById('statisticsTab').style.display = 'none';
            document.getElementById('monthlyReportTab').style.display = 'none';
            
            // Remove active class from all buttons
            document.getElementById('statisticsTabBtn').classList.remove('active');
            document.getElementById('monthlyReportTabBtn').classList.remove('active');
            
            // Show selected tab and activate button
            document.getElementById(tabName + 'Tab').style.display = 'block';
            document.getElementById(tabName + 'TabBtn').classList.add('active');
            
            // Initialize tab-specific data
            if (tabName === 'monthlyReport') {
                initializeMonthlyReport();
            }
            
            logMessage(`ê²½ì˜ì •ë³´ íƒ­ ì „í™˜: ${tabName}`, 'info');
        }

        // Set current month in date pickers
        function setCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            
            document.getElementById('statsStartDate').value = `${year}-${month}-01`;
            
            // Calculate last day of current month
            const lastDay = new Date(year, now.getMonth() + 1, 0).getDate();
            document.getElementById('statsEndDate').value = `${year}-${month}-${String(lastDay).padStart(2, '0')}`;
            
            logMessage('ë‚ ì§œ ë²”ìœ„ë¥¼ í˜„ì¬ ì›”ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // Load management statistics
        async function loadManagementStats() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const tbody = document.getElementById('corporateStatsBody');
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px;"><span class="loading"></span> í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

            try {
                const data = await sendApiRequest('GET', `/api/statistics/corporate?startDate=${startDate}&endDate=${endDate}`);
                logMessage('í†µê³„ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data), 'info');
                
                // Extract stats array from response
                let statsData = [];
                if (Array.isArray(data)) {
                    statsData = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    statsData = data.data;
                } else if (data && data.statistics && Array.isArray(data.statistics)) {
                    statsData = data.statistics;
                } else {
                    logMessage('ì˜ˆìƒí•˜ì§€ ëª»í•œ í†µê³„ ì‘ë‹µ í˜•ì‹: ' + JSON.stringify(data), 'warning');
                }
                
                displayManagementStats(statsData);
                logMessage(`í†µê³„ ë°ì´í„° ${statsData.length}ê°œ ë¡œë“œ`, 'success');
                
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</td></tr>`;
                logMessage('í†µê³„ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                
                // Reset summary stats on error
                document.getElementById('totalCorporates').textContent = '0';
                document.getElementById('totalIssuedCoupons').textContent = '0';
                document.getElementById('totalUsedCoupons').textContent = '0';
                document.getElementById('overallUsageRate').textContent = '0%';
            }
        }

        // Display management statistics
        function displayManagementStats(statsData) {
            let totalCorporates = 0;
            let totalIssued = 0;
            let totalUsed = 0;
            let totalCash = 0;
            let totalPoints = 0;
            
            const tbody = document.getElementById('corporateStatsBody');
            
            if (!statsData || statsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px; color: #666;">ì„ íƒí•œ ê¸°ê°„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            let html = '';
            
            statsData.forEach(corporate => {
                const issued = corporate.issuedCoupons || 0;
                const used = corporate.usedCoupons || 0;
                const unused = issued - used;
                const usageRate = issued > 0 ? Math.round((used / issued) * 100) : 0;
                const cashValue = corporate.totalCashValue || 0;
                const pointValue = corporate.totalPointValue || 0;
                
                totalCorporates++;
                totalIssued += issued;
                totalUsed += used;
                totalCash += cashValue;
                totalPoints += pointValue;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${corporate.name}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${corporate.employeeCount || 0}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${issued.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${used.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${unused.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="color: ${usageRate >= 70 ? '#48bb78' : usageRate >= 40 ? '#f6ad55' : '#f56565'}; font-weight: bold;">
                                ${usageRate}%
                            </span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashValue.toLocaleString()}ì›</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointValue.toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="showCorporateDetail(${corporate.customerId || corporate.id}, '${corporate.name}')" class="btn btn-sm" style="background: #4299e1; color: white; padding: 5px 10px; font-size: 12px;">ìƒì„¸ë³´ê¸°</button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Update summary statistics
            const overallUsageRate = totalIssued > 0 ? Math.round((totalUsed / totalIssued) * 100) : 0;
            
            document.getElementById('totalCorporates').textContent = totalCorporates.toLocaleString();
            document.getElementById('totalIssuedCoupons').textContent = totalIssued.toLocaleString();
            document.getElementById('totalUsedCoupons').textContent = totalUsed.toLocaleString();
            document.getElementById('overallUsageRate').textContent = overallUsageRate + '%';
        }

        // Show corporate detail modal
        async function showCorporateDetail(corporateId, corporateName) {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }

            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            document.getElementById('corporateDetailTitle').textContent = `${corporateName} ìƒì„¸ í†µê³„`;
            document.getElementById('corporateDetailContent').innerHTML = '<div style="text-align: center; padding: 40px;"><span class="loading"></span> ë°ì´í„° ë¡œë”© ì¤‘...</div>';
            document.getElementById('corporateDetailModal').style.display = 'block';

            try {
                const data = await sendApiRequest('GET', `/api/statistics/corporate/${corporateId}?startDate=${startDate}&endDate=${endDate}`);
                
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                }
                
                displayCorporateDetail(employees, corporateName);
                
            } catch (error) {
                document.getElementById('corporateDetailContent').innerHTML = `<div style="text-align: center; padding: 40px; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
                logMessage('ê±°ë˜ì²˜ ìƒì„¸ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // Display corporate detail data
        function displayCorporateDetail(employees, corporateName) {
            if (!employees || employees.length === 0) {
                document.getElementById('corporateDetailContent').innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ì„ íƒí•œ ê¸°ê°„ì— í•´ë‹¹ ê±°ë˜ì²˜ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = `
                <div style="max-height: 500px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ì§ì›ëª…</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ë°œí–‰</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì‚¬ìš©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ë¯¸ì‚¬ìš©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ì‚¬ìš©ë¥ </th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í˜„ê¸ˆ ì”ì•¡</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">í¬ì¸íŠ¸ ì”ì•¡</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            employees.forEach(employee => {
                const issued = employee.issuedCoupons || 0;
                const used = employee.usedCoupons || 0;
                const unused = issued - used;
                const usageRate = issued > 0 ? Math.round((used / issued) * 100) : 0;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.name || employee.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${issued}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${used}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${unused}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="color: ${usageRate >= 70 ? '#48bb78' : usageRate >= 40 ? '#f6ad55' : '#f56565'}; font-weight: bold;">
                                ${usageRate}%
                            </span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${(employee.cashBalance || 0).toLocaleString()}ì›</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${(employee.pointBalance || 0).toLocaleString()}P</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('corporateDetailContent').innerHTML = html;
        }

        // Close corporate detail modal
        function closeCorporateDetailModal() {
            document.getElementById('corporateDetailModal').style.display = 'none';
        }

        // Export statistics to Excel
        function exportStatsToExcel() {
            const table = document.getElementById('corporateStatsTable');
            const tbody = document.getElementById('corporateStatsBody');
            
            if (!tbody.children.length || tbody.innerHTML.includes('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”') || tbody.innerHTML.includes('ì˜¤ë¥˜')) {
                alert('ë¨¼ì € í†µê³„ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì„¸ìš”.');
                return;
            }
            
            let csv = '\uFEFF'; // BOM for Korean characters
            csv += 'ê±°ë˜ì²˜ëª…,ì§ì› ìˆ˜,ë°œí–‰,ì‚¬ìš©,ë¯¸ì‚¬ìš©,ì‚¬ìš©ë¥ ,í˜„ê¸ˆ ê°€ì¹˜,í¬ì¸íŠ¸ ê°€ì¹˜\n';
            
            Array.from(tbody.children).forEach(row => {
                if (row.children.length >= 8) {
                    const cols = Array.from(row.children).slice(0, 8);
                    csv += cols.map(col => {
                        let text = col.textContent.trim();
                        // Remove commas from numbers and add quotes for CSV
                        if (text.includes(',') || text.includes('"')) {
                            text = '"' + text.replace(/"/g, '""') + '"';
                        }
                        return text;
                    }).join(',') + '\n';
                }
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ê±°ë˜ì²˜ë³„_í†µê³„_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logMessage('í†µê³„ ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Initialize monthly report tab
        function initializeMonthlyReport() {
            // Populate year dropdown
            const yearSelect = document.getElementById('reportYear');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = currentYear; year >= currentYear - 5; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ë…„';
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            // Set current month
            const monthSelect = document.getElementById('reportMonth');
            monthSelect.value = new Date().getMonth() + 1;
            
            // Load corporates for filter
            loadCorporatesForMonthlyReport();
        }

        // Load corporates for monthly report filter
        async function loadCorporatesForMonthlyReport() {
            if (!androidServerConnected) return;
            
            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                }
                
                const select = document.getElementById('reportCorporateFilter');
                select.innerHTML = '<option value="">ì „ì²´</option>';
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId || corporate.id;
                    option.textContent = corporate.name;
                    select.appendChild(option);
                });
                
            } catch (error) {
                logMessage('ì›”ê°„ë³´ê³ ì„œìš© ê±°ë˜ì²˜ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // Load monthly report
        async function loadMonthlyReport() {
            if (!androidServerConnected) {
                alert('ë¨¼ì € Android ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”.');
                return;
            }
            
            const year = document.getElementById('reportYear').value;
            const month = document.getElementById('reportMonth').value;
            const corporateId = document.getElementById('reportCorporateFilter').value;
            
            const tbody = document.getElementById('monthlyReportBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;"><span class="loading"></span> ë³´ê³ ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
            
            try {
                let url = `/api/monthly-report?year=${year}&month=${month}`;
                if (corporateId) {
                    url += `&corporateId=${corporateId}`;
                }
                
                const data = await sendApiRequest('GET', url);
                
                let reportData = [];
                if (Array.isArray(data)) {
                    reportData = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    reportData = data.data;
                } else if (data && data.report && Array.isArray(data.report)) {
                    reportData = data.report;
                }
                
                displayMonthlyReport(reportData);
                logMessage(`ì›”ê°„ë³´ê³ ì„œ ë°ì´í„° ${reportData.length}ê°œ ë¡œë“œ`, 'success');
                
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 20px; color: #f56565;">âŒ ì˜¤ë¥˜: ${error.message}</td></tr>`;
                logMessage('ì›”ê°„ë³´ê³ ì„œ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                
                // Reset summary on error
                resetMonthlySummary();
            }
        }

        // Display monthly report
        function displayMonthlyReport(reportData) {
            const tbody = document.getElementById('monthlyReportBody');
            
            if (!reportData || reportData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">ì„ íƒí•œ ì¡°ê±´ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                resetMonthlySummary();
                return;
            }
            
            let totalUsageCount = 0;
            let totalCashDeducted = 0;
            let totalPointsDeducted = 0;
            let totalRemainingCash = 0;
            let totalRemainingPoints = 0;
            
            let html = '';
            
            reportData.forEach(item => {
                const usageCount = item.usageCount || 0;
                const cashDeducted = item.cashDeducted || 0;
                const pointsDeducted = item.pointsDeducted || 0;
                const cashBalance = item.remainingCash || 0;
                const pointBalance = item.remainingPoints || 0;
                
                totalUsageCount += usageCount;
                totalCashDeducted += cashDeducted;
                totalPointsDeducted += pointsDeducted;
                totalRemainingCash += cashBalance;
                totalRemainingPoints += pointBalance;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${item.corporateName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${item.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${usageCount.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashDeducted.toLocaleString()}ì›</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointsDeducted.toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashBalance.toLocaleString()}ì›</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointBalance.toLocaleString()}P</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Update summary
            document.getElementById('monthlyUsageCount').textContent = totalUsageCount.toLocaleString();
            document.getElementById('monthlyTotalCashDeducted').textContent = totalCashDeducted.toLocaleString() + 'ì›';
            document.getElementById('monthlyTotalPointsDeducted').textContent = totalPointsDeducted.toLocaleString() + 'P';
            document.getElementById('monthlyRemainingCash').textContent = totalRemainingCash.toLocaleString() + 'ì›';
            document.getElementById('monthlyRemainingPoints').textContent = totalRemainingPoints.toLocaleString() + 'P';
        }

        // Reset monthly summary
        function resetMonthlySummary() {
            document.getElementById('monthlyUsageCount').textContent = '0';
            document.getElementById('monthlyTotalCashDeducted').textContent = '0ì›';
            document.getElementById('monthlyTotalPointsDeducted').textContent = '0P';
            document.getElementById('monthlyRemainingCash').textContent = '0ì›';
            document.getElementById('monthlyRemainingPoints').textContent = '0P';
        }

        // Enhanced showSection function for management info
        const originalShowSection = showSection;
        showSection = function(sectionName) {
            originalShowSection.call(this, sectionName);
            
            if (sectionName === 'managementInfo') {
                // Set current month as default date range
                setCurrentMonth();
            }
        };

        // Add search input event listener
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchCorporates();
                    }
                });
            }
        });
    </script>
</body>
</html>