<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéüÔ∏è Ïø†Ìè∞ Îß§ÎãàÏ†Ä ÏãúÏä§ÌÖú Í¥ÄÎ¶¨ V3</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéüÔ∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
        }

        /* Header with Navigation */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            color: #333;
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Navigation Dropdown */
        .nav-dropdown {
            position: relative;
            display: inline-block;
        }

        .nav-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .nav-button::after {
            content: '‚ñº';
            font-size: 12px;
            transition: transform 0.3s;
        }

        .nav-button.active::after {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            min-width: 280px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            z-index: 1001;
            margin-top: 8px;
            overflow: hidden;
        }

        .dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            display: block;
            color: #333;
            padding: 16px 20px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9ff;
            color: #667eea;
            padding-left: 24px;
        }

        .dropdown-item .icon {
            margin-right: 10px;
            font-size: 16px;
            width: 20px;
            display: inline-block;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* WebSocket Status Card */
        .websocket-status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-left: 4px solid #667eea;
        }

        /* Server Status Card */
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Content Area */
        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: #333;
            font-size: 1.8em;
            font-weight: 700;
        }

        .section-header .icon {
            font-size: 1.5em;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .form-row-4 {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        input[type="time"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Button Styles */
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #48bb78;
        }

        .btn-success:hover {
            background: #38a169;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: #f56565;
        }

        .btn-danger:hover {
            background: #e53e3e;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4a5568;
            box-shadow: 0 4px 12px rgba(113, 128, 150, 0.3);
        }

        .btn-warning {
            background: #ed8936;
        }

        .btn-warning:hover {
            background: #dd6b20;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-online {
            background: #f0fff4;
            color: #2f855a;
            border: 1px solid #9ae6b4;
        }

        .status-offline {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .status-connecting {
            background: #fefcbf;
            color: #b7791f;
            border: 1px solid #f6e05e;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Connection Information Display */
        .connection-info {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 20px;
            }
            
            .logo h1 {
                font-size: 1.4em;
            }

            .main-container {
                padding: 20px 15px;
            }

            .content-area {
                padding: 20px;
            }

            .section-header h2 {
                font-size: 1.4em;
            }
        }

        /* Message Log Styles */
        .message-log {
            background: #2d3748;
            color: #68d391;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            border: 1px solid #4a5568;
        }

        .message-log .timestamp {
            color: #9ca3af;
        }

        .message-log .info {
            color: #60a5fa;
        }

        .message-log .success {
            color: #34d399;
        }

        .message-log .error {
            color: #f87171;
        }

        .message-log .warning {
            color: #fbbf24;
        }

        /* Tab Button Styles */
        .management-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
        }

        .tab-button {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-bottom: 3px solid #e0e0e0;
            color: #666;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }

        .tab-button:hover {
            background: #f0f0f0;
            color: #333;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            font-weight: 700;
        }

        .management-tab-content {
            display: none;
        }

        .management-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Card Styles */
        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h4 {
            color: #555;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9ff;
        }

        /* Management Info Tabs */
        .management-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 0;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .management-tab-content {
            margin-top: 20px;
        }

        .stat-item {
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        /* Settings specific styles */
        .setting-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            transform: scale(1.2);
        }

        /* Developer Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #666;
        }

        .modal-body {
            padding: 20px 25px 25px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <span style="font-size: 1.5em;">üéüÔ∏è</span>
                <h1>Ïø†Ìè∞ Îß§ÎãàÏ†Ä ÏãúÏä§ÌÖú Í¥ÄÎ¶¨ V3</h1>
            </div>
            
            <div class="nav-dropdown">
                <button class="nav-button" onclick="toggleDropdown()">
                    <span>üìã Î©îÎâ¥</span>
                </button>
                <div class="dropdown-content" id="navDropdown">
                    <a class="dropdown-item" onclick="showSection('welcome')">
                        <span class="icon">üè†</span>Ìôà
                    </a>
                    <a class="dropdown-item" onclick="showSection('connection')">
                        <span class="icon">üîó</span>Ïó∞Í≤∞ ÏÑ§Ï†ï
                    </a>
                    <a class="dropdown-item" onclick="showSection('corporate')" id="corporateMenu" style="display: none;">
                        <span class="icon">üè¢</span>Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨
                    </a>
                    <a class="dropdown-item" onclick="showSection('employee')" id="employeeMenu" style="display: none;">
                        <span class="icon">üë§</span>ÏßÅÏõê Í¥ÄÎ¶¨
                    </a>
                    <a class="dropdown-item" onclick="showSection('coupon')" id="couponMenu" style="display: none;">
                        <span class="icon">üéüÔ∏è</span>Ïø†Ìè∞ Î∞úÌñâ
                    </a>
                    <a class="dropdown-item" onclick="showSection('couponManagement')" id="couponManagementMenu" style="display: none;">
                        <span class="icon">üìã</span>Ïø†Ìè∞ Í¥ÄÎ¶¨
                    </a>
                    <a class="dropdown-item" onclick="showSection('send')" id="sendMenu" style="display: none;">
                        <span class="icon">üì§</span>Ïø†Ìè∞ Î∞úÏÜ°
                    </a>
                    <a class="dropdown-item" onclick="showSection('deliveryHistory')" id="deliveryHistoryMenu" style="display: none;">
                        <span class="icon">üìã</span>Î∞úÏÜ° Í∏∞Î°ù
                    </a>
                    <a class="dropdown-item" onclick="showSection('emailConfig')" id="emailConfigMenu" style="display: none;">
                        <span class="icon">üìß</span>Ïù¥Î©îÏùº ÏÑ§Ï†ï
                    </a>
                    <a class="dropdown-item" onclick="showSection('smsConfig')" id="smsConfigMenu" style="display: none;">
                        <span class="icon">üì±</span>SMS ÏÑ§Ï†ï
                    </a>
                    <a class="dropdown-item" onclick="showSection('systemSettings')" id="systemSettingsMenu" style="display: none;">
                        <span class="icon">üí∞</span>Í∞ÄÍ≤© ÏÑ§Ï†ï
                    </a>
                    <a class="dropdown-item" onclick="showSection('managementInfo')" id="managementInfoMenu" style="display: none;">
                        <span class="icon">üìä</span>Í≤ΩÏòÅÏ†ïÎ≥¥
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- WebSocket Broker Status Card -->
        <div class="websocket-status-card">
            <h3 style="margin-bottom: 15px; color: #667eea;">üåê WebSocket Î∏åÎ°úÏª§ Ïó∞Í≤∞ ÏÉÅÌÉú</h3>
            <div class="status-grid">
                <div>
                    <div id="brokerConnectionStatus">
                        <div class="status-indicator status-offline">üî¥ Î∏åÎ°úÏª§ ÎØ∏Ïó∞Í≤∞</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>Î∏åÎ°úÏª§: <span id="connectedBrokerUrl">-</span></small><br>
                        <small>ÏÑúÎ≤ÑÎ™Ö: <span id="connectedServerName">-</span></small>
                    </div>
                </div>
                <div>
                    <div id="androidServerStatus">
                        <div class="status-indicator status-offline">üî¥ Android ÏÑúÎ≤Ñ ÎØ∏Ïó∞Í≤∞</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>ÏïàÎìúÎ°úÏù¥Îìú ÏÑúÎ≤Ñ: <span id="connectedAndroidServer">-</span></small><br>
                        <small>API ÏÉÅÌÉú: <span id="androidApiStatus">-</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Welcome Section -->
            <div id="welcomeSection" class="content-section active">
                <div class="section-header">
                    <span class="icon">üéüÔ∏è</span>
                    <h2>Ïø†Ìè∞ Îß§ÎãàÏ†Ä ÏãúÏä§ÌÖú V3Ïóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§</h2>
                </div>
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="background: #e6f3ff; padding: 20px; border-radius: 12px; border-left: 4px solid #4299e1; margin-bottom: 40px;">
                        <h3 style="color: #2c5aa0; margin-bottom: 15px;">üÜï V3 Ï£ºÏöî ÏóÖÎç∞Ïù¥Ìä∏</h3>
                        <p style="color: #2c5aa0; font-size: 16px; line-height: 1.6;">
                            ‚Ä¢ WebSocket Î∏åÎ°úÏª§Î•º ÌÜµÌïú ÏïàÏ†ÑÌïú Ïó∞Í≤∞ Íµ¨Ï°∞<br>
                            ‚Ä¢ Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ<br>
                            ‚Ä¢ Ìñ•ÏÉÅÎêú Î≥¥Ïïà Î∞è Ïó∞Í≤∞ ÏïàÏ†ïÏÑ±<br>
                            ‚Ä¢ Î©îÏãúÏßÄ Î°úÍπÖ Î∞è ÎîîÎ≤ÑÍπÖ Í∏∞Îä•
                        </p>
                    </div>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 30px;">
                        ÏãúÏûëÌïòÎ†§Î©¥ Î®ºÏ†Ä <strong>Ïó∞Í≤∞ ÏÑ§Ï†ï</strong>ÏóêÏÑú WebSocket Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto;">
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s;" onclick="showSection('connection')">
                            <h3 style="color: #667eea;">üîó Ïó∞Í≤∞ ÏÑ§Ï†ï</h3>
                            <p style="color: #666; margin-top: 10px;">Î∏åÎ°úÏª§ Ïó∞Í≤∞ Î∞è ÏÑ§Ï†ï</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.')">
                            <h3 style="color: #999;">üè¢ Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨</h3>
                            <p style="color: #999; margin-top: 10px;">Í±∞ÎûòÏ≤ò Ï∂îÍ∞Ä, ÏàòÏ†ï, ÏÇ≠Ï†ú</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.')">
                            <h3 style="color: #999;">üë§ ÏßÅÏõê Í¥ÄÎ¶¨</h3>
                            <p style="color: #999; margin-top: 10px;">ÏßÅÏõê Ï†ïÎ≥¥ Í¥ÄÎ¶¨</p>
                        </div>
                        <div class="card" style="text-align: center; cursor: pointer; background: #f8f9fa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; transition: all 0.3s; opacity: 0.6;" onclick="alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.')">
                            <h3 style="color: #999;">üéüÔ∏è Ïø†Ìè∞ Î∞úÌñâ</h3>
                            <p style="color: #999; margin-top: 10px;">Ïø†Ìè∞ ÏÉùÏÑ± Î∞è Î∞úÌñâ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connection Settings Section -->
            <div id="connectionSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üîó</span>
                    <h2>Ïó∞Í≤∞ ÏÑ§Ï†ï</h2>
                </div>

                <!-- WebSocket Broker Connection -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        üåê WebSocket Î∏åÎ°úÏª§ Ïó∞Í≤∞
                    </h3>
                    
                    <div class="form-row">
                        <div>
                            <label for="brokerUrl">Î∏åÎ°úÏª§ URL</label>
                            <input type="url" id="brokerUrl" value="ws://192.168.20.16:8765" placeholder="ws://192.168.20.16:8765">
                        </div>
                        <div>
                            <label for="clientId">ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID</label>
                            <input type="text" id="clientId" value="client001" placeholder="client001">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label for="clientPassword">ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ìå®Ïä§ÏõåÎìú</label>
                            <input type="password" id="clientPassword" value="$2b$12$hashedpassword1" placeholder="Î∏åÎ°úÏª§ Ïó∞Í≤∞ Ìå®Ïä§ÏõåÎìú">
                        </div>
                        <div>
                            <label for="targetServerName">ÎåÄÏÉÅ ÏÑúÎ≤ÑÎ™Ö</label>
                            <input type="text" id="targetServerName" value="main_web_server" placeholder="Ïó∞Í≤∞Ìï† ÏõπÏÑúÎ≤ÑÎ™Ö">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="connectToBroker()" class="btn btn-success" id="connectBrokerBtn">üîó Î∏åÎ°úÏª§ Ïó∞Í≤∞</button>
                        <button onclick="disconnectFromBroker()" class="btn btn-danger" id="disconnectBrokerBtn" disabled>üîå Ïó∞Í≤∞ Ìï¥Ï†ú</button>
                        <button onclick="testBrokerConnection()" class="btn btn-warning" id="testBrokerBtn" disabled>üß™ Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                    </div>
                    
                    <!-- Connection Status -->
                    <div id="brokerConnectionInfo" class="connection-info" style="display: none;">
                        <div><strong>Ïó∞Í≤∞ ÏÉÅÌÉú:</strong> <span id="brokerStatusText">Ïó∞Í≤∞ Ï§ë...</span></div>
                        <div><strong>Î∏åÎ°úÏª§ URL:</strong> <span id="brokerUrlText">-</span></div>
                        <div><strong>ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID:</strong> <span id="clientIdText">-</span></div>
                        <div><strong>ÎåÄÏÉÅ ÏÑúÎ≤Ñ:</strong> <span id="targetServerText">-</span></div>
                    </div>
                </div>

                <!-- Android Server Connection (via Broker) -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        üì± Android ÏÑúÎ≤Ñ Ïó∞Í≤∞ (Î∏åÎ°úÏª§Î•º ÌÜµÌï¥)
                    </h3>
                    
                    <div class="form-row">
                        <div>
                            <label for="userId">ÏÇ¨Ïö©Ïûê ID</label>
                            <input type="text" id="userId" value="admin" placeholder="Android ÏÑúÎ≤Ñ ÏÇ¨Ïö©Ïûê ID">
                        </div>
                        <div>
                            <label for="password">Ìå®Ïä§ÏõåÎìú</label>
                            <input type="password" id="password" value="admin123" placeholder="Android ÏÑúÎ≤Ñ Ìå®Ïä§ÏõåÎìú">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="loginToAndroidServer()" class="btn btn-success" id="loginAndroidBtn" disabled>üîê Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏</button>
                        <button onclick="logoutFromAndroidServer()" class="btn btn-danger" id="logoutAndroidBtn" disabled>üö™ Î°úÍ∑∏ÏïÑÏõÉ</button>
                        <button onclick="testAndroidServerConnection()" class="btn" id="testAndroidBtn" disabled style="background: #4299e1; color: white;">üß™ ÏÑúÎ≤Ñ ÌÖåÏä§Ìä∏</button>
                    </div>
                    
                    <!-- Login Status -->
                    <div id="androidLoginInfo" class="connection-info" style="display: none;">
                        <div><strong>Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú:</strong> <span id="androidLoginStatusText">Î°úÍ∑∏Ïù∏ Ï§ë...</span></div>
                        <div><strong>Ïï°ÏÑ∏Ïä§ ÌÜ†ÌÅ∞:</strong> <span id="androidTokenText">-</span></div>
                        <div><strong>ÌÜ†ÌÅ∞ ÎßåÎ£å:</strong> <span id="androidTokenExpiryText">-</span></div>
                    </div>
                </div>

                <!-- Message Log -->
                <div class="card" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        üìã Ïó∞Í≤∞ Î°úÍ∑∏
                        <button onclick="clearMessageLog()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px; margin-left: auto;">üóëÔ∏è Î°úÍ∑∏ ÏßÄÏö∞Í∏∞</button>
                    </h3>
                    <div id="messageLog" class="message-log">
                        <div class="info">[ÏãúÏä§ÌÖú] Ïó∞Í≤∞ Î°úÍ∑∏Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§...</div>
                    </div>
                </div>

                <!-- Connection Instructions -->
                <div class="card" style="background: #f0f8ff; border-radius: 12px; padding: 25px; border-left: 4px solid #4299e1;">
                    <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">üìã Ïó∞Í≤∞ Ï†àÏ∞®</h4>
                    <ol style="margin: 0; padding-left: 20px; color: #2c5aa0; line-height: 1.6;">
                        <li style="margin: 8px 0;"><strong>1Îã®Í≥Ñ:</strong> WebSocket Î∏åÎ°úÏª§ URLÍ≥º ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</li>
                        <li style="margin: 8px 0;"><strong>2Îã®Í≥Ñ:</strong> 'Î∏åÎ°úÏª§ Ïó∞Í≤∞' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî</li>
                        <li style="margin: 8px 0;"><strong>3Îã®Í≥Ñ:</strong> Î∏åÎ°úÏª§ Ïó∞Í≤∞Ïù¥ ÏôÑÎ£åÎêòÎ©¥ Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</li>
                        <li style="margin: 8px 0;"><strong>4Îã®Í≥Ñ:</strong> 'Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ïù∏Ï¶ùÌïòÏÑ∏Ïöî</li>
                        <li style="margin: 8px 0;"><strong>5Îã®Í≥Ñ:</strong> Ïó∞Í≤∞Ïù¥ ÏôÑÎ£åÎêòÎ©¥ ÏÉÅÎã® Î©îÎâ¥ÏóêÏÑú Îã§Î•∏ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§</li>
                    </ol>
                </div>
            </div>

            <!-- Corporate Management Section -->
            <div id="corporateSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üè¢</span>
                    <h2>Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨</h2>
                </div>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showCreateCorporateForm()">+ ÏÉà Í±∞ÎûòÏ≤ò Ï∂îÍ∞Ä</button>
                </div>
                <div class="card">
                    <h3>üîç Í≤ÄÏÉâ</h3>
                    <div class="form-row">
                        <div>
                            <input type="text" id="searchInput" placeholder="ÌöåÏÇ¨Î™ÖÏúºÎ°ú Í≤ÄÏÉâ...">
                        </div>
                        <div>
                            <button onclick="searchCorporates()" class="btn">Í≤ÄÏÉâ</button>
                            <button onclick="loadAllCorporates()" class="btn btn-success">Ï†ÑÏ≤¥ Î™©Î°ù</button>
                        </div>
                    </div>
                </div>
                <div id="corporateList">
                    <p style="text-align: center; color: #666; padding: 40px;">Î°úÍ∑∏Ïù∏ ÌõÑ 'Ï†ÑÏ≤¥ Î™©Î°ù' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Í±∞ÎûòÏ≤ò Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÏÑ∏Ïöî.</p>
                </div>
            </div>

            <!-- Employee Management Section -->
            <div id="employeeSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üë§</span>
                    <h2>ÏßÅÏõê Í¥ÄÎ¶¨</h2>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ÏßÅÏõê Í¥ÄÎ¶¨</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="corporateSelectForEmployee" style="min-width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            </select>
                            <button class="btn btn-success" onclick="showCreateEmployeeForm()" id="addEmployeeBtn" disabled>+ ÏÉà ÏßÅÏõê Ï∂îÍ∞Ä</button>
                            <button class="btn btn-success" onclick="showBulkImportForm()" id="bulkImportBtn" disabled style="background: #38a169;">üìä Excel Î∂ôÏó¨ÎÑ£Í∏∞</button>
                        </div>
                    </div>

                    <!-- ÏßÅÏõê Î™©Î°ù -->
                    <div id="employeeList" style="margin-top: 20px;">
                        <p style="text-align: center; color: #666;">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÎ©¥ ÏßÅÏõê Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
                    </div>
                </div>
            </div>

            <div id="couponSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üéüÔ∏è</span>
                    <h2>Ïø†Ìè∞ Î∞úÌñâ</h2>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üí∞ Ïø†Ìè∞ Î∞úÌñâ</h3>
                    </div>

                    <!-- Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù -->
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="couponCorporateSelect">Î∞úÌñâÌï† Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù:</label>
                        <select id="couponCorporateSelect" style="width: 100%; max-width: 400px; padding: 16px; border: 1px solid #ddd; border-radius: 4px;" onchange="loadEmployeesForCoupon()">
                            <option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                        </select>
                    </div>

                    <!-- Î∞úÌñâ ÏÑ§Ï†ï -->
                    <div id="couponSettingsPanel" style="display: none;">
                        <div class="card" style="background: #f8f9fa; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 20px 0; color: #667eea;">üí≥ Î∞úÌñâ ÏÑ§Ï†ï</h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <!-- Ï¥ù ÌòÑÍ∏à Ï∂©Ï†Ñ Í∏àÏï° -->
                                <div class="form-group">
                                    <label for="totalCashAmount">Ï¥ù ÌòÑÍ∏à Ï∂©Ï†Ñ Í∏àÏï°:</label>
                                    <input type="text" id="totalCashAmount" placeholder="0" onchange="calculateDistribution()" oninput="formatCurrencyInput(this)" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                    <small style="color: #666;">ÏßÅÏõêÎì§ÏóêÍ≤å Í∑†Îì± Î∂ÑÎ∞∞Îê©ÎãàÎã§</small>
                                </div>

                                <!-- Ìè¨Ïù∏Ìä∏ ÏÑ§Ï†ï -->
                                <div class="form-group">
                                    <label>Ìè¨Ïù∏Ìä∏ ÏÑ§Ï†ï:</label>
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: inline-flex; align-items: center; margin-right: 15px; font-weight: normal;">
                                            <input type="radio" name="pointType" value="percentage" onchange="togglePointInput()" checked>
                                            <span style="margin-left: 5px;">Ï†ïÎ•† (%)</span>
                                        </label>
                                        <label style="display: inline-flex; align-items: center; margin-right: 15px; font-weight: normal;">
                                            <input type="radio" name="pointType" value="fixed" onchange="togglePointInput()">
                                            <span style="margin-left: 5px;">Ï†ïÏï° (Ïø†Ìè∞Îãπ)</span>
                                        </label>
                                        <label style="display: inline-flex; align-items: center; font-weight: normal;">
                                            <input type="radio" name="pointType" value="total" onchange="togglePointInput()">
                                            <span style="margin-left: 5px;">Ï¥ù Ìè¨Ïù∏Ìä∏ (Í∑†Îì±Î∞∞Î∂Ñ)</span>
                                        </label>
                                    </div>
                                    <input type="text" id="pointValue" placeholder="0" value="0" onchange="calculateDistribution()" oninput="formatPointInput(this)" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                    <small id="pointDescription" style="color: #666;">ÌòÑÍ∏à Ï∂©Ï†ÑÏï°Ïùò % ÎßåÌÅº Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â</small>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <!-- ÎßåÎ£åÏùº ÏÑ§Ï†ï -->
                                <div class="form-group">
                                    <label for="expireDate">Ïø†Ìè∞ ÎßåÎ£åÏùº:</label>
                                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px; flex-wrap: wrap;">
                                        <button type="button" onclick="setExpireDate(1)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #4299e1; color: white;">1Í∞úÏõî</button>
                                        <button type="button" onclick="setExpireDate(3)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #48bb78; color: white;">3Í∞úÏõî</button>
                                        <button type="button" onclick="setExpireDate(6)" class="btn" style="padding: 8px 12px; font-size: 12px; background: #ed8936; color: white;">6Í∞úÏõî</button>
                                        <span style="color: #666; font-size: 12px; margin-left: 5px;">ÎòêÎäî ÏßÅÏ†ë ÏÑ†ÌÉù:</span>
                                    </div>
                                    <input type="date" id="expireDate" style="padding: 16px; width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                                </div>

                                <!-- ÏÇ¨Ïö© Í∞ÄÎä• ÏöîÏùº -->
                                <div class="form-group">
                                    <label>ÏÇ¨Ïö© Í∞ÄÎä• ÏöîÏùº:</label>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        <label style="font-weight: normal;"><input type="checkbox" value="sun" class="available-day"> Ïùº</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="mon" class="available-day" checked> Ïõî</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="tue" class="available-day" checked> Ìôî</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="wed" class="available-day" checked> Ïàò</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="thu" class="available-day" checked> Î™©</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="fri" class="available-day" checked> Í∏à</label>
                                        <label style="font-weight: normal;"><input type="checkbox" value="sat" class="available-day"> ÌÜ†</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÏßÅÏõê Î™©Î°ù Î∞è Î∞∞Î∂Ñ ÌòÑÌô© -->
                        <div id="employeeDistributionPanel" style="display: none;">
                            <h4 style="margin: 0 0 15px 0; color: #667eea;">üë• ÏßÅÏõêÎ≥Ñ Ïø†Ìè∞ Î∞∞Î∂Ñ ÌòÑÌô©</h4>
                            
                            <!-- ÏöîÏïΩ Ï†ïÎ≥¥ -->
                            <div id="distributionSummary" class="card" style="background: #e6f3ff; border-left: 4px solid #4299e1; margin-bottom: 20px;">
                            </div>

                            <!-- ÏßÅÏõê Î™©Î°ù ÌÖåÏù¥Î∏î -->
                            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                                <table id="employeeDistributionTable" style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: #f8f9fa; position: sticky; top: 0;">
                                        <tr>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">Ïù¥Î¶Ñ</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">Ï†ÑÌôîÎ≤àÌò∏</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">Ïù¥Î©îÏùº</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÌòÑÍ∏àÏ∂©Ï†ÑÍ∏àÏï°</th>
                                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">Ìè¨Ïù∏Ìä∏Ï∂©Ï†ÑÍ∏àÏï°</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeeDistributionBody">
                                    </tbody>
                                </table>
                            </div>

                            <!-- Î∞úÌñâ Î≤ÑÌäº -->
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="issueCoupons()" class="btn btn-success" id="issueCouponsBtn" disabled style="padding: 15px 40px; font-size: 16px; font-weight: bold;">
                                    üé´ Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ïø†Ìè∞ Î∞úÌñâ ÏïàÎÇ¥ -->
                    <div id="couponInstructions" class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1;">
                        <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">üìã Ïø†Ìè∞ Î∞úÌñâ Î∞©Î≤ï</h4>
                        <ol style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                            <li style="margin: 8px 0;">Î∞úÌñâÌï† Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</li>
                            <li style="margin: 8px 0;">Ï¥ù Ï∂©Ï†Ñ Í∏àÏï°Í≥º Ìè¨Ïù∏Ìä∏ ÏÑ§Ï†ïÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</li>
                            <li style="margin: 8px 0;">Ïø†Ìè∞ ÎßåÎ£åÏùºÍ≥º ÏÇ¨Ïö©Í∞ÄÎä• ÏöîÏùºÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</li>
                            <li style="margin: 8px 0;">ÏßÅÏõêÎ≥Ñ Î∞∞Î∂Ñ ÌòÑÌô©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</li>
                            <li style="margin: 8px 0;">'Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏôÑÎ£åÌïòÏÑ∏Ïöî</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Coupon Management Section -->
            <div id="couponManagementSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üìã</span>
                    <h2>Ïø†Ìè∞ Í¥ÄÎ¶¨</h2>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üé´ Î∞úÌñâÎêú Ïø†Ìè∞ Í¥ÄÎ¶¨</h3>
                        <button onclick="loadAllCoupons()" class="btn btn-success">üîÑ Ï†ÑÏ≤¥ Î™©Î°ù</button>
                    </div>

                    <!-- Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px;">
                            <div>
                                <label for="couponSearchType">Í≤ÄÏÉâ Ïú†Ìòï:</label>
                                <select id="couponSearchType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="couponCode">Ïø†Ìè∞Î≤àÌò∏</option>
                                    <option value="corporateName">Í±∞ÎûòÏ≤òÎ™Ö</option>
                                    <option value="employeeName">ÏßÅÏõêÎ™Ö</option>
                                    <option value="employeePhone">Ï†ÑÌôîÎ≤àÌò∏</option>
                                </select>
                            </div>
                            <div>
                                <label for="couponSearchValue">Í≤ÄÏÉâÏñ¥:</label>
                                <input type="text" id="couponSearchValue" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label for="couponStatusFilter">ÏÉÅÌÉú ÌïÑÌÑ∞:</label>
                                <select id="couponStatusFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Ï†ÑÏ≤¥</option>
                                    <option value="ACTIVE">ÏÇ¨Ïö© Í∞ÄÎä•</option>
                                    <option value="SUSPENDED">ÏùºÏãú Ï§ëÏßÄ</option>
                                    <option value="TERMINATED">Ìï¥ÏßÄÎê®</option>
                                </select>
                            </div>
                            <button onclick="searchCoupons()" class="btn" style="background: #48bb78; color: white;">üîç Í≤ÄÏÉâ</button>
                        </div>
                    </div>

                    <!-- ÏÑ†ÌÉùÎêú Ïø†Ìè∞ ÏùºÍ¥Ñ ÏûëÏóÖ -->
                    <div id="bulkActions" style="background: #fff8dc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f6ad55; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ÏÑ†ÌÉùÎêú Ïø†Ìè∞:</strong> <span id="selectedCount">0</span>Í∞ú
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="showBulkStatusModal()" class="btn" style="background: #4299e1; color: white;">üîÑ ÏùºÍ¥Ñ ÏÉÅÌÉú Î≥ÄÍ≤Ω</button>
                                <button onclick="showBulkDeleteModal()" class="btn btn-danger">üóëÔ∏è ÏùºÍ¥Ñ ÏÇ≠Ï†ú</button>
                                <button onclick="exportSelectedToExcel()" class="btn" style="background: #52c41a; color: white;">üì• ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                            </div>
                        </div>
                    </div>

                    <!-- Ïø†Ìè∞ Î™©Î°ù ÌÖåÏù¥Î∏î -->
                    <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                        <table id="couponTable" style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa; position: sticky; top: 0;">
                                <tr>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 50px;">
                                        <input type="checkbox" id="selectAllCoupons" onchange="toggleAllCoupons()">
                                    </th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 160px;">Ïø†Ìè∞Î≤àÌò∏</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">Í±∞ÎûòÏ≤ò</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ÏßÅÏõêÎ™Ö</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">Ï†ÑÌôîÎ≤àÌò∏</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; width: 100px;">ÌòÑÍ∏àÏûîÍ≥†</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; width: 100px;">Ìè¨Ïù∏Ìä∏ÏûîÍ≥†</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">ÏÉÅÌÉú</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 100px;">ÎßåÎ£åÏùº</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 120px;">ÏÉùÏÑ±Ïùº</th>
                                    <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 180px;">Ïï°ÏÖò</th>
                                </tr>
                            </thead>
                            <tbody id="couponListBody">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 40px; color: #666;">
                                        Î°úÍ∑∏Ïù∏ ÌõÑ 'Ï†ÑÏ≤¥ Î™©Î°ù' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ïø†Ìè∞ Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÏÑ∏Ïöî.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ïø†Ìè∞ Í¥ÄÎ¶¨ ÏïàÎÇ¥ -->
                <div class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1; margin-top: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">üìã Ïø†Ìè∞ Í¥ÄÎ¶¨ Í∏∞Îä•</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                        <li style="margin: 8px 0;"><strong>Ï°∞Ìöå:</strong> Í±∞ÎûòÏ≤ò, ÏÉÅÌÉú, Ïø†Ìè∞ÏΩîÎìú, ÏßÅÏõêÏ†ïÎ≥¥Î°ú Í≤ÄÏÉâ Í∞ÄÎä•</li>
                        <li style="margin: 8px 0;"><strong>ÏàòÏ†ï:</strong> Í∞úÎ≥Ñ Ïø†Ìè∞Ïùò ÏûîÏï°, ÏÉÅÌÉú, ÎßåÎ£åÏùº ÏàòÏ†ï Í∞ÄÎä•</li>
                        <li style="margin: 8px 0;"><strong>ÏÇ≠Ï†ú:</strong> ÌïÑÏöîÏãú Ïø†Ìè∞ÏùÑ ÏôÑÏ†Ñ ÏÇ≠Ï†ú (Ï£ºÏùò ÌïÑÏöî)</li>
                        <li style="margin: 8px 0;"><strong>ÏùºÍ¥Ñ ÏûëÏóÖ:</strong> Ïó¨Îü¨ Ïø†Ìè∞ÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÏÉÅÌÉú ÏùºÍ¥Ñ Î≥ÄÍ≤Ω</li>
                        <li style="margin: 8px 0;"><strong>Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞:</strong> Excel Ìò∏Ìôò ÌòïÏãùÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú</li>
                    </ul>
                </div>
            </div>

            <!-- System Settings Section -->
            <div id="systemSettingsSection" class="content-section">
                <div class="section-header">
                    <span class="icon">üí∞</span>
                    <h2>Í∞ÄÍ≤© ÏÑ§Ï†ï</h2>
                </div>
                
                <!-- Í∏∞Î≥∏ Í∞ÄÍ≤© ÏÑ§Ï†ï (Ìï≠ÏÉÅ ÌëúÏãúÎêòÎäî Í∏∞Î≥∏ ÏÑ§Ï†ï) -->
                <div class="card">
                    <h3>üïí Í∏∞Î≥∏ Í∞ÄÍ≤© ÏÑ§Ï†ï</h3>
                    <div class="setting-item">
                        <div class="form-row">
                            <div>
                                <label>Í∏∞Î≥∏ ÌòÑÍ∏à Ï∞®Í∞ê (Ïõê)</label>
                                <input type="number" id="defaultCashDeduction" value="1000" min="0">
                            </div>
                            <div>
                                <label>Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê Î∞©Ïãù</label>
                                <select id="pointDeductionMethod" onchange="showPointMethodWarning()">
                                    <option value="ÌõÑÏàúÏúÑ" selected>Ìè¨Ïù∏Ìä∏ ÌõÑÏàúÏúÑ Ï∞®Í∞ê</option>
                                    <option value="ÎπÑÎ°Ä">Ìè¨Ïù∏Ìä∏ ÎπÑÎ°Ä Ï∞®Í∞ê</option>
                                </select>
                            </div>
                        </div>
                        <small style="color: #666;" id="defaultSettingsDescription">
                            ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï∞®Í∞êÏù¥ ÎπÑÌôúÏÑ±ÌôîÎêú Í≤ΩÏö∞ Ïù¥ Í∞íÎì§Ïù¥ ÏÇ¨Ïö©Îê©ÎãàÎã§
                        </small>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #495057;">
                            <strong>üí° Ìè¨Ïù∏Ìä∏ Ï∞®Í∞ê Î∞©Ïãù ÏÑ§Î™Ö:</strong><br>
                            ‚Ä¢ <strong>ÌõÑÏàúÏúÑ Ï∞®Í∞ê:</strong> ÌòÑÍ∏à Î®ºÏ†Ä Ï∞®Í∞ê ÌõÑ Î∂ÄÏ°±Î∂ÑÏùÑ Ìè¨Ïù∏Ìä∏Î°ú Ï∞®Í∞ê<br>
                            ‚Ä¢ <strong>ÎπÑÎ°Ä Ï∞®Í∞ê:</strong> ÌòÑÍ∏àÍ≥º Ìè¨Ïù∏Ìä∏Î•º ÏùºÏ†ï ÎπÑÏú®Î°ú ÎèôÏãú Ï∞®Í∞ê
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>‚è∞ ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï∞®Í∞ê ÏÑ§Ï†ï</h3>
                    
                    <div class="setting-item">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableTimeBasedDeduction" onchange="toggleTimeBasedControls()">
                            <label for="enableTimeBasedDeduction" style="margin: 0; font-weight: bold;">ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï∞®Í∞ê Í∏∞Îä• ÌôúÏÑ±Ìôî</label>
                        </div>
                        <small style="color: #666;">Ï≤¥ÌÅ¨ÌïòÎ©¥ ÏãúÍ∞ÑÎåÄÏóê Îî∞Îùº Îã§Î•∏ Í∏àÏï°Ïù¥ Ï∞®Í∞êÎê©ÎãàÎã§</small>
                    </div>

                    <!-- ÏãúÍ∞ÑÎåÄÎ≥Ñ Í∞ÄÍ≤© ÏÑ§Ï†ï Ïª®Ìä∏Î°§Îì§ -->
                    <div id="timeBasedControls" style="opacity: 0.5; pointer-events: none;">
                    <div class="setting-item">
                        <h4>üåÖ ÏïÑÏπ® ÏÑ§Ï†ï</h4>
                        <div class="form-row">
                            <div>
                                <label>ÏãúÏûë ÏãúÍ∞Ñ</label>
                                <input type="time" id="breakfastStartTime" value="06:00">
                            </div>
                            <div>
                                <label>Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                <input type="time" id="breakfastEndTime" value="10:59">
                            </div>
                            <div>
                                <label>ÌòÑÍ∏à Ï∞®Í∞ê (Ïõê)</label>
                                <input type="number" id="breakfastCashDeduction" value="3000" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <h4>üåû Ï†êÏã¨ ÏÑ§Ï†ï</h4>
                        <div class="form-row">
                            <div>
                                <label>ÏãúÏûë ÏãúÍ∞Ñ</label>
                                <input type="time" id="lunchStartTime" value="11:00">
                            </div>
                            <div>
                                <label>Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                <input type="time" id="lunchEndTime" value="14:59">
                            </div>
                            <div>
                                <label>ÌòÑÍ∏à Ï∞®Í∞ê (Ïõê)</label>
                                <input type="number" id="lunchCashDeduction" value="5000" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <h4>üåô Ï†ÄÎÖÅ ÏÑ§Ï†ï</h4>
                        <div class="form-row">
                            <div>
                                <label>ÏãúÏûë ÏãúÍ∞Ñ</label>
                                <input type="time" id="dinnerStartTime" value="15:00">
                            </div>
                            <div>
                                <label>Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                <input type="time" id="dinnerEndTime" value="21:59">
                            </div>
                            <div>
                                <label>ÌòÑÍ∏à Ï∞®Í∞ê (Ïõê)</label>
                                <input type="number" id="dinnerCashDeduction" value="7000" min="0">
                            </div>
                        </div>
                    </div>

                    </div> <!-- timeBasedControls Ïª®ÌÖåÏù¥ÎÑà Ï¢ÖÎ£å -->
                </div>

                <div class="card">
                    <h3>üîß Í∏∞ÌÉÄ ÏÑ§Ï†ï</h3>
                    <div class="setting-item">
                        <div class="checkbox-group">
                            <input type="checkbox" id="allowNegativeBalance">
                            <label for="allowNegativeBalance" style="margin: 0; font-weight: bold;">ÎßàÏù¥ÎÑàÏä§ ÏûîÍ≥† ÌóàÏö©</label>
                        </div>
                        <small style="color: #666;">Ï≤¥ÌÅ¨ÌïòÎ©¥ ÏûîÍ≥†Í∞Ä Î∂ÄÏ°±Ìï¥ÎèÑ QR Ïä§Ï∫îÏùÑ ÌóàÏö©Ìï©ÎãàÎã§</small>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="loadSystemSettings()" class="btn btn-secondary">üîÑ ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞</button>
                    <button onclick="saveSystemSettings()" class="btn btn-success">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
                    <button onclick="testCurrentDeduction()" class="btn" style="background: #17a2b8; color: white; margin-left: 10px;">üßÆ ÌòÑÏû¨ Ï∞®Í∞êÏï° ÌÖåÏä§Ìä∏</button>
                </div>

                <div id="settingsPreview" style="background: #e6f3ff; padding: 15px; border-radius: 8px; margin-top: 20px; display: none;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">üìã ÌòÑÏû¨ ÏÑ§Ï†ï ÎØ∏Î¶¨Î≥¥Í∏∞</h4>
                    <div id="previewContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Send Section -->
    <div id="sendSection" class="content-section">
        <div class="section-header">
            <span class="icon">üì§</span>
            <h2>Ïø†Ìè∞ Î∞úÏÜ°</h2>
        </div>
        
        <div class="card">
            <!-- Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù -->
            <div class="form-group" style="margin-bottom: 30px;">
                <label for="sendCorporateSelect">Î∞úÏÜ°Ìï† Í±∞ÎûòÏ≤ò ÏÑ†ÌÉù:</label>
                <select id="sendCorporateSelect" style="width: 100%; max-width: 400px; padding: 16px; border: 1px solid #ddd; border-radius: 4px;" onchange="loadCouponsForSend()">
                    <option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                </select>
            </div>

            <!-- Ïø†Ìè∞ Î™©Î°ù Î∞è Î∞úÏÜ° ÌòÑÌô© -->
            <div id="couponSendPanel" style="display: none;">
                <h4 style="margin: 0 0 15px 0; color: #667eea;">üé´ Ïø†Ìè∞ Î∞úÏÜ° ÌòÑÌô©</h4>
                
                <!-- Î∞úÏÜ° ÏöîÏïΩ Ï†ïÎ≥¥ -->
                <div id="sendSummary" class="card" style="background: #e6f3ff; border-left: 4px solid #4299e1; margin-bottom: 20px;">
                </div>

                <!-- ÏùºÍ¥Ñ Î∞úÏÜ° Î≤ÑÌäº -->
                <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <button onclick="sendAllEmails()" class="btn" style="background: #e53e3e; color: white;">üìß Ï†ÑÏ≤¥ Ïù¥Î©îÏùº Î∞úÏÜ°</button>
                    <button onclick="sendAllSMS()" class="btn" style="background: #48bb78; color: white;">üì± Ï†ÑÏ≤¥ SMS Î∞úÏÜ°</button>
                    <button onclick="sendAllKakao()" class="btn" style="background: #f6ad55; color: white;">üí¨ Ï†ÑÏ≤¥ Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ°</button>
                </div>

                <!-- Ïø†Ìè∞ Î™©Î°ù ÌÖåÏù¥Î∏î -->
                <div style="max-height: 500px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="couponSendTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">Ïø†Ìè∞Î≤àÌò∏</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 100px;">Ïù¥Î¶Ñ</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">Ï†ÑÌôîÎ≤àÌò∏</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 180px;">Ïù¥Î©îÏùºÏ£ºÏÜå</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">Î∞úÏÜ°Ïó¨Î∂Ä</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 250px;">Î∞úÏÜ° Ïï°ÏÖò</th>
                            </tr>
                        </thead>
                        <tbody id="couponSendBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ïø†Ìè∞ Î∞úÏÜ° ÏïàÎÇ¥ -->
            <div id="sendInstructions" class="card" style="background: #f0f8ff; border-left: 4px solid #4299e1; margin-top: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c5aa0;">üìã Ïø†Ìè∞ Î∞úÏÜ° Î∞©Î≤ï</h4>
                <ol style="margin: 0; padding-left: 20px; color: #2c5aa0;">
                    <li style="margin: 8px 0;">Î∞úÏÜ°Ìï† Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</li>
                    <li style="margin: 8px 0;">Ìï¥Îãπ Í±∞ÎûòÏ≤òÏùò Ïø†Ìè∞ Î™©Î°ùÏù¥ ÏûêÎèôÏúºÎ°ú Î°úÎìúÎê©ÎãàÎã§</li>
                    <li style="margin: 8px 0;">Í∞úÎ≥Ñ Î∞úÏÜ°: Í∞Å Ïø†Ìè∞Î≥ÑÎ°ú Ïù¥Î©îÏùº/SMS/Ïπ¥Ïπ¥Ïò§ÌÜ° Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                    <li style="margin: 8px 0;">ÏùºÍ¥Ñ Î∞úÏÜ°: ÏÉÅÎã®Ïùò Ï†ÑÏ≤¥ Î∞úÏÜ° Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                    <li style="margin: 8px 0;">Î∞úÏÜ° ÏÉÅÌÉúÎäî Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§</li>
                </ol>
                <div style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 4px; border-left: 3px solid #28a745;">
                    <strong>‚úÖ ÏÉÅÌÉú:</strong> Ïø†Ìè∞ Î∞úÏÜ° Í∏∞Îä•Ïù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§. Îã§Ïùå APIÎì§ÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§:
                    <ul style="margin-top: 5px; margin-bottom: 0;">
                        <li>/api/coupon-send/email - Ïù¥Î©îÏùº Î∞úÏÜ°</li>
                        <li>/api/coupon-send/sms - SMS Î∞úÏÜ°</li>
                        <li>/api/coupon-send/kakao - Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ°</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery History Section -->
    <div id="deliveryHistorySection" class="content-section">
        <div class="section-header">
            <span class="icon">üìã</span>
            <h2>Î∞úÏÜ° Í∏∞Î°ù</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üìä Ïø†Ìè∞ Î∞úÏÜ° Í∏∞Î°ù</h3>
                <button onclick="loadDeliveryHistory()" class="btn btn-success">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
            </div>

            <!-- Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                    <div>
                        <label for="deliverySearchType">Í≤ÄÏÉâ Ïú†Ìòï:</label>
                        <select id="deliverySearchType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="email">Ïù¥Î©îÏùº</option>
                            <option value="sms">SMS</option>
                            <option value="kakao">Ïπ¥Ïπ¥Ïò§ÌÜ°</option>
                        </select>
                    </div>
                    <div>
                        <label for="deliverySearchStatus">Î∞úÏÜ° ÏÉÅÌÉú:</label>
                        <select id="deliverySearchStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="pending">ÎåÄÍ∏∞</option>
                            <option value="sent">Î∞úÏÜ°Îê®</option>
                            <option value="failed">Ïã§Ìå®</option>
                        </select>
                    </div>
                    <div>
                        <label for="deliverySearchDate">Î∞úÏÜ°Ïùº:</label>
                        <input type="date" id="deliverySearchDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <button onclick="filterDeliveryHistory()" class="btn" style="background: #48bb78; color: white;">üîç ÌïÑÌÑ∞</button>
                </div>
            </div>

            <!-- ÌÜµÍ≥Ñ ÏöîÏïΩ -->
            <div id="deliveryStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                <!-- ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>

            <!-- Î∞úÏÜ° Í∏∞Î°ù ÌÖåÏù¥Î∏î -->
            <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                <table id="deliveryHistoryTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8f9fa; position: sticky; top: 0;">
                        <tr>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ID</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">Ïø†Ìè∞Î≤àÌò∏</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">Î∞úÏÜ°Ïú†Ìòï</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 120px;">ÏàòÏã†Ïûê</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 180px;">Ï†úÎ™©</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 80px;">ÏÉÅÌÉú</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left; width: 150px;">Î∞úÏÜ°ÏùºÏãú</th>
                            <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; width: 80px;">Ïï°ÏÖò</th>
                        </tr>
                    </thead>
                    <tbody id="deliveryHistoryBody">
                        <tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">Î∞úÏÜ° Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
            <div id="deliveryPagination" style="margin-top: 20px; text-align: center;">
                <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäºÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <!-- Email Configuration Section -->
    <div id="emailConfigSection" class="content-section">
        <div class="section-header">
            <span class="icon">üìß</span>
            <h2>Ïù¥Î©îÏùº ÏÑ§Ï†ï</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üìß Ïù¥Î©îÏùº ÏÑúÎ≤Ñ ÏÑ§Ï†ï</h3>
                <button onclick="testEmailConnection()" class="btn" style="background: #38a169; color: white;">Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
            </div>

            <!-- ÌîÑÎ°úÎ∞îÏù¥Îçî ÌîÑÎ¶¨ÏÖã -->
            <div class="card" style="background: #f8f9fa;">
                <h4 style="margin-top: 0; color: #667eea;">‚ö° Îπ†Î•∏ ÏÑ§Ï†ï (ÌîÑÎ°úÎ∞îÏù¥Îçî ÌîÑÎ¶¨ÏÖã)</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="applyGmailPreset()" class="btn" style="background: #ea4335; color: white;">Gmail</button>
                    <button onclick="applyOutlookPreset()" class="btn" style="background: #0078d4; color: white;">Outlook</button>
                    <button onclick="applyYahooPreset()" class="btn" style="background: #720e9e; color: white;">Yahoo</button>
                    <button onclick="applyNaverPreset()" class="btn" style="background: #03c75a; color: white;">Naver</button>
                    <button onclick="applyEcountPreset()" class="btn" style="background: #f39c12; color: white;">Ecount</button>
                </div>
            </div>

            <!-- SMTP ÏÑúÎ≤Ñ ÏÑ§Ï†ï -->
            <div class="card">
                <h4 style="margin-top: 0; color: #667eea;">üîß SMTP ÏÑúÎ≤Ñ ÏÑ§Ï†ï</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="smtpHost">SMTP Ìò∏Ïä§Ìä∏ *</label>
                        <input type="text" id="smtpHost" placeholder="smtp.gmail.com" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smtpPort">SMTP Ìè¨Ìä∏ *</label>
                        <input type="number" id="smtpPort" placeholder="587" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label>Î≥¥Ïïà ÏÑ§Ï†ï</label>
                    <div style="display: flex; gap: 20px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="none" style="margin-right: 5px;">
                            Î≥¥Ïïà ÏóÜÏùå
                        </label>
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="tls" checked style="margin-right: 5px;">
                            TLS
                        </label>
                        <label style="display: flex; align-items: center; margin: 0;">
                            <input type="radio" name="security" value="ssl" style="margin-right: 5px;">
                            SSL
                        </label>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="smtpUsername">ÏÇ¨Ïö©ÏûêÎ™Ö *</label>
                        <input type="text" id="smtpUsername" placeholder="your-email@gmail.com" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smtpPassword">ÎπÑÎ∞ÄÎ≤àÌò∏ *</label>
                        <input type="password" id="smtpPassword" placeholder="Ïï± ÎπÑÎ∞ÄÎ≤àÌò∏" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="loadEmailConfig()" class="btn btn-secondary">üîÑ ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞</button>
                <button onclick="saveEmailConfig()" class="btn btn-success">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- SMS Configuration Section -->
    <div id="smsConfigSection" class="content-section">
        <div class="section-header">
            <span class="icon">üì±</span>
            <h2>SMS ÏÑ§Ï†ï</h2>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üì± SMS ÏÑúÎπÑÏä§ ÏÑ§Ï†ï</h3>
                <button onclick="testSmsConnection()" class="btn" style="background: #38a169; color: white;">Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
            </div>

            <div class="card">
                <h4 style="margin-top: 0; color: #667eea;">üîß SMS API ÏÑ§Ï†ï</h4>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="smsApiUrl">SMS API URL *</label>
                    <input type="text" id="smsApiUrl" placeholder="https://api.coolsms.co.kr" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="smsSenderNumber">Î∞úÏã†Î≤àÌò∏ *</label>
                        <input type="text" id="smsSenderNumber" placeholder="010-0000-0000" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="smsSenderName">Î∞úÏã†ÏûêÎ™Ö</label>
                        <input type="text" id="smsSenderName" placeholder="Ïø†Ìè∞Îß§ÎãàÏ†Ä" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="smsTestMode" style="margin-right: 8px;">
                        ÌÖåÏä§Ìä∏ Î™®Îìú (Ïã§Ï†ú Î∞úÏÜ°ÌïòÏßÄ ÏïäÏùå)
                    </label>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="loadSmsConfig()" class="btn btn-secondary">üîÑ ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞</button>
                <button onclick="saveSmsConfig()" class="btn btn-success">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Management Information Section -->
    <div id="managementInfoSection" class="content-section">
        <div class="section-header">
            <span class="icon">üìä</span>
            <h2>Í≤ΩÏòÅÏ†ïÎ≥¥</h2>
        </div>
        
        <!-- Tab Navigation -->
        <div class="management-tabs" style="margin-bottom: 30px;">
            <button class="tab-button active" onclick="showManagementTab('statistics')" id="statisticsTabBtn">
                üìä Í±∞ÎûòÏ≤òÎ≥Ñ ÌÜµÍ≥Ñ
            </button>
            <button class="tab-button" onclick="showManagementTab('monthlyReport')" id="monthlyReportTabBtn">
                üìà ÏõîÍ∞ÑÏ†ïÏÇ∞Î≥¥Í≥†ÏÑú
            </button>
        </div>

        <!-- Statistics Tab -->
        <div id="statisticsTab" class="management-tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üìä Í±∞ÎûòÏ≤òÎ≥Ñ ÌÜµÍ≥Ñ</h3>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="loadManagementStats()" class="btn btn-success">üîÑ ÌÜµÍ≥Ñ Ï°∞Ìöå</button>
                        <button onclick="exportStatsToExcel()" class="btn" style="background: #52c41a; color: white;">üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
                    </div>
                </div>

                <!-- Date Range Selector -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
                        <div>
                            <label for="statsStartDate">ÏãúÏûëÏùº:</label>
                            <input type="date" id="statsStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label for="statsEndDate">Ï¢ÖÎ£åÏùº:</label>
                            <input type="date" id="statsEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="setCurrentMonth()" class="btn btn-secondary">Ïù¥Î≤à Îã¨</button>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div id="summaryStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalCorporates">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">Ï¥ù Í±∞ÎûòÏ≤ò Ïàò</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #38a169 0%, #48bb78 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalIssuedCoupons">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">Î∞úÌñâÎêú Ïø†Ìè∞ Ïàò</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #3182ce 0%, #4299e1 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="totalUsedCoupons">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">ÏÇ¨Ïö©Îêú Ïø†Ìè∞ Ïàò</div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #e53e3e 0%, #f56565 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold;" id="overallUsageRate">0%</div>
                        <div style="font-size: 14px; opacity: 0.9;">Ï†ÑÏ≤¥ ÏÇ¨Ïö©Î•†</div>
                    </div>
                </div>

                <!-- Corporate Statistics Table -->
                <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="corporateStatsTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">Í±∞ÎûòÏ≤òÎ™Ö</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏßÅÏõê Ïàò</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">Î∞úÌñâ</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÇ¨Ïö©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÎØ∏ÏÇ¨Ïö©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÇ¨Ïö©Î•†</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">ÌòÑÍ∏à Í∞ÄÏπò</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">Ìè¨Ïù∏Ìä∏ Í∞ÄÏπò</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÉÅÏÑ∏Î≥¥Í∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="corporateStatsBody">
                            <tr><td colspan="9" style="text-align: center; padding: 40px; color: #666;">'ÌÜµÍ≥Ñ Ï°∞Ìöå' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Monthly Report Tab -->
        <div id="monthlyReportTab" class="management-tab-content" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üìà ÏõîÍ∞ÑÏ†ïÏÇ∞Î≥¥Í≥†ÏÑú</h3>
                    <button onclick="loadMonthlyReport()" class="btn btn-success">üîÑ Î≥¥Í≥†ÏÑú Ï°∞Ìöå</button>
                </div>

                <!-- Year/Month and Corporate Filter -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: end;">
                        <div>
                            <label for="reportYear">Ïó∞ÎèÑ:</label>
                            <select id="reportYear" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <!-- Years will be populated by JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label for="reportMonth">Ïõî:</label>
                            <select id="reportMonth" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="1">1Ïõî</option>
                                <option value="2">2Ïõî</option>
                                <option value="3">3Ïõî</option>
                                <option value="4">4Ïõî</option>
                                <option value="5">5Ïõî</option>
                                <option value="6">6Ïõî</option>
                                <option value="7">7Ïõî</option>
                                <option value="8">8Ïõî</option>
                                <option value="9">9Ïõî</option>
                                <option value="10">10Ïõî</option>
                                <option value="11">11Ïõî</option>
                                <option value="12">12Ïõî</option>
                            </select>
                        </div>
                        <div>
                            <label for="reportCorporateFilter">Í±∞ÎûòÏ≤ò:</label>
                            <select id="reportCorporateFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Ï†ÑÏ≤¥</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Monthly Summary -->
                <div id="monthlySummary" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div class="stat-item" style="background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyUsageCount">0</div>
                        <div style="font-size: 12px; opacity: 0.9;">Ï¥ù ÏÇ¨Ïö© ÌöüÏàò</div>
                    </div>
                    <div class="stat-item" style="background: #48bb78; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyTotalCashDeducted">0Ïõê</div>
                        <div style="font-size: 12px; opacity: 0.9;">Ï¥ù Ï∞®Í∞ê ÌòÑÍ∏à</div>
                    </div>
                    <div class="stat-item" style="background: #4299e1; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyTotalPointsDeducted">0P</div>
                        <div style="font-size: 12px; opacity: 0.9;">Ï¥ù Ï∞®Í∞ê Ìè¨Ïù∏Ìä∏</div>
                    </div>
                    <div class="stat-item" style="background: #38a169; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyRemainingCash">0Ïõê</div>
                        <div style="font-size: 12px; opacity: 0.9;">ÌòÑÍ∏à ÏûîÏï°</div>
                    </div>
                    <div class="stat-item" style="background: #9f7aea; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="monthlyRemainingPoints">0P</div>
                        <div style="font-size: 12px; opacity: 0.9;">Ìè¨Ïù∏Ìä∏ ÏûîÏï°</div>
                    </div>
                </div>

                <!-- Monthly Detail Table -->
                <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <table id="monthlyReportTable" style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">Í±∞ÎûòÏ≤òÎ™Ö</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ÏßÅÏõêÎ™Ö</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÇ¨Ïö© ÌöüÏàò</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">Ï∞®Í∞ê ÌòÑÍ∏à</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">Ï∞®Í∞ê Ìè¨Ïù∏Ìä∏</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">ÌòÑÍ∏à ÏûîÏï°</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">Ìè¨Ïù∏Ìä∏ ÏûîÏï°</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyReportBody">
                            <tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">'Î≥¥Í≥†ÏÑú Ï°∞Ìöå' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Corporate Detail Modal -->
    <div id="corporateDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="corporateDetailTitle">Í±∞ÎûòÏ≤ò ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h3>
                <button onclick="closeCorporateDetailModal()" class="btn btn-secondary">‚úï Îã´Í∏∞</button>
            </div>
            
            <div id="corporateDetailContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
            <h3 id="employeeModalTitle">ÏÉà ÏßÅÏõê Ï∂îÍ∞Ä</h3>
            <form id="employeeForm" onsubmit="submitEmployeeForm(event)">
                <input type="hidden" id="employeeId" value="">
                <input type="hidden" id="employeeCorporateId" value="">
                
                <div class="form-group">
                    <label for="employeeCorporateName">ÏÜåÏÜç Í±∞ÎûòÏ≤ò</label>
                    <input type="text" id="employeeCorporateName" readonly style="background: #f0f0f0; padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeName">Ïù¥Î¶Ñ *</label>
                    <input type="text" id="employeeName" required style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeePhone">Ìï∏ÎìúÌè∞ Î≤àÌò∏ *</label>
                    <input type="text" id="employeePhone" placeholder="010-0000-0000" required style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeEmail">Ïù¥Î©îÏùº</label>
                    <input type="email" id="employeeEmail" placeholder="employee@example.com" style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div class="form-group">
                    <label for="employeeDepartment">Î∂ÄÏÑú</label>
                    <input type="text" id="employeeDepartment" placeholder="Ïòà: Í∞úÎ∞úÌåÄ, ÏòÅÏóÖÌåÄ" style="padding: 12px; width: 100%; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeEmployeeModal()" class="btn btn-secondary">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-success">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let brokerWebSocket = null;
        let brokerConnected = false;
        let androidServerConnected = false;
        let currentToken = localStorage.getItem('apiToken') || '';
        let messageId = 0;
        let pendingRequests = new Map(); // Store pending API requests
        let couponEmployees = []; // Store employees for coupon distribution
        let currentSection = 'welcome'; // Current active section

        // Navigation functions - Define these first so they're available for HTML onclick handlers
        function toggleDropdown() {
            const dropdown = document.getElementById('navDropdown');
            const button = document.querySelector('.nav-button');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
            } else {
                dropdown.classList.add('show');
                button.classList.add('active');
            }
        }

        // Enhanced showSection function to handle section initialization
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionName;
                
                // Close dropdown
                const dropdown = document.getElementById('navDropdown');
                const button = document.querySelector('.nav-button');
                dropdown.classList.remove('show');
                button.classList.remove('active');
                
                logMessage('ÏÑπÏÖò Ï†ÑÌôò: ' + sectionName, 'info');
                
                // Initialize section-specific functions
                if (sectionName === 'systemSettings') {
                    // Auto-load settings when section is shown
                    // loadSystemSettings();
                } else if (sectionName === 'employee') {
                    loadCorporatesForEmployeeTab();
                } else if (sectionName === 'coupon') {
                    loadCorporatesForCouponTab();
                } else if (sectionName === 'couponManagement') {
                    if (androidServerConnected) {
                        loadAllCoupons();
                    }
                } else if (sectionName === 'send') {
                    loadCorporatesForSendTab();
                } else if (sectionName === 'deliveryHistory') {
                    // Don't automatically load delivery history since API might not exist
                    // User can click the refresh button to load manually
                } else if (sectionName === 'emailConfig') {
                    loadEmailConfig();
                } else if (sectionName === 'smsConfig') {
                    loadSmsConfig();
                }
            }
        }

        // Initialize page
        window.onload = function() {
            showSection('welcome');
            logMessage('ÏãúÏä§ÌÖúÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.', 'info');
        };

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.nav-button') && !event.target.closest('.nav-dropdown')) {
                const dropdown = document.getElementById('navDropdown');
                const button = document.querySelector('.nav-button');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                    button.classList.remove('active');
                }
            }
        }


        // Message logging function
        function logMessage(message, type = 'info') {
            const logElement = document.getElementById('messageLog');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const typeClass = type;
            
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="${typeClass}">[${type.toUpperCase()}]</span> ${message}`;
            
            logElement.appendChild(messageElement);
            logElement.scrollTop = logElement.scrollHeight;

            // Keep only last 100 messages
            while (logElement.children.length > 100) {
                logElement.removeChild(logElement.firstChild);
            }
        }

        // Clear message log
        function clearMessageLog() {
            document.getElementById('messageLog').innerHTML = '<div class="info">[ÏãúÏä§ÌÖú] Î°úÍ∑∏Í∞Ä ÏßÄÏõåÏ°åÏäµÎãàÎã§.</div>';
        }

        // WebSocket Broker Connection Functions
        async function connectToBroker() {
            const brokerUrl = document.getElementById('brokerUrl').value;
            const clientId = document.getElementById('clientId').value;
            const clientPassword = document.getElementById('clientPassword').value;
            const targetServerName = document.getElementById('targetServerName').value;

            if (!brokerUrl || !clientId || !targetServerName) {
                alert('Î∏åÎ°úÏª§ URL, ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID, ÎåÄÏÉÅ ÏÑúÎ≤ÑÎ™ÖÏùÑ Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞ÏùÑ ÏãúÎèÑÌï©ÎãàÎã§...', 'info');
            updateBrokerUI('connecting');

            try {
                // Build connection URL with query parameters
                const baseUrl = brokerUrl.replace(/\/?$/, '/');
                const params = new URLSearchParams({
                    web_server: targetServerName,
                    client_id: clientId,
                    type: 'client',
                    password: clientPassword || ''
                });
                const connectionUrl = `${baseUrl}?${params.toString()}`;
                
                logMessage(`Ïó∞Í≤∞ URL: ${connectionUrl}`, 'info');
                brokerWebSocket = new WebSocket(connectionUrl);

                brokerWebSocket.onopen = function(event) {
                    logMessage('Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.', 'success');
                    logMessage(`ÎåÄÏÉÅ ÏÑúÎ≤Ñ: ${targetServerName}, ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID: ${clientId}`, 'info');
                };

                brokerWebSocket.onmessage = function(event) {
                    logMessage('Î∏åÎ°úÏª§Î°úÎ∂ÄÌÑ∞ ÏõêÏãú Î©îÏãúÏßÄ ÏàòÏã†: ' + event.data.substring(0, 200), 'info');
                    try {
                        const message = JSON.parse(event.data);
                        logMessage('ÌååÏã±Îêú Î©îÏãúÏßÄ ÌÉÄÏûÖ: ' + message.type, 'info');
                        handleBrokerMessage(message);
                    } catch (e) {
                        logMessage('ÏûòÎ™ªÎêú Î©îÏãúÏßÄ ÌòïÏãùÏùÑ Î∞õÏïòÏäµÎãàÎã§: ' + event.data, 'error');
                        logMessage('ÌååÏã± Ïò§Î•ò: ' + e.message, 'error');
                    }
                };

                brokerWebSocket.onclose = function(event) {
                    logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞Ïù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§.', 'warning');
                    brokerConnected = false;
                    androidServerConnected = false;
                    updateBrokerUI('disconnected');
                    updateAndroidUI('disconnected');
                    updateMenuVisibility();
                };

                brokerWebSocket.onerror = function(error) {
                    logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞ Ïò§Î•ò: ' + error, 'error');
                    updateBrokerUI('error');
                };

            } catch (error) {
                logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞ Ïã§Ìå®: ' + error.message, 'error');
                updateBrokerUI('error');
            }
        }

        function disconnectFromBroker() {
            if (brokerWebSocket) {
                brokerWebSocket.close();
                brokerWebSocket = null;
                logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞ÏùÑ Ìï¥Ï†úÌñàÏäµÎãàÎã§.', 'info');
            }
            brokerConnected = false;
            androidServerConnected = false;
            currentToken = '';
            localStorage.removeItem('apiToken');
            updateBrokerUI('disconnected');
            updateAndroidUI('disconnected');
            updateMenuVisibility();
        }

        function testBrokerConnection() {
            if (!brokerConnected || !brokerWebSocket) {
                alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const testMessage = {
                type: 'ping',
                timestamp: new Date().toISOString()
            };

            brokerWebSocket.send(JSON.stringify(testMessage));
            logMessage('Î∏åÎ°úÏª§Ïóê ping Î©îÏãúÏßÄÎ•º Ï†ÑÏÜ°ÌñàÏäµÎãàÎã§.', 'info');
        }


        // Android server login via broker
        async function loginToAndroidServer() {
            if (!brokerConnected) {
                alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;

            if (!userId || !password) {
                alert('ÏÇ¨Ïö©Ïûê IDÏôÄ Ìå®Ïä§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            logMessage('Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ÏùÑ ÏãúÎèÑÌï©ÎãàÎã§...', 'info');
            
            const requestId = ++messageId;
            const loginRequest = {
                type: 'api_request',
                id: requestId,
                method: 'POST',
                endpoint: '/api/login',
                data: { userId, password }
            };

            logMessage('Î°úÍ∑∏Ïù∏ ÏöîÏ≤≠ Ï†ÑÏÜ°: ' + JSON.stringify(loginRequest), 'info');
            
            try {
                brokerWebSocket.send(JSON.stringify(loginRequest));
                logMessage('Î∏åÎ°úÏª§Ïóê Î°úÍ∑∏Ïù∏ ÏöîÏ≤≠ÏùÑ Ï†ÑÏÜ°ÌñàÏäµÎãàÎã§. (ÏöîÏ≤≠ ID: ' + requestId + ')', 'info');
            } catch (error) {
                logMessage('Î∏åÎ°úÏª§ Ï†ÑÏÜ° Ïò§Î•ò: ' + error.message, 'error');
                return;
            }
            
            // Store the pending request
            pendingRequests.set(requestId, {
                type: 'login',
                timestamp: Date.now()
            });
            logMessage('ÎåÄÍ∏∞ Ï§ëÏù∏ ÏöîÏ≤≠Ïóê Ï∂îÍ∞ÄÎê®. ÌòÑÏû¨ ÎåÄÍ∏∞ Ï§ëÏù∏ ÏöîÏ≤≠ Ïàò: ' + pendingRequests.size, 'info');
        }

        function logoutFromAndroidServer() {
            androidServerConnected = false;
            currentToken = '';
            localStorage.removeItem('apiToken');
            updateAndroidUI('disconnected');
            updateMenuVisibility();
            logMessage('Android ÏÑúÎ≤ÑÏóêÏÑú Î°úÍ∑∏ÏïÑÏõÉÌñàÏäµÎãàÎã§.', 'info');
        }

        function testAndroidServerConnection() {
            if (!brokerConnected) {
                alert('Î®ºÏ†Ä Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            logMessage('Android ÏÑúÎ≤Ñ Ïó∞Í≤∞ÏùÑ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§...', 'info');
            
            const testRequest = {
                type: 'api_request',
                id: ++messageId,
                method: 'GET',
                endpoint: '/api',
                data: {}
            };

            brokerWebSocket.send(JSON.stringify(testRequest));
            
            pendingRequests.set(messageId, {
                type: 'test',
                timestamp: Date.now()
            });
        }

        // Handle API responses from Android server via broker
        function handleApiResponse(message) {
            logMessage('API ÏùëÎãµ ÏàòÏã†: ' + JSON.stringify(message), 'info');
            
            const requestInfo = pendingRequests.get(message.id);
            if (!requestInfo) {
                logMessage('Ïïå Ïàò ÏóÜÎäî API ÏùëÎãµ: ' + message.id, 'warning');
                return;
            }

            pendingRequests.delete(message.id);

            if (requestInfo.type === 'login') {
                if (message.success && message.data && message.data.success) {
                    currentToken = message.data.accessToken;
                    localStorage.setItem('apiToken', currentToken);
                    androidServerConnected = true;
                    updateAndroidUI('connected');
                    updateMenuVisibility();
                    logMessage('Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!', 'success');
                } else {
                    const errorMsg = message.error || message.data?.message || message.data?.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò';
                    logMessage('Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + errorMsg, 'error');
                    logMessage('Ï†ÑÏ≤¥ ÏùëÎãµ: ' + JSON.stringify(message), 'error');
                    updateAndroidUI('login_failed');
                }
            } else if (requestInfo.type === 'test') {
                if (message.success) {
                    logMessage('Android ÏÑúÎ≤Ñ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ!', 'success');
                } else {
                    logMessage('Android ÏÑúÎ≤Ñ ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + (message.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } else if (requestInfo.type === 'generic') {
                if (message.success) {
                    logMessage(`API ÏöîÏ≤≠ ÏÑ±Í≥µ: ${requestInfo.method} ${requestInfo.endpoint}`, 'success');
                    requestInfo.resolve(message.data);
                } else {
                    let errorMsg = message.error || message.data?.error || message.data?.message || 'API request failed';
                    
                    // 404 ÏóêÎü¨ ÌäπÎ≥Ñ Ï≤òÎ¶¨
                    if (message.data === 404 || errorMsg.includes('404') || errorMsg.includes('cannot be converted to JSONObject')) {
                        errorMsg = `API ÏóîÎìúÌè¨Ïù∏Ìä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§: ${requestInfo.endpoint}`;
                        logMessage(`‚ö†Ô∏è 404 Ïò§Î•ò: ${requestInfo.endpoint} - Android ÏÑúÎ≤ÑÏóê Ìï¥Îãπ APIÍ∞Ä Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§.`, 'error');
                    }
                    
                    logMessage(`API ÏöîÏ≤≠ Ïã§Ìå®: ${requestInfo.method} ${requestInfo.endpoint} - ${errorMsg}`, 'error');
                    logMessage(`Ïã§Ìå® ÏùëÎãµ Ï†ÑÏ≤¥: ${JSON.stringify(message)}`, 'error');
                    requestInfo.reject(new Error(errorMsg));
                }
            }
        }

        // UI Update functions
        function updateBrokerUI(status) {
            const statusElement = document.getElementById('brokerConnectionStatus');
            const infoElement = document.getElementById('brokerConnectionInfo');
            const connectBtn = document.getElementById('connectBrokerBtn');
            const disconnectBtn = document.getElementById('disconnectBrokerBtn');
            const testBtn = document.getElementById('testBrokerBtn');

            switch (status) {
                case 'connecting':
                    statusElement.innerHTML = '<div class="status-indicator status-connecting">üü° Î∏åÎ°úÏª§ Ïó∞Í≤∞ Ï§ë...</div>';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    testBtn.disabled = true;
                    infoElement.style.display = 'block';
                    document.getElementById('brokerStatusText').textContent = 'Ïó∞Í≤∞ Ï§ë...';
                    document.getElementById('brokerUrlText').textContent = document.getElementById('brokerUrl').value;
                    document.getElementById('clientIdText').textContent = document.getElementById('clientId').value;
                    document.getElementById('targetServerText').textContent = document.getElementById('targetServerName').value;
                    break;

                case 'connected':
                    statusElement.innerHTML = '<div class="status-indicator status-online">üü¢ Î∏åÎ°úÏª§ Ïó∞Í≤∞Îê®</div>';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    testBtn.disabled = false;
                    document.getElementById('brokerStatusText').textContent = 'Ïó∞Í≤∞Îê® (Ïù∏Ï¶ù ÏôÑÎ£å)';
                    document.getElementById('connectedBrokerUrl').textContent = document.getElementById('brokerUrl').value;
                    document.getElementById('connectedServerName').textContent = document.getElementById('targetServerName').value;
                    break;

                case 'disconnected':
                case 'error':
                case 'auth_failed':
                    statusElement.innerHTML = '<div class="status-indicator status-offline">üî¥ Î∏åÎ°úÏª§ ÎØ∏Ïó∞Í≤∞</div>';
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                    testBtn.disabled = true;
                    infoElement.style.display = 'none';
                    document.getElementById('connectedBrokerUrl').textContent = '-';
                    document.getElementById('connectedServerName').textContent = '-';
                    break;
            }
        }

        function updateAndroidUI(status) {
            const statusElement = document.getElementById('androidServerStatus');
            const infoElement = document.getElementById('androidLoginInfo');
            const loginBtn = document.getElementById('loginAndroidBtn');
            const logoutBtn = document.getElementById('logoutAndroidBtn');
            const testBtn = document.getElementById('testAndroidBtn');

            switch (status) {
                case 'connected':
                    statusElement.innerHTML = '<div class="status-indicator status-online">üü¢ Android ÏÑúÎ≤Ñ Ïó∞Í≤∞Îê®</div>';
                    loginBtn.disabled = true;
                    logoutBtn.disabled = false;
                    testBtn.disabled = false;
                    infoElement.style.display = 'block';
                    document.getElementById('androidLoginStatusText').textContent = 'Î°úÍ∑∏Ïù∏Îê®';
                    document.getElementById('androidTokenText').textContent = currentToken ? currentToken.substring(0, 20) + '...' : '-';
                    document.getElementById('androidTokenExpiryText').textContent = 'ÏÑ∏ÏÖò ÌôúÏÑ±';
                    document.getElementById('connectedAndroidServer').textContent = document.getElementById('targetServerName').value;
                    document.getElementById('androidApiStatus').textContent = 'Ïù∏Ï¶ùÎê®';
                    break;

                case 'disconnected':
                case 'login_failed':
                    statusElement.innerHTML = '<div class="status-indicator status-offline">üî¥ Android ÏÑúÎ≤Ñ ÎØ∏Ïó∞Í≤∞</div>';
                    loginBtn.disabled = !brokerConnected;
                    logoutBtn.disabled = true;
                    testBtn.disabled = !brokerConnected;
                    infoElement.style.display = 'none';
                    document.getElementById('connectedAndroidServer').textContent = '-';
                    document.getElementById('androidApiStatus').textContent = '-';
                    break;
            }
        }

        function updateMenuVisibility() {
            const menuItems = [
                'corporateMenu', 
                'employeeMenu', 
                'couponMenu', 
                'couponManagementMenu',
                'sendMenu',
                'deliveryHistoryMenu',
                'emailConfigMenu',
                'smsConfigMenu',
                'systemSettingsMenu',
                'managementInfoMenu'
            ];
            const shouldShow = brokerConnected && androidServerConnected;

            menuItems.forEach(menuId => {
                const menuElement = document.getElementById(menuId);
                if (menuElement) {
                    menuElement.style.display = shouldShow ? 'block' : 'none';
                }
            });
        }

        // Generic API request function via broker
        function sendApiRequest(method, endpoint, data = {}) {
            if (!brokerConnected || !brokerWebSocket) {
                const error = 'Î∏åÎ°úÏª§Ïóê Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§.';
                logMessage(`API ÏöîÏ≤≠ Ïã§Ìå®: ${error}`, 'error');
                throw new Error(error);
            }

            if (!androidServerConnected && endpoint !== '/api/login' && endpoint !== '/api') {
                const error = 'Android ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏ÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§.';
                logMessage(`API ÏöîÏ≤≠ Ïã§Ìå®: ${error}`, 'error');
                throw new Error(error);
            }

            const requestId = ++messageId;
            const apiRequest = {
                type: 'api_request',
                id: requestId,
                method: method,
                endpoint: endpoint,
                data: data,
                token: currentToken
            };

            logMessage(`API ÏöîÏ≤≠ Ï†ÑÏÜ°: ${method} ${endpoint} (ÏöîÏ≤≠ ID: ${requestId})`, 'info');
            logMessage(`ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞: ${JSON.stringify(data)}`, 'info');

            try {
                brokerWebSocket.send(JSON.stringify(apiRequest));
            } catch (error) {
                logMessage(`Î∏åÎ°úÏª§ Ï†ÑÏÜ° Ïò§Î•ò: ${error.message}`, 'error');
                throw error;
            }

            return new Promise((resolve, reject) => {
                pendingRequests.set(requestId, {
                    type: 'generic',
                    resolve: resolve,
                    reject: reject,
                    timestamp: Date.now(),
                    endpoint: endpoint,
                    method: method
                });

                // Set timeout for request
                setTimeout(() => {
                    if (pendingRequests.has(requestId)) {
                        pendingRequests.delete(requestId);
                        logMessage(`API ÏöîÏ≤≠ ÌÉÄÏûÑÏïÑÏõÉ: ${method} ${endpoint} (ÏöîÏ≤≠ ID: ${requestId})`, 'error');
                        reject(new Error(`Request timeout: ${method} ${endpoint}`));
                    }
                }, 30000); // 30 second timeout
            });
        }

        // Clean up old pending requests
        setInterval(() => {
            const now = Date.now();
            for (let [id, request] of pendingRequests.entries()) {
                if (now - request.timestamp > 60000) { // 1 minute timeout
                    pendingRequests.delete(id);
                    if (request.reject) {
                        request.reject(new Error('Request expired'));
                    }
                }
            }
        }, 30000);

        // Enhanced handleApiResponse to handle generic requests
        function handleApiResponse(message) {
            const requestInfo = pendingRequests.get(message.id);
            if (!requestInfo) {
                logMessage('Ïïå Ïàò ÏóÜÎäî API ÏùëÎãµ: ' + message.id, 'warning');
                return;
            }

            pendingRequests.delete(message.id);

            if (requestInfo.type === 'login') {
                if (message.success && message.data.success) {
                    currentToken = message.data.accessToken;
                    localStorage.setItem('apiToken', currentToken);
                    androidServerConnected = true;
                    updateAndroidUI('connected');
                    updateMenuVisibility();
                    logMessage('Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!', 'success');
                } else {
                    logMessage('Android ÏÑúÎ≤Ñ Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + (message.data?.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                    updateAndroidUI('login_failed');
                }
            } else if (requestInfo.type === 'test') {
                if (message.success) {
                    logMessage('Android ÏÑúÎ≤Ñ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ!', 'success');
                } else {
                    logMessage('Android ÏÑúÎ≤Ñ ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + (message.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'), 'error');
                }
            } else if (requestInfo.type === 'generic') {
                if (message.success) {
                    logMessage(`API ÏöîÏ≤≠ ÏÑ±Í≥µ: ${requestInfo.method} ${requestInfo.endpoint}`, 'success');
                    requestInfo.resolve(message.data);
                } else {
                    let errorMsg = message.error || message.data?.error || message.data?.message || 'API request failed';
                    
                    // 404 ÏóêÎü¨ ÌäπÎ≥Ñ Ï≤òÎ¶¨
                    if (message.data === 404 || errorMsg.includes('404') || errorMsg.includes('cannot be converted to JSONObject')) {
                        errorMsg = `API ÏóîÎìúÌè¨Ïù∏Ìä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§: ${requestInfo.endpoint}`;
                        logMessage(`‚ö†Ô∏è 404 Ïò§Î•ò: ${requestInfo.endpoint} - Android ÏÑúÎ≤ÑÏóê Ìï¥Îãπ APIÍ∞Ä Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§.`, 'error');
                    }
                    
                    logMessage(`API ÏöîÏ≤≠ Ïã§Ìå®: ${requestInfo.method} ${requestInfo.endpoint} - ${errorMsg}`, 'error');
                    logMessage(`Ïã§Ìå® ÏùëÎãµ Ï†ÑÏ≤¥: ${JSON.stringify(message)}`, 'error');
                    requestInfo.reject(new Error(errorMsg));
                }
            }
        }

        // Handle messages from broker
        function handleBrokerMessage(message) {
            // Log all incoming messages for debugging
            logMessage(`Î∏åÎ°úÏª§ Î©îÏãúÏßÄ ÏàòÏã†: ${message.type}`, 'info');
            
            if (message.type === 'connected') {
                // Handle initial connection confirmation
                brokerConnected = true;
                updateBrokerUI('connected');
                updateMenuVisibility();
                logMessage('Î∏åÎ°úÏª§ Ïó∞Í≤∞Ïù¥ ÌôïÏù∏ÎêòÏóàÏäµÎãàÎã§.', 'success');
                logMessage(`ÏÑ∏ÏÖò ID: ${message.session_id || 'N/A'}`, 'info');
                logMessage(`ÏõπÏÑúÎ≤Ñ: ${message.web_server_name || 'N/A'}`, 'info');
                logMessage(`ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID: ${message.client_id || 'N/A'}`, 'info');
                
                // Enable Android server login button
                document.getElementById('loginAndroidBtn').disabled = false;
            } else if (message.type === 'connection_status') {
                // Handle connection status updates
                updateConnectionStatus(message);
            } else if (message.type === 'api_response') {
                // Handle API responses
                handleApiResponse(message);
            } else if (message.type === 'error') {
                // Handle error messages
                logMessage(`Î∏åÎ°úÏª§ Ïò§Î•ò: ${message.message}`, 'error');
            } else {
                // Handle other message types
                logMessage(`Ïïå Ïàò ÏóÜÎäî Î©îÏãúÏßÄ ÌÉÄÏûÖ: ${message.type}`, 'warning');
            }
        }

        // Auto-reconnect functionality
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        const reconnectDelay = 5000; // 5 seconds

        function attemptReconnect() {
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                logMessage(`Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ${reconnectAttempts}/${maxReconnectAttempts}...`, 'info');
                
                setTimeout(() => {
                    connectToBroker();
                }, reconnectDelay);
            } else {
                logMessage('ÏµúÎåÄ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ÌöüÏàòÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.', 'error');
                reconnectAttempts = 0;
            }
        }

        // Reset reconnect attempts on successful connection
        function resetReconnectAttempts() {
            reconnectAttempts = 0;
        }

        // Enhanced broker WebSocket handlers
        brokerWebSocket?.addEventListener('open', resetReconnectAttempts);
        brokerWebSocket?.addEventListener('close', (event) => {
            if (event.code !== 1000) { // If not a normal closure
                attemptReconnect();
            }
        });

        // ========== Global variables for application state ==========
        let currentCoupons = [];
        let selectedCouponIds = [];

        // ========== Utility functions ==========

        // Date formatting
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleString('ko-KR');
            } catch (e) {
                return dateString;
            }
        }

        // Business number formatting
        function formatBusinessNumber(businessNumber) {
            if (!businessNumber || businessNumber.length !== 10) return businessNumber;
            return businessNumber.substring(0, 3) + '-' + businessNumber.substring(3, 5) + '-' + businessNumber.substring(5);
        }

        // Currency formatting
        function formatCurrencyInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value === '') {
                input.value = '';
                calculateDistribution();
                return;
            }
            let formattedValue = parseInt(value).toLocaleString();
            input.value = formattedValue;
            calculateDistribution();
        }

        // Point input formatting
        function formatPointInput(input) {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            
            if (pointType === 'percentage') {
                let value = input.value.replace(/[^\d.]/g, '');
                let parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                input.value = value;
            } else {
                let value = input.value.replace(/[^\d]/g, '');
                if (value === '') {
                    input.value = '';
                } else {
                    input.value = parseInt(value).toLocaleString();
                }
            }
            calculateDistribution();
        }

        // Get numeric value from formatted string
        function getNumericValue(formattedString) {
            if (!formattedString) return 0;
            return parseFloat(formattedString.replace(/,/g, '')) || 0;
        }

        // ========== Corporate Management Functions ==========

        async function loadAllCorporates() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const corporateList = document.getElementById('corporateList');
            corporateList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> Í±∞ÎûòÏ≤ò Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>';

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('Í±∞ÎûòÏ≤ò Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                displayCorporateList(corporates);
            } catch (error) {
                corporateList.innerHTML = `<p style="text-align: center; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</p>`;
                logMessage('Í±∞ÎûòÏ≤ò Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function displayCorporateList(corporates) {
            const corporateList = document.getElementById('corporateList');
            
            if (!corporates || corporates.length === 0) {
                corporateList.innerHTML = '<p style="text-align: center; color: #666;">Îì±Î°ùÎêú Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }

            let html = `<div style="margin-bottom: 10px; font-weight: bold; color: #667eea;">Ï¥ù ${corporates.length}Í∞úÏùò Í±∞ÎûòÏ≤ò</div>`;
            html += '<div style="display: grid; gap: 15px;">';
            
            corporates.forEach(corporate => {
                html += `
                    <div class="card" style="padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="color: #333; margin: 0 0 10px 0; font-size: 18px;">${corporate.name}</h4>
                                <div style="color: #666; font-size: 14px; line-height: 1.5;">
                                    ${corporate.businessNumber ? `<div><strong>ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏:</strong> ${formatBusinessNumber(corporate.businessNumber)}</div>` : ''}
                                    ${corporate.representative ? `<div><strong>ÎåÄÌëúÏûê:</strong> ${corporate.representative}</div>` : ''}
                                    ${corporate.phone ? `<div><strong>Ïó∞ÎùΩÏ≤ò:</strong> ${corporate.phone}</div>` : ''}
                                    ${corporate.email ? `<div><strong>Ïù¥Î©îÏùº:</strong> ${corporate.email}</div>` : ''}
                                    ${corporate.address ? `<div><strong>Ï£ºÏÜå:</strong> ${corporate.address}</div>` : ''}
                                    ${corporate.createdAt ? `<div style="margin-top: 10px; color: #999; font-size: 12px;"><strong>Îì±Î°ùÏùº:</strong> ${formatDate(corporate.createdAt)}</div>` : ''}
                                </div>
                            </div>
                            <div style="margin-left: 20px;">
                                <button onclick="editCorporate(${corporate.customerId})" class="btn btn-success" style="padding: 8px 15px; font-size: 14px; margin-right: 5px;">ÏàòÏ†ï</button>
                                <button onclick="deleteCorporate(${corporate.customerId}, '${corporate.name}')" class="btn btn-danger" style="padding: 8px 15px; font-size: 14px;">ÏÇ≠Ï†ú</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            corporateList.innerHTML = html;
        }

        async function searchCorporates() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('Í≤ÄÏÉâÌï† ÌöåÏÇ¨Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const corporateList = document.getElementById('corporateList');
            corporateList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> Í≤ÄÏÉâ Ï§ë...</p>';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/search?name=${encodeURIComponent(searchTerm)}`);
                displayCorporateList(data);
            } catch (error) {
                corporateList.innerHTML = `<p style="text-align: center; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</p>`;
                logMessage('Í±∞ÎûòÏ≤ò Í≤ÄÏÉâ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function showCreateCorporateForm() {
            // This would show a modal for creating corporates
            alert('Í±∞ÎûòÏ≤ò ÏÉùÏÑ± Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        async function editCorporate(corporateId) {
            // This would show a modal for editing corporates
            alert('Í±∞ÎûòÏ≤ò ÏàòÏ†ï Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        async function deleteCorporate(corporateId, corporateName) {
            if (!confirm(`Ï†ïÎßêÎ°ú "${corporateName}" Í±∞ÎûòÏ≤òÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`)) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/corporates/${corporateId}`);
                alert('Í±∞ÎûòÏ≤òÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                loadAllCorporates();
            } catch (error) {
                alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + error.message);
                logMessage('Í±∞ÎûòÏ≤ò ÏÇ≠Ï†ú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== Employee Management Functions ==========

        async function loadCorporatesForEmployeeTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('ÏßÅÏõêÌÉ≠ Í±∞ÎûòÏ≤ò Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('ÏßÅÏõêÌÉ≠ - ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('corporateSelectForEmployee');
                select.innerHTML = '<option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "Îì±Î°ùÎêú Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('Îì±Î°ùÎêú Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    option.dataset.corporateName = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`ÏßÅÏõêÌÉ≠Ïóê ${corporates.length}Í∞ú Í±∞ÎûòÏ≤ò Î°úÎìú ÏôÑÎ£å`, 'success');
                
                select.onchange = function() {
                    if (this.value) {
                        loadEmployeesByCorporate(this.value);
                        document.getElementById('addEmployeeBtn').disabled = false;
                        document.getElementById('bulkImportBtn').disabled = false;
                    } else {
                        document.getElementById('employeeList').innerHTML = '<p style="text-align: center; color: #666;">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÎ©¥ ÏßÅÏõê Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>';
                        document.getElementById('addEmployeeBtn').disabled = true;
                        document.getElementById('bulkImportBtn').disabled = true;
                    }
                };
            } catch (error) {
                logMessage('Í±∞ÎûòÏ≤ò Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                const select = document.getElementById('corporateSelectForEmployee');
                select.innerHTML = '<option value="">Ïò§Î•ò: Í±∞ÎûòÏ≤ò Î°úÎìú Ïã§Ìå®</option>';
            }
        }

        async function loadEmployeesByCorporate(corporateId) {
            const employeeList = document.getElementById('employeeList');
            employeeList.innerHTML = '<p style="text-align: center;"><span class="loading"></span> ÏßÅÏõê Î™©Î°ù Î°úÎî© Ï§ë...</p>';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                logMessage('ÏßÅÏõê Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract employees array from response
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏßÅÏõê ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                logMessage(`Í±∞ÎûòÏ≤ò ${corporateId}Ïùò ÏßÅÏõê ${employees.length}Î™Ö Î°úÎìú`, 'info');
                displayEmployeeList(employees);
            } catch (error) {
                employeeList.innerHTML = '<p style="text-align: center; color: red;">ÏßÅÏõê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.</p>';
                logMessage('ÏßÅÏõê Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function displayEmployeeList(employees) {
            const employeeList = document.getElementById('employeeList');
            
            if (!employees || employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #666;">Îì±Î°ùÎêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            employees.forEach(employee => {
                html += `
                    <div class="card" style="padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">${employee.name || employee.phone}</h4>
                                <div style="color: #666; font-size: 14px;">
                                    <p style="margin: 5px 0;"><strong>Î∂ÄÏÑú:</strong> ${employee.department || '-'}</p>
                                    <p style="margin: 5px 0;"><strong>Ìï∏ÎìúÌè∞:</strong> ${employee.phone}</p>
                                    <p style="margin: 5px 0;"><strong>Ïù¥Î©îÏùº:</strong> ${employee.email || '-'}</p>
                                    <p style="margin: 5px 0; font-size: 12px; color: #999;">Îì±Î°ùÏùº: ${formatDate(employee.createdAt)}</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="editEmployee(${employee.employeeId})" class="btn btn-success" style="padding: 8px 15px; font-size: 14px;">ÏàòÏ†ï</button>
                                <button onclick="deleteEmployee(${employee.employeeId}, '${employee.name}')" class="btn btn-danger" style="padding: 8px 15px; font-size: 14px;">ÏÇ≠Ï†ú</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            employeeList.innerHTML = html;
        }

        // ÏÉà ÏßÅÏõê Ï∂îÍ∞Ä Ìèº ÌëúÏãú
        function showCreateEmployeeForm() {
            const select = document.getElementById('corporateSelectForEmployee');
            const corporateId = select.value;
            const corporateName = select.options[select.selectedIndex].dataset.corporateName;
            
            if (!corporateId) {
                alert('Î®ºÏ†Ä Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            document.getElementById('employeeModalTitle').textContent = 'ÏÉà ÏßÅÏõê Ï∂îÍ∞Ä';
            document.getElementById('employeeId').value = '';
            document.getElementById('employeeCorporateId').value = corporateId;
            document.getElementById('employeeCorporateName').value = corporateName;
            document.getElementById('employeeName').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeEmail').value = '';
            document.getElementById('employeeDepartment').value = '';
            
            document.getElementById('employeeModal').style.display = 'block';
        }

        function showBulkImportForm() {
            alert('Excel ÏùºÍ¥Ñ Îì±Î°ù Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        // ÏßÅÏõê ÏàòÏ†ï
        async function editEmployee(employeeId) {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/employees/${employeeId}`);
                
                if (data.success || data) {
                    const employee = data.data || data;
                    const select = document.getElementById('corporateSelectForEmployee');
                    const corporateName = select.options[select.selectedIndex].dataset.corporateName;
                    
                    document.getElementById('employeeModalTitle').textContent = 'ÏßÅÏõê Ï†ïÎ≥¥ ÏàòÏ†ï';
                    document.getElementById('employeeId').value = employee.employeeId;
                    document.getElementById('employeeCorporateId').value = employee.corporateId;
                    document.getElementById('employeeCorporateName').value = corporateName;
                    document.getElementById('employeeName').value = employee.name;
                    document.getElementById('employeePhone').value = employee.phone;
                    document.getElementById('employeeEmail').value = employee.email || '';
                    document.getElementById('employeeDepartment').value = employee.department || '';
                    
                    document.getElementById('employeeModal').style.display = 'block';
                } else {
                    alert('ÏßÅÏõê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïò§Î•ò: ' + error.message);
                logMessage('ÏßÅÏõê Ï†ïÎ≥¥ Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        async function deleteEmployee(employeeId, employeeName) {
            if (!confirm(`Ï†ïÎßêÎ°ú "${employeeName}" ÏßÅÏõêÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/employees/${employeeId}`);
                alert('ÏßÅÏõêÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                const corporateId = document.getElementById('corporateSelectForEmployee').value;
                if (corporateId) {
                    loadEmployeesByCorporate(corporateId);
                }
            } catch (error) {
                alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + error.message);
                logMessage('ÏßÅÏõê ÏÇ≠Ï†ú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ÏßÅÏõê Î™®Îã¨ Îã´Í∏∞
        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }

        // ÏßÅÏõê Ìèº Ï†úÏ∂ú
        async function submitEmployeeForm(event) {
            event.preventDefault();
            
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const employeeId = document.getElementById('employeeId').value;
            const isUpdate = employeeId !== '';
            
            const employeeData = {
                corporateId: parseInt(document.getElementById('employeeCorporateId').value),
                name: document.getElementById('employeeName').value.trim(),
                phone: document.getElementById('employeePhone').value.trim(),
                email: document.getElementById('employeeEmail').value.trim(),
                department: document.getElementById('employeeDepartment').value.trim()
            };
            
            if (!employeeData.phone) {
                alert('Ìï∏ÎìúÌè∞ Î≤àÌò∏Îäî ÌïÑÏàòÏûÖÎãàÎã§.');
                return;
            }
            
            // Ï†ÑÌôîÎ≤àÌò∏ Ï§ëÎ≥µ Í≤ÄÏÇ¨ (ÏÉà ÏßÅÏõê Îì±Î°ù Ïãú ÎòêÎäî Ï†ÑÌôîÎ≤àÌò∏ Î≥ÄÍ≤Ω Ïãú)
            try {
                const checkResponse = await sendApiRequest('POST', '/api/employees/check-phone', { 
                    phone: employeeData.phone,
                    excludeEmployeeId: isUpdate ? employeeId : null
                });
                
                if (checkResponse.phoneExists) {
                    const existingEmployee = checkResponse.existingEmployee;
                    const corporateName = checkResponse.corporateName;
                    
                    const confirmMessage = `Ïù¥ÎØ∏ Îì±Î°ùÎêú Ï†ÑÌôîÎ≤àÌò∏ÏûÖÎãàÎã§.\n\n` +
                        `Îì±Î°ùÎêú ÏßÅÏõê Ï†ïÎ≥¥:\n` +
                        `‚Ä¢ Ïù¥Î¶Ñ: ${existingEmployee.name}\n` +
                        `‚Ä¢ ÏÜåÏÜç Í±∞ÎûòÏ≤ò: ${corporateName}\n` +
                        `‚Ä¢ Î∂ÄÏÑú: ${existingEmployee.department || 'ÎØ∏ÏßÄÏ†ï'}\n\n` +
                        `Í∑∏ÎûòÎèÑ Ïù¥ Ï†ÑÌôîÎ≤àÌò∏Î°ú ÏßÅÏõêÏùÑ Îì±Î°ùÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                    
                    if (!confirm(confirmMessage)) {
                        return; // ÏÇ¨Ïö©ÏûêÍ∞Ä Ï∑®ÏÜåÎ•º ÏÑ†ÌÉùÌïú Í≤ΩÏö∞
                    }
                }
            } catch (error) {
                logMessage('Ï†ÑÌôîÎ≤àÌò∏ Ï§ëÎ≥µ Í≤ÄÏÇ¨ Ïã§Ìå®: ' + error.message, 'warning');
                // Ï§ëÎ≥µ Í≤ÄÏÇ¨ Ïã§Ìå® ÏãúÏóêÎèÑ Í≥ÑÏÜç ÏßÑÌñâ (ÏÑúÎ≤ÑÏóêÏÑú Ï≤òÎ¶¨)
            }
            
            try {
                const url = isUpdate ? `/api/employees/${employeeId}` : '/api/employees';
                const method = isUpdate ? 'PUT' : 'POST';
                
                const data = await sendApiRequest(method, url, employeeData);
                
                if (data.success || data) {
                    // Í≤ΩÍ≥† Î©îÏãúÏßÄÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ Î®ºÏ†Ä ÌëúÏãú
                    if (data.warning) {
                        alert('Í≤ΩÍ≥†: ' + data.warning + '\n\n' + (data.message || 'Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.'));
                    } else {
                        alert(isUpdate ? 'ÏßÅÏõê Ï†ïÎ≥¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.' : 'ÏßÅÏõêÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
                    }
                    closeEmployeeModal();
                    loadEmployeesByCorporate(employeeData.corporateId);
                } else {
                    alert('Ïò§Î•ò: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïò§Î•ò: ' + error.message);
                logMessage('ÏßÅÏõê Ï†ÄÏû• Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== Coupon Functions ==========

        async function loadCorporatesForCouponTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('Ïø†Ìè∞ÌÉ≠ Í±∞ÎûòÏ≤ò Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('Ïø†Ìè∞ÌÉ≠ - ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('couponCorporateSelect');
                select.innerHTML = '<option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "Îì±Î°ùÎêú Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('Ïø†Ìè∞ Î∞úÌñâÏö© Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`Ïø†Ìè∞ÌÉ≠Ïóê ${corporates.length}Í∞ú Í±∞ÎûòÏ≤ò Î°úÎìú ÏôÑÎ£å`, 'success');
            } catch (error) {
                logMessage('Í±∞ÎûòÏ≤ò Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                const select = document.getElementById('couponCorporateSelect');
                select.innerHTML = '<option value="">Ïò§Î•ò: Í±∞ÎûòÏ≤ò Î°úÎìú Ïã§Ìå®</option>';
            }
        }

        async function loadEmployeesForCoupon() {
            const corporateId = document.getElementById('couponCorporateSelect').value;
            const settingsPanel = document.getElementById('couponSettingsPanel');
            const instructions = document.getElementById('couponInstructions');

            if (!corporateId) {
                settingsPanel.style.display = 'none';
                instructions.style.display = 'block';
                couponEmployees = [];
                return;
            }

            instructions.style.display = 'none';
            settingsPanel.style.display = 'block';

            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                logMessage('Ïø†Ìè∞ Î∞úÌñâÏö© ÏßÅÏõê Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract employees array from response
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else {
                    logMessage('Ïø†Ìè∞ Î∞úÌñâÏö© ÏßÅÏõê - ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                couponEmployees = employees;
                logMessage(`Í±∞ÎûòÏ≤òÏùò ÏßÅÏõê ${employees.length}Î™ÖÏùÑ Î°úÎìúÌñàÏäµÎãàÎã§.`, 'success');
            } catch (error) {
                alert('ÏßÅÏõê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                logMessage('ÏßÅÏõê Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function togglePointInput() {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointDescription = document.getElementById('pointDescription');
            const pointValue = document.getElementById('pointValue');
            
            if (pointType === 'percentage') {
                pointDescription.textContent = 'ÌòÑÍ∏à Ï∂©Ï†ÑÏï°Ïùò % ÎßåÌÅº Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â';
                pointValue.placeholder = '10';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'fixed') {
                pointDescription.textContent = 'Ïø†Ìè∞ 1Ïû•Îãπ Í≥†Ï†ï Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â';
                pointValue.placeholder = '1,000';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'total') {
                pointDescription.textContent = 'Ï¥ù Ìè¨Ïù∏Ìä∏Î•º ÏßÅÏõêÎì§ÏóêÍ≤å Í∑†Îì± Î∂ÑÎ∞∞';
                pointValue.placeholder = '100,000';
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            }
            
            calculateDistribution();
        }

        function calculateDistribution() {
            if (couponEmployees.length === 0) {
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            
            const employeeCount = couponEmployees.length;
            const cashPerEmployee = totalCash / employeeCount;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee);
            updateDistributionSummary(totalCash, pointPerEmployee * employeeCount, employeeCount);
            
            document.getElementById('employeeDistributionPanel').style.display = 'block';
            
            const canIssue = totalCash > 0 && document.getElementById('expireDate').value;
            document.getElementById('issueCouponsBtn').disabled = !canIssue;
        }

        function updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee) {
            const tbody = document.getElementById('employeeDistributionBody');
            let html = '';
            
            couponEmployees.forEach(employee => {
                const displayName = employee.name || employee.phone;
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${displayName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.phone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.email || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #e53e3e;">
                            ‚Ç©${cashPerEmployee.toLocaleString()}
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #38a169;">
                            ${pointPerEmployee.toLocaleString()}P
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function updateDistributionSummary(totalCash, totalPoints, employeeCount) {
            const summary = document.getElementById('distributionSummary');
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = document.getElementById('pointValue').value;
            
            let pointDescription = '';
            if (pointType === 'percentage') {
                pointDescription = `ÌòÑÍ∏àÏùò ${pointValue}%`;
            } else if (pointType === 'fixed') {
                pointDescription = `Ïø†Ìè∞Îãπ ${pointValue.toLocaleString()}P`;
            } else if (pointType === 'total') {
                pointDescription = `Ï¥ù ${pointValue.toLocaleString()}P Í∑†Îì±Î∞∞Î∂Ñ`;
            }
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">üë• ÎåÄÏÉÅ ÏßÅÏõê:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${employeeCount}Î™Ö</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">üí∞ Ï¥ù ÌòÑÍ∏à:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">‚Ç©${totalCash.toLocaleString()}</span>
                    </div>
                    <div>
                        <strong style="color: #38a169;">üéØ Ï¥ù Ìè¨Ïù∏Ìä∏:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalPoints.toLocaleString()}P</span><br>
                        <small style="color: #666;">(${pointDescription})</small>
                    </div>
                    <div>
                        <strong style="color: #667eea;">üìä ÏßÅÏõêÎãπ ÌèâÍ∑†:</strong><br>
                        <span style="font-size: 14px;">ÌòÑÍ∏à: ‚Ç©${(totalCash/employeeCount).toLocaleString()}</span><br>
                        <span style="font-size: 14px;">Ìè¨Ïù∏Ìä∏: ${(totalPoints/employeeCount).toLocaleString()}P</span>
                    </div>
                </div>
            `;
        }

        function setExpireDate(months) {
            const today = new Date();
            const expireDate = new Date(today);
            expireDate.setMonth(expireDate.getMonth() + months);
            
            const formattedDate = expireDate.toISOString().split('T')[0];
            document.getElementById('expireDate').value = formattedDate;
            
            calculateDistribution();
        }

        function getAvailableDaysString() {
            const dayOrder = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
            let binaryString = '';
            
            for (const day of dayOrder) {
                const checkbox = document.querySelector(`.available-day[value="${day}"]`);
                binaryString += checkbox && checkbox.checked ? '1' : '0';
            }
            
            return binaryString;
        }

        async function issueCoupons() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            if (couponEmployees.length === 0) {
                alert('Î∞úÌñâÌï† ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            const expireDate = document.getElementById('expireDate').value;
            const availableDays = getAvailableDaysString();

            if (!totalCash || !expireDate) {
                alert('ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const employeeCount = couponEmployees.length;
            const cashPerEmployee = Math.round((totalCash / employeeCount) * 100) / 100;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            const corporateName = document.getElementById('couponCorporateSelect').options[document.getElementById('couponCorporateSelect').selectedIndex].textContent;
            
            if (!confirm(`${corporateName}Ïùò ${employeeCount}Î™Ö ÏßÅÏõêÏóêÍ≤å Ïø†Ìè∞ÏùÑ Î∞úÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n` +
                        `‚Ä¢ ÏßÅÏõêÎãπ ÌòÑÍ∏à: ‚Ç©${cashPerEmployee.toLocaleString()}\n` +
                        `‚Ä¢ ÏßÅÏõêÎãπ Ìè¨Ïù∏Ìä∏: ${pointPerEmployee.toLocaleString()}P\n` +
                        `‚Ä¢ ÎßåÎ£åÏùº: ${expireDate}`)) {
                return;
            }

            const issueBtn = document.getElementById('issueCouponsBtn');
            issueBtn.disabled = true;
            issueBtn.textContent = 'Î∞úÌñâ Ï§ë...';
            
            let successCount = 0;
            let failCount = 0;
            const errors = [];

            try {
                for (let i = 0; i < couponEmployees.length; i++) {
                    const employee = couponEmployees[i];
                    
                    try {
                        const couponData = {
                            employeeId: employee.employeeId,
                            cashBalance: cashPerEmployee,
                            pointBalance: pointPerEmployee,
                            expireDate: expireDate,
                            status: 'ACTIVE',
                            paymentType: 'PREPAID',
                            availableDays: availableDays
                        };

                        await sendApiRequest('POST', '/api/coupons', couponData);
                        successCount++;
                    } catch (error) {
                        failCount++;
                        const displayName = employee.name || employee.phone;
                        errors.push(`${displayName}: ${error.message}`);
                    }

                    issueBtn.textContent = `Î∞úÌñâ Ï§ë... (${i + 1}/${couponEmployees.length})`;
                }

                let message = `Ïø†Ìè∞ Î∞úÌñâ ÏôÑÎ£å!\nÏÑ±Í≥µ: ${successCount}Í±¥, Ïã§Ìå®: ${failCount}Í±¥`;
                if (errors.length > 0) {
                    message += '\n\nÏã§Ìå® ÎÇ¥Ïó≠:\n' + errors.slice(0, 5).join('\n');
                    if (errors.length > 5) {
                        message += `\n... Ïô∏ ${errors.length - 5}Í±¥ Îçî`;
                    }
                }

                alert(message);
                logMessage(`Ïø†Ìè∞ Î∞úÌñâ ÏôÑÎ£å: ÏÑ±Í≥µ ${successCount}Í±¥, Ïã§Ìå® ${failCount}Í±¥`, successCount > 0 ? 'success' : 'warning');

                if (successCount > 0) {
                    document.getElementById('totalCashAmount').value = '';
                    document.getElementById('pointValue').value = '';
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                }

            } catch (error) {
                alert('Ïø†Ìè∞ Î∞úÌñâ Ïò§Î•ò: ' + error.message);
                logMessage('Ïø†Ìè∞ Î∞úÌñâ Ïò§Î•ò: ' + error.message, 'error');
            } finally {
                issueBtn.disabled = false;
                issueBtn.textContent = 'üé´ Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ';
            }
        }

        // ========== Coupon Management Functions ==========

        async function loadAllCoupons() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const tbody = document.getElementById('couponListBody');
            tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 20px;"><span class="loading"></span> Ïø†Ìè∞ Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>';

            try {
                const data = await sendApiRequest('GET', '/api/coupons');
                logMessage('Ïø†Ìè∞ Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract coupons array from response (similar to other data loading functions)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú Ïø†Ìè∞ ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                displayCouponList(coupons);
                logMessage(`Ïø†Ìè∞ ${coupons.length}Í∞úÎ•º Î°úÎìúÌñàÏäµÎãàÎã§.`, 'success');
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="11" style="text-align: center; padding: 20px; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</td></tr>`;
                logMessage('Ïø†Ìè∞ Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function displayCouponList(coupons) {
            currentCoupons = coupons;
            const tbody = document.getElementById('couponListBody');
            
            if (!coupons || coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 20px; color: #666;">Îì±Î°ùÎêú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }

            let html = '';
            coupons.forEach(coupon => {
                const statusColor = coupon.status === 'ACTIVE' ? '#48bb78' : coupon.status === 'SUSPENDED' ? '#f6ad55' : '#f56565';
                const statusText = coupon.status === 'ACTIVE' ? 'ÏÇ¨Ïö©Í∞ÄÎä•' : coupon.status === 'SUSPENDED' ? 'ÏùºÏãúÏ§ëÏßÄ' : 'Ìï¥ÏßÄÎê®';

                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <input type="checkbox" class="coupon-checkbox" value="${coupon.couponId}" onchange="updateSelectedCount()">
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${coupon.code || coupon.couponCode || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.corporateName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.recipientName || coupon.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${coupon.recipientPhone || coupon.employeePhone || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold;">‚Ç©${parseInt(coupon.cashBalance).toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold;">${parseInt(coupon.pointBalance).toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">${statusText}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; font-size: 12px;">${formatDate(coupon.expireDate)}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center; font-size: 12px;">${formatDate(coupon.createdAt)}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="editCoupon(${coupon.couponId})" class="btn" style="padding: 4px 8px; font-size: 12px; margin-right: 4px; background: #4299e1; color: white;">ÏàòÏ†ï</button>
                            <button onclick="deleteCoupon(${coupon.couponId})" class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;">ÏÇ≠Ï†ú</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.coupon-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = count;
            
            const bulkActions = document.getElementById('bulkActions');
            bulkActions.style.display = count > 0 ? 'block' : 'none';

            selectedCouponIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
        }

        function toggleAllCoupons() {
            const masterCheckbox = document.getElementById('selectAllCoupons');
            const checkboxes = document.querySelectorAll('.coupon-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = masterCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        async function searchCoupons() {
            const searchType = document.getElementById('couponSearchType').value;
            const searchValue = document.getElementById('couponSearchValue').value.trim();
            const statusFilter = document.getElementById('couponStatusFilter').value;

            if (!searchValue && !statusFilter) {
                alert('Í≤ÄÏÉâÏñ¥ÎÇò ÏÉÅÌÉú ÌïÑÌÑ∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                let endpoint = '/api/coupons/search?';
                const params = new URLSearchParams();
                
                if (searchValue) {
                    params.append(searchType, searchValue);
                }
                if (statusFilter) {
                    params.append('status', statusFilter);
                }

                const data = await sendApiRequest('GET', `/api/coupons/search?${params.toString()}`);
                
                // Extract coupons array from response (similar to other data loading functions)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú Ïø†Ìè∞ Í≤ÄÏÉâ ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                displayCouponList(coupons);
                logMessage(`Í≤ÄÏÉâ Í≤∞Í≥º: ${coupons.length}Í∞ú Ïø†Ìè∞`, 'info');
            } catch (error) {
                alert('Í≤ÄÏÉâ Ïã§Ìå®: ' + error.message);
                logMessage('Ïø†Ìè∞ Í≤ÄÏÉâ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        async function editCoupon(couponId) {
            alert('Ïø†Ìè∞ ÏàòÏ†ï Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        async function deleteCoupon(couponId) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                return;
            }

            try {
                await sendApiRequest('DELETE', `/api/coupons/${couponId}`);
                alert('Ïø†Ìè∞Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                loadAllCoupons();
            } catch (error) {
                alert('ÏÇ≠Ï†ú Ïã§Ìå®: ' + error.message);
                logMessage('Ïø†Ìè∞ ÏÇ≠Ï†ú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function showBulkStatusModal() {
            alert('ÏùºÍ¥Ñ ÏÉÅÌÉú Î≥ÄÍ≤Ω Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        function showBulkDeleteModal() {
            if (selectedCouponIds.length === 0) {
                alert('ÏÑ†ÌÉùÎêú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            alert(`ÏÑ†ÌÉùÎêú ${selectedCouponIds.length}Í∞ú Ïø†Ìè∞ ÏùºÍ¥Ñ ÏÇ≠Ï†ú Î™®Îã¨Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.`);
        }

        function exportSelectedToExcel() {
            alert('Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í∏∞Îä•Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        // ========== Coupon Sending Functions ==========

        // Ïø†Ìè∞ Î∞úÏÜ°ÏùÑ ÏúÑÌïú Í±∞ÎûòÏ≤ò Î™©Î°ù Î°úÎìú
        async function loadCorporatesForSendTab() {
            if (!androidServerConnected) return;

            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                logMessage('Î∞úÏÜ°ÌÉ≠ Í±∞ÎûòÏ≤ò Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract corporates array from response
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.corporates && Array.isArray(data.corporates)) {
                    corporates = data.corporates;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                } else {
                    logMessage('Î∞úÏÜ°ÌÉ≠ - ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                const select = document.getElementById('sendCorporateSelect');
                select.innerHTML = '<option value="">Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (corporates.length === 0) {
                    const option = document.createElement('option');
                    option.value = "";
                    option.textContent = "Îì±Î°ùÎêú Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§";
                    option.disabled = true;
                    select.appendChild(option);
                    logMessage('Î∞úÏÜ°Ïö© Í±∞ÎûòÏ≤òÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                    return;
                }
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId;
                    option.textContent = corporate.name;
                    option.dataset.corporateName = corporate.name;
                    select.appendChild(option);
                });
                
                logMessage(`Î∞úÏÜ°ÌÉ≠Ïóê ${corporates.length}Í∞ú Í±∞ÎûòÏ≤ò Î°úÎìú ÏôÑÎ£å`, 'success');
                
            } catch (error) {
                logMessage('Î∞úÏÜ°Ïö© Í±∞ÎûòÏ≤ò Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                const select = document.getElementById('sendCorporateSelect');
                select.innerHTML = '<option value="">Ïò§Î•ò: Í±∞ÎûòÏ≤ò Î°úÎìú Ïã§Ìå®</option>';
            }
        }

        // Î∞úÏÜ°Ìï† Ïø†Ìè∞ Î™©Î°ù Î°úÎìú
        async function loadCouponsForSend() {
            const corporateId = document.getElementById('sendCorporateSelect').value;
            
            if (!corporateId) {
                document.getElementById('couponSendPanel').style.display = 'none';
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/coupons`);
                
                // Extract coupons array from response (similar to loadAllCoupons)
                let coupons = [];
                if (Array.isArray(data)) {
                    coupons = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else if (data && data.coupons && Array.isArray(data.coupons)) {
                    coupons = data.coupons;
                } else if (data && Array.isArray(data.result)) {
                    coupons = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    coupons = data.data;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú Î∞úÏÜ°Ïö© Ïø†Ìè∞ ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                if (coupons && coupons.length > 0) {
                    displayCouponsForSend(coupons);
                    updateSendSummary(coupons);
                    document.getElementById('couponSendPanel').style.display = 'block';
                    logMessage(`Î∞úÏÜ°Ïö© Ïø†Ìè∞ ${coupons.length}Í∞ú Î°úÎìú`, 'success');
                } else {
                    alert('Ìï¥Îãπ Í±∞ÎûòÏ≤òÏóê Î∞úÏÜ°Ìï† Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.');
                    document.getElementById('couponSendPanel').style.display = 'none';
                }
                
            } catch (error) {
                alert('Ïø†Ìè∞ Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message);
                logMessage('Î∞úÏÜ°Ïö© Ïø†Ìè∞ Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ïø†Ìè∞ Î∞úÏÜ° Î™©Î°ù ÌëúÏãú
        function displayCouponsForSend(coupons) {
            const tbody = document.getElementById('couponSendBody');
            let html = '';
            
            coupons.forEach(coupon => {
                const recipientName = coupon.recipientName || coupon.employeeName || 'Ïù¥Î¶Ñ ÏóÜÏùå';
                const recipientPhone = coupon.recipientPhone || coupon.employeePhone || 'Ï†ÑÌôîÎ≤àÌò∏ ÏóÜÏùå';
                const recipientEmail = coupon.recipientEmail || coupon.employeeEmail || '';
                
                html += `
                    <tr id="couponRow_${coupon.couponId}">
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${coupon.fullCouponCode || coupon.couponCode || coupon.code || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientPhone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${recipientEmail}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;" id="sendStatus_${coupon.couponId}">
                            <span style="color: #f6ad55;">‚è≥ ÎåÄÍ∏∞</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="sendEmail(${coupon.couponId}, '${recipientEmail}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #e53e3e; color: white;" 
                                ${!recipientEmail ? 'disabled' : ''}>üìß</button>
                            <button onclick="sendSMS(${coupon.couponId}, '${recipientPhone}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #48bb78; color: white;">üì±</button>
                            <button onclick="sendKakao(${coupon.couponId}, '${recipientPhone}')" 
                                class="btn" style="padding: 4px 8px; font-size: 12px; margin: 2px; background: #f6ad55; color: white;">üí¨</button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // Î∞úÏÜ° ÏöîÏïΩ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSendSummary(coupons) {
            const summary = document.getElementById('sendSummary');
            const totalCount = coupons.length;
            const emailAvailable = coupons.filter(c => c.recipientEmail || c.employeeEmail).length;
            const phoneAvailable = coupons.filter(c => c.recipientPhone || c.employeePhone).length;
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">üé´ Ï¥ù Ïø†Ìè∞:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalCount}Í∞ú</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">üìß Ïù¥Î©îÏùº Í∞ÄÎä•:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${emailAvailable}Í∞ú</span>
                    </div>
                    <div>
                        <strong style="color: #48bb78;">üì± SMS Í∞ÄÎä•:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${phoneAvailable}Í∞ú</span>
                    </div>
                    <div>
                        <strong style="color: #f6ad55;">üí¨ Ïπ¥Ïπ¥Ïò§ Í∞ÄÎä•:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${phoneAvailable}Í∞ú</span>
                    </div>
                </div>
            `;
        }

        // Í∞úÎ≥Ñ Ïù¥Î©îÏùº Î∞úÏÜ°
        async function sendEmail(couponId, email) {
            if (!email) {
                alert('Ïù¥Î©îÏùº Ï£ºÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">üìß Î∞úÏÜ°Ï§ë...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/email', {
                    couponId: couponId,
                    recipientEmail: email
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">‚úÖ Ïù¥Î©îÏùº Î∞úÏÜ°Îê®</span>';
                    logMessage(`Ïù¥Î©îÏùº Î∞úÏÜ° ÏÑ±Í≥µ: Ïø†Ìè∞ ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                    logMessage(`Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®: Ïø†Ìè∞ ${couponId} - ${data.message}`, 'error');
                    alert('Ïù¥Î©îÏùº Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                logMessage(`Ïù¥Î©îÏùº Î∞úÏÜ° Ïò§Î•ò: Ïø†Ìè∞ ${couponId} - ${error.message}`, 'error');
                alert('Ïù¥Î©îÏùº Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
            }
        }

        // Í∞úÎ≥Ñ SMS Î∞úÏÜ°
        async function sendSMS(couponId, phone) {
            if (!phone) {
                alert('Ï†ÑÌôîÎ≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">üì± Î∞úÏÜ°Ï§ë...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/sms', {
                    couponId: couponId,
                    recipientPhone: phone
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">‚úÖ SMS Î∞úÏÜ°Îê®</span>';
                    logMessage(`SMS Î∞úÏÜ° ÏÑ±Í≥µ: Ïø†Ìè∞ ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                    logMessage(`SMS Î∞úÏÜ° Ïã§Ìå®: Ïø†Ìè∞ ${couponId} - ${data.message}`, 'error');
                    alert('SMS Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                logMessage(`SMS Î∞úÏÜ° Ïò§Î•ò: Ïø†Ìè∞ ${couponId} - ${error.message}`, 'error');
                alert('SMS Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
            }
        }

        // Í∞úÎ≥Ñ Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ°
        async function sendKakao(couponId, phone) {
            if (!phone) {
                alert('Ï†ÑÌôîÎ≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const statusElement = document.getElementById(`sendStatus_${couponId}`);
            statusElement.innerHTML = '<span style="color: #4299e1;">üí¨ Î∞úÏÜ°Ï§ë...</span>';

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/kakao', {
                    couponId: couponId,
                    recipientPhone: phone
                });

                if (data.success || data) {
                    statusElement.innerHTML = '<span style="color: #48bb78;">‚úÖ Ïπ¥Ïπ¥Ïò§ Î∞úÏÜ°Îê®</span>';
                    logMessage(`Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° ÏÑ±Í≥µ: Ïø†Ìè∞ ${couponId}`, 'success');
                } else {
                    statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                    logMessage(`Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° Ïã§Ìå®: Ïø†Ìè∞ ${couponId} - ${data.message}`, 'error');
                    alert('Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                statusElement.innerHTML = '<span style="color: #f56565;">‚ùå Î∞úÏÜ° Ïã§Ìå®</span>';
                logMessage(`Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° Ïò§Î•ò: Ïø†Ìè∞ ${couponId} - ${error.message}`, 'error');
                alert('Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
            }
        }

        // Ï†ÑÏ≤¥ Ïù¥Î©îÏùº Î∞úÏÜ°
        async function sendAllEmails() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('Î®ºÏ†Ä Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                return;
            }

            if (!confirm('ÏÑ†ÌÉùÌïú Í±∞ÎûòÏ≤òÏùò Î™®Îì† Ïø†Ìè∞Ïóê ÎåÄÌï¥ Ïù¥Î©îÏùºÏùÑ Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/email/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`Ïù¥Î©îÏùº ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥, Ïã§Ìå® ${data.failCount || 0}Í±¥`);
                    loadCouponsForSend(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    logMessage(`Ïù¥Î©îÏùº ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥`, 'success');
                } else {
                    alert('Ïù¥Î©îÏùº ÏùºÍ¥Ñ Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïù¥Î©îÏùº ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
                logMessage('Ïù¥Î©îÏùº ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ï†ÑÏ≤¥ SMS Î∞úÏÜ°
        async function sendAllSMS() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('Î®ºÏ†Ä Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                return;
            }

            if (!confirm('ÏÑ†ÌÉùÌïú Í±∞ÎûòÏ≤òÏùò Î™®Îì† Ïø†Ìè∞Ïóê ÎåÄÌï¥ SMSÎ•º Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/sms/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`SMS ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥, Ïã§Ìå® ${data.failCount || 0}Í±¥`);
                    loadCouponsForSend(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    logMessage(`SMS ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥`, 'success');
                } else {
                    alert('SMS ÏùºÍ¥Ñ Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('SMS ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
                logMessage('SMS ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ï†ÑÏ≤¥ Ïπ¥Ïπ¥Ïò§ÌÜ° Î∞úÏÜ°
        async function sendAllKakao() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const corporateId = document.getElementById('sendCorporateSelect').value;
            if (!corporateId) {
                alert('Î®ºÏ†Ä Í±∞ÎûòÏ≤òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                return;
            }

            if (!confirm('ÏÑ†ÌÉùÌïú Í±∞ÎûòÏ≤òÏùò Î™®Îì† Ïø†Ìè∞Ïóê ÎåÄÌï¥ Ïπ¥Ïπ¥Ïò§ÌÜ°ÏùÑ Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/coupon-send/kakao/bulk', {
                    corporateId: corporateId
                });

                if (data.success || data) {
                    alert(`Ïπ¥Ïπ¥Ïò§ÌÜ° ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥, Ïã§Ìå® ${data.failCount || 0}Í±¥`);
                    loadCouponsForSend(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    logMessage(`Ïπ¥Ïπ¥Ïò§ÌÜ° ÏùºÍ¥Ñ Î∞úÏÜ° ÏôÑÎ£å: ÏÑ±Í≥µ ${data.successCount || 0}Í±¥`, 'success');
                } else {
                    alert('Ïπ¥Ïπ¥Ïò§ÌÜ° ÏùºÍ¥Ñ Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïπ¥Ïπ¥Ïò§ÌÜ° ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
                logMessage('Ïπ¥Ïπ¥Ïò§ÌÜ° ÏùºÍ¥Ñ Î∞úÏÜ° Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== Delivery History Functions ==========

        // Î∞úÏÜ° Í∏∞Î°ù Î°úÎìú
        async function loadDeliveryHistory() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const tbody = document.getElementById('deliveryHistoryBody');
            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;"><span class="loading"></span> Î∞úÏÜ° Í∏∞Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>';

            try {
                const data = await sendApiRequest('GET', '/api/coupon-send/history');
                
                // Extract delivery history array from response
                let deliveryHistory = [];
                if (Array.isArray(data)) {
                    deliveryHistory = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    deliveryHistory = data.data;
                } else if (data && data.history && Array.isArray(data.history)) {
                    deliveryHistory = data.history;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú Î∞úÏÜ° Í∏∞Î°ù ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                displayDeliveryHistory(deliveryHistory);
                updateDeliveryStats(deliveryHistory);
                logMessage(`Î∞úÏÜ° Í∏∞Î°ù ${deliveryHistory.length}Í∞ú Î°úÎìú`, 'success');
                
            } catch (error) {
                if (error.message.includes('404') || error.message.includes('Not Found')) {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">üì≠ Î∞úÏÜ° Í∏∞Î°ù APIÍ∞Ä ÏïÑÏßÅ Íµ¨ÌòÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.<br><small>ÎÇòÏ§ëÏóê Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.</small></td></tr>`;
                    logMessage('Î∞úÏÜ° Í∏∞Î°ù API ÏóÜÏùå: ' + error.message, 'warning');
                } else {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</td></tr>`;
                    logMessage('Î∞úÏÜ° Í∏∞Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                }
            }
        }

        // Î∞úÏÜ° Í∏∞Î°ù ÌëúÏãú
        function displayDeliveryHistory(history) {
            const tbody = document.getElementById('deliveryHistoryBody');
            
            if (!history || history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">Î∞úÏÜ° Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }

            let html = '';
            history.forEach(record => {
                const typeColor = record.deliveryType === 'EMAIL' ? '#e53e3e' : record.deliveryType === 'SMS' ? '#48bb78' : '#f6ad55';
                const statusColor = record.deliveryStatus === 'SENT' ? '#48bb78' : record.deliveryStatus === 'FAILED' ? '#f56565' : '#f6ad55';
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${record.deliveryId}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-family: monospace; font-size: 12px;">${record.couponCode || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">
                            <span style="background: ${typeColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${record.deliveryType}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${record.recipientAddress || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;" title="${record.message || ''}">${(record.subject || record.message || '').substring(0, 20)}${(record.subject || record.message || '').length > 20 ? '...' : ''}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">
                            <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${record.deliveryStatus}</span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; font-size: 12px;">${formatDate(record.sentAt) || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="resendDelivery(${record.deliveryId})" class="btn" style="padding: 4px 8px; font-size: 12px; background: #4299e1; color: white;">Ïû¨Î∞úÏÜ°</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Î∞úÏÜ° ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDeliveryStats(history) {
            const stats = document.getElementById('deliveryStats');
            
            const totalCount = history.length;
            const emailCount = history.filter(h => h.deliveryType === 'EMAIL').length;
            const smsCount = history.filter(h => h.deliveryType === 'SMS').length;
            const kakaoCount = history.filter(h => h.deliveryType === 'KAKAO').length;
            const sentCount = history.filter(h => h.deliveryStatus === 'SENT').length;
            const failedCount = history.filter(h => h.deliveryStatus === 'FAILED').length;
            
            stats.innerHTML = `
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #2c5aa0;">üìä Ï¥ù Î∞úÏÜ°</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #333;">${totalCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #48bb78;">‚úÖ ÏÑ±Í≥µ</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #48bb78;">${sentCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #f56565;">‚ùå Ïã§Ìå®</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #f56565;">${failedCount}</div>
                </div>
                <div class="card" style="text-align: center; padding: 15px;">
                    <h4 style="margin: 0; color: #667eea;">üìß Ïù¥Î©îÏùº</h4>
                    <div style="font-size: 24px; font-weight: bold; color: #e53e3e;">${emailCount}</div>
                </div>
            `;
        }

        // Î∞úÏÜ° Í∏∞Î°ù ÌïÑÌÑ∞
        async function filterDeliveryHistory() {
            // ÌïÑÌÑ∞ Í∏∞Îä• Íµ¨ÌòÑ (placeholder)
            alert('Î∞úÏÜ° Í∏∞Î°ù ÌïÑÌÑ∞ Í∏∞Îä•Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        // Ïû¨Î∞úÏÜ°
        async function resendDelivery(deliveryId) {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            if (!confirm('Ïù¥ Î∞úÏÜ°ÏùÑ Îã§Ïãú ÏãúÎèÑÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            try {
                const data = await sendApiRequest('POST', `/api/delivery-history/${deliveryId}/resend`);

                if (data.success || data) {
                    alert('Ïû¨Î∞úÏÜ°Ïù¥ ÏöîÏ≤≠ÎêòÏóàÏäµÎãàÎã§.');
                    loadDeliveryHistory(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    logMessage(`Î∞úÏÜ° Ïû¨ÏãúÎèÑ: ${deliveryId}`, 'success');
                } else {
                    alert('Ïû¨Î∞úÏÜ° Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïû¨Î∞úÏÜ° Ïò§Î•ò: ' + error.message);
                logMessage('Ïû¨Î∞úÏÜ° Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== Email Configuration Functions ==========

        // Ïù¥Î©îÏùº ÏÑ§Ï†ï ÌîÑÎ¶¨ÏÖã Ï†ÅÏö©
        function applyGmailPreset() {
            document.getElementById('smtpHost').value = 'smtp.gmail.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Gmail ÏÑ§Ï†ïÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
        }

        function applyOutlookPreset() {
            document.getElementById('smtpHost').value = 'smtp-mail.outlook.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Outlook ÏÑ§Ï†ïÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
        }

        function applyYahooPreset() {
            document.getElementById('smtpHost').value = 'smtp.mail.yahoo.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Yahoo ÏÑ§Ï†ïÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
        }

        function applyNaverPreset() {
            document.getElementById('smtpHost').value = 'smtp.naver.com';
            document.getElementById('smtpPort').value = '587';
            document.querySelector('input[name="security"][value="tls"]').checked = true;
            alert('Naver ÏÑ§Ï†ïÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§. ÏÇ¨Ïö©ÏûêÎ™ÖÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
        }

        function applyEcountPreset() {
            alert('Ecount ÏÑ§Ï†ï ÌîÑÎ¶¨ÏÖãÏù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        // Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû•
        async function saveEmailConfig() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const emailConfig = {
                smtpHost: document.getElementById('smtpHost').value,
                smtpPort: parseInt(document.getElementById('smtpPort').value),
                security: document.querySelector('input[name="security"]:checked').value,
                username: document.getElementById('smtpUsername').value,
                password: document.getElementById('smtpPassword').value
            };

            if (!emailConfig.smtpHost || !emailConfig.smtpPort || !emailConfig.username || !emailConfig.password) {
                alert('ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/email', emailConfig);

                if (data.success || data) {
                    alert('Ïù¥Î©îÏùº ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                    logMessage('Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å', 'success');
                } else {
                    alert('Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò: ' + error.message);
                logMessage('Ïù¥Î©îÏùº ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ïù¥Î©îÏùº ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
        async function loadEmailConfig() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('GET', '/api/config/email');

                if (data.success || data) {
                    const config = data.data || data;
                    document.getElementById('smtpHost').value = config.smtpHost || '';
                    document.getElementById('smtpPort').value = config.smtpPort || '';
                    document.getElementById('smtpUsername').value = config.username || '';
                    document.getElementById('smtpPassword').value = config.password || '';
                    
                    if (config.security) {
                        const securityRadio = document.querySelector(`input[name="security"][value="${config.security}"]`);
                        if (securityRadio) securityRadio.checked = true;
                    }

                    alert('Ïù¥Î©îÏùº ÏÑ§Ï†ïÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    logMessage('Ïù¥Î©îÏùº ÏÑ§Ï†ï Î°úÎìú ÏôÑÎ£å', 'success');
                } else {
                    alert('Ïù¥Î©îÏùº ÏÑ§Ï†ïÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            } catch (error) {
                alert('Ïù¥Î©îÏùº ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò: ' + error.message);
                logMessage('Ïù¥Î©îÏùº ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
        async function testEmailConnection() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/email/test');

                if (data.success || data) {
                    alert('Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ!');
                    logMessage('Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ', 'success');
                } else {
                    alert('Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïò§Î•ò: ' + error.message);
                logMessage('Ïù¥Î©îÏùº Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== SMS Configuration Functions ==========

        // SMS ÏÑ§Ï†ï Ï†ÄÏû•
        async function saveSmsConfig() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const smsConfig = {
                apiUrl: document.getElementById('smsApiUrl').value,
                senderNumber: document.getElementById('smsSenderNumber').value,
                senderName: document.getElementById('smsSenderName').value,
                testMode: document.getElementById('smsTestMode').checked
            };

            if (!smsConfig.apiUrl || !smsConfig.senderNumber) {
                alert('ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/sms', smsConfig);

                if (data.success || data) {
                    alert('SMS ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                    logMessage('SMS ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å', 'success');
                } else {
                    alert('SMS ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('SMS ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò: ' + error.message);
                logMessage('SMS ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // SMS ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
        async function loadSmsConfig() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('GET', '/api/config/sms');

                if (data.success || data) {
                    const config = data.data || data;
                    document.getElementById('smsApiUrl').value = config.apiUrl || '';
                    document.getElementById('smsSenderNumber').value = config.senderNumber || '';
                    document.getElementById('smsSenderName').value = config.senderName || '';
                    document.getElementById('smsTestMode').checked = config.testMode || false;

                    alert('SMS ÏÑ§Ï†ïÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    logMessage('SMS ÏÑ§Ï†ï Î°úÎìú ÏôÑÎ£å', 'success');
                } else {
                    alert('SMS ÏÑ§Ï†ïÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            } catch (error) {
                alert('SMS ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò: ' + error.message);
                logMessage('SMS ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
        async function testSmsConnection() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const data = await sendApiRequest('POST', '/api/config/sms/test');

                if (data.success || data) {
                    alert('SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ!');
                    logMessage('SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ', 'success');
                } else {
                    alert('SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                alert('SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïò§Î•ò: ' + error.message);
                logMessage('SMS Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ========== Coupon Distribution Functions ==========

        // Ïø†Ìè∞ Î∞úÌñâÏùÑ ÏúÑÌïú ÏßÅÏõê Î™©Î°ù Î°úÎìú
        async function loadEmployeesForCoupon() {
            const corporateId = document.getElementById('couponCorporateSelect').value;
            
            if (!corporateId) {
                document.getElementById('couponSettingsPanel').style.display = 'none';
                document.getElementById('employeeDistributionPanel').style.display = 'none';
                return;
            }

            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const data = await sendApiRequest('GET', `/api/corporates/${corporateId}/employees`);
                
                // Extract employees array from response (similar to other employee loading functions)
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && Array.isArray(data.result)) {
                    employees = data.result;
                } else if (data && data.success && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏßÅÏõê ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                if (employees && employees.length > 0) {
                    couponEmployees = employees;
                    document.getElementById('couponSettingsPanel').style.display = 'block';
                    calculateDistribution();
                    logMessage(`Ïø†Ìè∞ Î∞úÌñâÏö© ÏßÅÏõê ${employees.length}Î™Ö Î°úÎìú`, 'success');
                } else {
                    alert('Ìï¥Îãπ Í±∞ÎûòÏ≤òÏóê Îì±Î°ùÎêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.');
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                }
                
            } catch (error) {
                alert('ÏßÅÏõê Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message);
                logMessage('Ïø†Ìè∞ Î∞úÌñâÏö© ÏßÅÏõê Î™©Î°ù Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Ìè¨Ïù∏Ìä∏ ÏûÖÎ†• Î∞©Ïãù ÌÜ†Í∏Ä
        function togglePointInput() {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointDescription = document.getElementById('pointDescription');
            const pointValue = document.getElementById('pointValue');
            
            if (pointType === 'percentage') {
                pointDescription.textContent = 'ÌòÑÍ∏à Ï∂©Ï†ÑÏï°Ïùò % ÎßåÌÅº Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â';
                pointValue.placeholder = '10';
                // Í∏∞Ï°¥ Í∞íÏù¥ ÏûàÏúºÎ©¥ Ìè¨Îß∑ Îã§Ïãú Ï†ÅÏö©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'fixed') {
                pointDescription.textContent = 'Ïø†Ìè∞ 1Ïû•Îãπ Í≥†Ï†ï Ìè¨Ïù∏Ìä∏ ÏßÄÍ∏â';
                pointValue.placeholder = '1,000';
                // Í∏∞Ï°¥ Í∞íÏù¥ ÏûàÏúºÎ©¥ Ìè¨Îß∑ Îã§Ïãú Ï†ÅÏö©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            } else if (pointType === 'total') {
                pointDescription.textContent = 'Ï¥ù Ìè¨Ïù∏Ìä∏Î•º ÏßÅÏõêÎì§ÏóêÍ≤å Í∑†Îì± Î∂ÑÎ∞∞';
                pointValue.placeholder = '100,000';
                // Í∏∞Ï°¥ Í∞íÏù¥ ÏûàÏúºÎ©¥ Ìè¨Îß∑ Îã§Ïãú Ï†ÅÏö©
                if (pointValue.value) {
                    formatPointInput(pointValue);
                }
            }
            
            calculateDistribution();
        }

        // Ï≤úÎã®ÏúÑ ÏΩ§Îßà Ìè¨Îß∑ÌåÖ Ìï®Ïàò
        function formatCurrencyInput(input) {
            // ÏûÖÎ†•Í∞íÏóêÏÑú Ïà´ÏûêÎßå Ï∂îÏ∂ú
            let value = input.value.replace(/[^\d]/g, '');
            
            // Îπà Í∞í Ï≤òÎ¶¨
            if (value === '') {
                input.value = '';
                calculateDistribution();
                return;
            }
            
            // Ï≤úÎã®ÏúÑÎßàÎã§ ÏΩ§Îßà Ï∂îÍ∞Ä
            let formattedValue = parseInt(value).toLocaleString();
            input.value = formattedValue;
            
            // Î∞∞Î∂Ñ Ïû¨Í≥ÑÏÇ∞
            calculateDistribution();
        }

        // Ìè¨Ïù∏Ìä∏ ÏûÖÎ†• Ìè¨Îß∑ÌåÖ Ìï®Ïàò (Ï†ïÎ•†Ïùº ÎïåÎäî ÏÜåÏàòÏ†ê ÌóàÏö©, Ï†ïÏï°/Ï¥ùÌè¨Ïù∏Ìä∏Ïùº ÎïåÎäî ÏΩ§Îßà ÌëúÏãú)
        function formatPointInput(input) {
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            
            if (pointType === 'percentage') {
                // Ï†ïÎ•†Ïùº ÎïåÎäî ÏÜåÏàòÏ†ê ÌóàÏö©, ÏΩ§Îßà ÏóÜÏùå
                let value = input.value.replace(/[^\d.]/g, '');
                // ÏÜåÏàòÏ†êÏù¥ Ïó¨Îü¨ Í∞ú ÏûàÏúºÎ©¥ Ï≤´ Î≤àÏß∏Îßå Ïú†ÏßÄ
                let parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                input.value = value;
            } else {
                // Ï†ïÏï°/Ï¥ùÌè¨Ïù∏Ìä∏Ïùº ÎïåÎäî Ï≤úÎã®ÏúÑ ÏΩ§Îßà Ï†ÅÏö©
                let value = input.value.replace(/[^\d]/g, '');
                if (value === '') {
                    input.value = '';
                } else {
                    input.value = parseInt(value).toLocaleString();
                }
            }
            
            calculateDistribution();
        }

        // ÏΩ§ÎßàÍ∞Ä Ìè¨Ìï®Îêú Î¨∏ÏûêÏó¥ÏóêÏÑú Ïà´ÏûêÍ∞í Ï∂îÏ∂ú
        function getNumericValue(formattedString) {
            if (!formattedString) return 0;
            return parseFloat(formattedString.replace(/,/g, '')) || 0;
        }

        // Î∞∞Î∂Ñ Í≥ÑÏÇ∞
        function calculateDistribution() {
            if (couponEmployees.length === 0) {
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            
            const employeeCount = couponEmployees.length;
            const cashPerEmployee = totalCash / employeeCount;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100; // ÏÜåÏàòÏ†ê 2ÏûêÎ¶¨
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                // Ï¥ù Ìè¨Ïù∏Ìä∏Î•º ÏßÅÏõê ÏàòÎ°ú ÎÇòÎàÑÏñ¥ Í∑†Îì± Î∞∞Î∂Ñ
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
            updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee);
            
            // ÏöîÏïΩ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateDistributionSummary(totalCash, pointPerEmployee * employeeCount, employeeCount);
            
            // Ìå®ÎÑê ÌëúÏãú
            document.getElementById('employeeDistributionPanel').style.display = 'block';
            
            // Î∞úÌñâ Î≤ÑÌäº ÌôúÏÑ±Ìôî Ï°∞Í±¥ Ï≤¥ÌÅ¨
            const canIssue = totalCash > 0 && document.getElementById('expireDate').value;
            document.getElementById('issueCouponsBtn').disabled = !canIssue;
        }

        // ÏßÅÏõêÎ≥Ñ Î∞∞Î∂Ñ ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
        function updateEmployeeDistributionTable(cashPerEmployee, pointPerEmployee) {
            const tbody = document.getElementById('employeeDistributionBody');
            let html = '';
            
            couponEmployees.forEach(employee => {
                const displayName = employee.name || employee.phone;
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${displayName}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.phone}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.email || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #e53e3e;">
                            ‚Ç©${cashPerEmployee.toLocaleString()}
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right; font-weight: bold; color: #38a169;">
                            ${pointPerEmployee.toLocaleString()}P
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // Î∞∞Î∂Ñ ÏöîÏïΩ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDistributionSummary(totalCash, totalPoints, employeeCount) {
            const summary = document.getElementById('distributionSummary');
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = document.getElementById('pointValue').value;
            
            let pointDescription = '';
            if (pointType === 'percentage') {
                pointDescription = `ÌòÑÍ∏àÏùò ${pointValue}%`;
            } else if (pointType === 'fixed') {
                pointDescription = `Ïø†Ìè∞Îãπ ${pointValue.toLocaleString()}P`;
            } else if (pointType === 'total') {
                pointDescription = `Ï¥ù ${pointValue.toLocaleString()}P Í∑†Îì±Î∞∞Î∂Ñ`;
            }
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #2c5aa0;">üë• ÎåÄÏÉÅ ÏßÅÏõê:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${employeeCount}Î™Ö</span>
                    </div>
                    <div>
                        <strong style="color: #e53e3e;">üí∞ Ï¥ù ÌòÑÍ∏à:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">‚Ç©${totalCash.toLocaleString()}</span>
                    </div>
                    <div>
                        <strong style="color: #38a169;">üéØ Ï¥ù Ìè¨Ïù∏Ìä∏:</strong><br>
                        <span style="font-size: 18px; font-weight: bold;">${totalPoints.toLocaleString()}P</span><br>
                        <small style="color: #666;">(${pointDescription})</small>
                    </div>
                    <div>
                        <strong style="color: #667eea;">üìä ÏßÅÏõêÎãπ ÌèâÍ∑†:</strong><br>
                        <span style="font-size: 14px;">ÌòÑÍ∏à: ‚Ç©${(totalCash/employeeCount).toLocaleString()}</span><br>
                        <span style="font-size: 14px;">Ìè¨Ïù∏Ìä∏: ${(totalPoints/employeeCount).toLocaleString()}P</span>
                    </div>
                </div>
            `;
        }

        // ÎßåÎ£åÏùº ÏÑ§Ï†ï Ìï®Ïàò
        function setExpireDate(months) {
            const today = new Date();
            today.setMonth(today.getMonth() + months);
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('expireDate').value = dateString;
            
            // Î∞∞Î∂Ñ Îã§Ïãú Í≥ÑÏÇ∞ÌïòÏó¨ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            calculateDistribution();
        }

        // ÏÇ¨Ïö© Í∞ÄÎä• ÏöîÏùº Î¨∏ÏûêÏó¥ ÏÉùÏÑ± (7ÏûêÎ¶¨ 0Í≥º 1Î°ú Íµ¨ÏÑ±Îêú Î¨∏ÏûêÏó¥)
        // ÏùºÏõîÌôîÏàòÎ™©Í∏àÌÜ† ÏàúÏÑúÎ°ú ÏÇ¨Ïö©Í∞ÄÎä•ÌïòÎ©¥ 1, Î∂àÍ∞ÄÎä•ÌïòÎ©¥ 0
        function getAvailableDaysString() {
            const dayOrder = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
            let binaryString = '';
            
            for (const day of dayOrder) {
                const checkbox = document.querySelector(`.available-day[value="${day}"]`);
                binaryString += checkbox && checkbox.checked ? '1' : '0';
            }
            
            return binaryString;
        }

        // Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ
        async function issueCoupons() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (couponEmployees.length === 0) {
                alert('Î∞úÌñâÌï† ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const totalCash = getNumericValue(document.getElementById('totalCashAmount').value);
            const pointType = document.querySelector('input[name="pointType"]:checked').value;
            const pointValue = getNumericValue(document.getElementById('pointValue').value);
            const expireDate = document.getElementById('expireDate').value;
            const availableDays = getAvailableDaysString();

            if (!totalCash || !expireDate) {
                alert('ÌïÑÏàò Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const employeeCount = couponEmployees.length;
            const cashPerEmployee = Math.round((totalCash / employeeCount) * 100) / 100;
            
            let pointPerEmployee = 0;
            if (pointType === 'percentage') {
                pointPerEmployee = Math.round((cashPerEmployee * pointValue / 100) * 100) / 100;
            } else if (pointType === 'fixed') {
                pointPerEmployee = pointValue;
            } else if (pointType === 'total') {
                pointPerEmployee = Math.round((pointValue / employeeCount) * 100) / 100;
            }

            const corporateName = document.getElementById('couponCorporateSelect').options[document.getElementById('couponCorporateSelect').selectedIndex].textContent;
            
            if (!confirm(`${corporateName}Ïùò ${employeeCount}Î™Ö ÏßÅÏõêÏóêÍ≤å Ïø†Ìè∞ÏùÑ Î∞úÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n` +
                        `‚Ä¢ ÏßÅÏõêÎãπ ÌòÑÍ∏à: ‚Ç©${cashPerEmployee.toLocaleString()}\n` +
                        `‚Ä¢ ÏßÅÏõêÎãπ Ìè¨Ïù∏Ìä∏: ${pointPerEmployee.toLocaleString()}P\n` +
                        `‚Ä¢ ÎßåÎ£åÏùº: ${expireDate}`)) {
                return;
            }

            const issueBtn = document.getElementById('issueCouponsBtn');
            
            issueBtn.disabled = true;
            issueBtn.textContent = 'Î∞úÌñâ Ï§ë...';
            
            let successCount = 0;
            let failCount = 0;
            const errors = [];

            try {
                for (let i = 0; i < couponEmployees.length; i++) {
                    const employee = couponEmployees[i];
                    
                    try {
                        // Ïø†Ìè∞ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
                        // Full coupon codeÎäî ÏÑúÎ≤ÑÏóêÏÑú ÏûêÎèô ÏÉùÏÑ±Îê®:
                        // {Î∞úÍ∏âÏûê_ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏}-{ÏÇ¨Ïö©Í∞ÄÎä•ÏöîÏùº(7ÏûêÎ¶¨)}-{coupon_id(10ÏûêÎ¶¨)}-{Í≤∞Ï†úÏú†ÌòïÏΩîÎìú}-{Ìå®Î¶¨Ìã∞(3ÏûêÎ¶¨)}
                        const couponData = {
                            employeeId: employee.employeeId,
                            cashBalance: cashPerEmployee,
                            pointBalance: pointPerEmployee,
                            expireDate: expireDate,
                            status: 'ACTIVE',
                            paymentType: 'PREPAID',  // Í≤∞Ï†úÏú†Ìòï: PREPAID(1) or POSTPAID(2)
                            availableDays: availableDays  // 7ÏûêÎ¶¨ Ïù¥ÏßÑ Î¨∏ÏûêÏó¥ (ÏùºÏõîÌôîÏàòÎ™©Í∏àÌÜ†)
                        };

                        const data = await sendApiRequest('POST', '/api/coupons', couponData);

                        if (data.success || data) {
                            successCount++;
                            logMessage(`Ïø†Ìè∞ Î∞úÌñâ ÏÑ±Í≥µ: ${employee.name || employee.phone}`, 'success');
                        } else {
                            failCount++;
                            const displayName = employee.name || employee.phone;
                            errors.push(`${displayName}: ${data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                            logMessage(`Ïø†Ìè∞ Î∞úÌñâ Ïã§Ìå®: ${displayName} - ${data.message}`, 'error');
                        }
                    } catch (error) {
                        failCount++;
                        const displayName = employee.name || employee.phone;
                        errors.push(`${displayName}: ${error.message}`);
                        logMessage(`Ïø†Ìè∞ Î∞úÌñâ Ïò§Î•ò: ${displayName} - ${error.message}`, 'error');
                    }

                    // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                    issueBtn.textContent = `Î∞úÌñâ Ï§ë... (${i + 1}/${couponEmployees.length})`;
                }

                // Í≤∞Í≥º ÏïåÎ¶º
                let message = `Ïø†Ìè∞ Î∞úÌñâ ÏôÑÎ£å!\nÏÑ±Í≥µ: ${successCount}Í±¥, Ïã§Ìå®: ${failCount}Í±¥`;
                if (errors.length > 0) {
                    message += '\n\nÏã§Ìå® ÎÇ¥Ïó≠:\n' + errors.slice(0, 5).join('\n');
                    if (errors.length > 5) {
                        message += `\n... Ïô∏ ${errors.length - 5}Í±¥ Îçî`;
                    }
                }

                alert(message);

                if (successCount > 0) {
                    // ÏÑ±Í≥µ Ïãú Ìèº Î¶¨ÏÖã
                    document.getElementById('totalCashAmount').value = '';
                    document.getElementById('pointValue').value = '';
                    document.getElementById('employeeDistributionPanel').style.display = 'none';
                    
                    logMessage(`Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ ÏôÑÎ£å - ÏÑ±Í≥µ: ${successCount}Í±¥, Ïã§Ìå®: ${failCount}Í±¥`, 'success');
                }

            } catch (error) {
                alert('Ïø†Ìè∞ Î∞úÌñâ Ïò§Î•ò: ' + error.message);
                logMessage('Ïø†Ìè∞ Î∞úÌñâ ÏãúÏä§ÌÖú Ïò§Î•ò: ' + error.message, 'error');
            } finally {
                issueBtn.disabled = false;
                issueBtn.textContent = 'üé´ Ïø†Ìè∞ ÏùºÍ¥Ñ Î∞úÌñâ';
            }
        }

        // ========== System Settings Functions ==========

        function toggleTimeBasedControls() {
            const checkbox = document.getElementById('enableTimeBasedDeduction');
            const controls = document.getElementById('timeBasedControls');
            
            if (checkbox.checked) {
                controls.style.opacity = '1';
                controls.style.pointerEvents = 'auto';
            } else {
                controls.style.opacity = '0.5';
                controls.style.pointerEvents = 'none';
            }
        }

        async function loadSystemSettings() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const settings = await sendApiRequest('GET', '/api/system/settings');
                applySettingsToUI(settings);
                logMessage('ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.', 'success');
            } catch (error) {
                alert('ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message);
                logMessage('ÏãúÏä§ÌÖú ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        async function saveSystemSettings() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const settings = {
                enable_time_based_deduction: document.getElementById('enableTimeBasedDeduction').checked.toString(),
                breakfast_start_time: document.getElementById('breakfastStartTime').value,
                breakfast_end_time: document.getElementById('breakfastEndTime').value,
                breakfast_cash_deduction: document.getElementById('breakfastCashDeduction').value,
                lunch_start_time: document.getElementById('lunchStartTime').value,
                lunch_end_time: document.getElementById('lunchEndTime').value,
                lunch_cash_deduction: document.getElementById('lunchCashDeduction').value,
                dinner_start_time: document.getElementById('dinnerStartTime').value,
                dinner_end_time: document.getElementById('dinnerEndTime').value,
                dinner_cash_deduction: document.getElementById('dinnerCashDeduction').value,
                default_cash_deduction: document.getElementById('defaultCashDeduction').value,
                point_deduction_method: document.getElementById('pointDeductionMethod').value,
                allow_negative_balance: document.getElementById('allowNegativeBalance').checked.toString()
            };

            try {
                await sendApiRequest('POST', '/api/system/settings', settings);
                alert('ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                logMessage('ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•ÌñàÏäµÎãàÎã§.', 'success');
            } catch (error) {
                alert('ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + error.message);
                logMessage('ÏãúÏä§ÌÖú ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        function applySettingsToUI(settings) {
            document.getElementById('enableTimeBasedDeduction').checked = settings.enable_time_based_deduction === 'true';
            document.getElementById('breakfastStartTime').value = settings.breakfast_start_time || '06:00';
            document.getElementById('breakfastEndTime').value = settings.breakfast_end_time || '10:59';
            document.getElementById('breakfastCashDeduction').value = settings.breakfast_cash_deduction || '3000';
            document.getElementById('lunchStartTime').value = settings.lunch_start_time || '11:00';
            document.getElementById('lunchEndTime').value = settings.lunch_end_time || '14:59';
            document.getElementById('lunchCashDeduction').value = settings.lunch_cash_deduction || '5000';
            document.getElementById('dinnerStartTime').value = settings.dinner_start_time || '15:00';
            document.getElementById('dinnerEndTime').value = settings.dinner_end_time || '21:59';
            document.getElementById('dinnerCashDeduction').value = settings.dinner_cash_deduction || '7000';
            document.getElementById('defaultCashDeduction').value = settings.default_cash_deduction || '1000';
            document.getElementById('pointDeductionMethod').value = settings.point_deduction_method || 'ÌõÑÏàúÏúÑ';
            document.getElementById('allowNegativeBalance').checked = settings.allow_negative_balance === 'true';
            
            toggleTimeBasedControls();
        }

        function testCurrentDeduction() {
            alert('Ï∞®Í∞êÏï° ÌÖåÏä§Ìä∏ Í∏∞Îä•Ïù¥ Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }


        // ========== Management Information Functions ==========

        // Tab switching functionality
        function showManagementTab(tabName) {
            // Hide all tabs
            document.getElementById('statisticsTab').style.display = 'none';
            document.getElementById('monthlyReportTab').style.display = 'none';
            
            // Remove active class from all buttons
            document.getElementById('statisticsTabBtn').classList.remove('active');
            document.getElementById('monthlyReportTabBtn').classList.remove('active');
            
            // Show selected tab and activate button
            document.getElementById(tabName + 'Tab').style.display = 'block';
            document.getElementById(tabName + 'TabBtn').classList.add('active');
            
            // Initialize tab-specific data
            if (tabName === 'monthlyReport') {
                initializeMonthlyReport();
            }
            
            logMessage(`Í≤ΩÏòÅÏ†ïÎ≥¥ ÌÉ≠ Ï†ÑÌôò: ${tabName}`, 'info');
        }

        // Set current month in date pickers
        function setCurrentMonth() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            
            document.getElementById('statsStartDate').value = `${year}-${month}-01`;
            
            // Calculate last day of current month
            const lastDay = new Date(year, now.getMonth() + 1, 0).getDate();
            document.getElementById('statsEndDate').value = `${year}-${month}-${String(lastDay).padStart(2, '0')}`;
            
            logMessage('ÎÇ†Ïßú Î≤îÏúÑÎ•º ÌòÑÏû¨ ÏõîÎ°ú ÏÑ§Ï†ïÌñàÏäµÎãàÎã§.', 'info');
        }

        // Load management statistics
        async function loadManagementStats() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            if (!startDate || !endDate) {
                alert('ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                return;
            }

            const tbody = document.getElementById('corporateStatsBody');
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px;"><span class="loading"></span> ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>';

            try {
                const data = await sendApiRequest('GET', `/api/statistics/corporate?startDate=${startDate}&endDate=${endDate}`);
                logMessage('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏàòÏã†: ' + JSON.stringify(data), 'info');
                
                // Extract stats array from response
                let statsData = [];
                if (Array.isArray(data)) {
                    statsData = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    statsData = data.data;
                } else if (data && data.statistics && Array.isArray(data.statistics)) {
                    statsData = data.statistics;
                } else {
                    logMessage('ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÌÜµÍ≥Ñ ÏùëÎãµ ÌòïÏãù: ' + JSON.stringify(data), 'warning');
                }
                
                displayManagementStats(statsData);
                logMessage(`ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ ${statsData.length}Í∞ú Î°úÎìú`, 'success');
                
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</td></tr>`;
                logMessage('ÌÜµÍ≥Ñ Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                
                // Reset summary stats on error
                document.getElementById('totalCorporates').textContent = '0';
                document.getElementById('totalIssuedCoupons').textContent = '0';
                document.getElementById('totalUsedCoupons').textContent = '0';
                document.getElementById('overallUsageRate').textContent = '0%';
            }
        }

        // Display management statistics
        function displayManagementStats(statsData) {
            let totalCorporates = 0;
            let totalIssued = 0;
            let totalUsed = 0;
            let totalCash = 0;
            let totalPoints = 0;
            
            const tbody = document.getElementById('corporateStatsBody');
            
            if (!statsData || statsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px; color: #666;">ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            let html = '';
            
            statsData.forEach(corporate => {
                const issued = corporate.issuedCoupons || 0;
                const used = corporate.usedCoupons || 0;
                const unused = issued - used;
                const usageRate = issued > 0 ? Math.round((used / issued) * 100) : 0;
                const cashValue = corporate.totalCashValue || 0;
                const pointValue = corporate.totalPointValue || 0;
                
                totalCorporates++;
                totalIssued += issued;
                totalUsed += used;
                totalCash += cashValue;
                totalPoints += pointValue;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${corporate.name}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${corporate.employeeCount || 0}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${issued.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${used.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${unused.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="color: ${usageRate >= 70 ? '#48bb78' : usageRate >= 40 ? '#f6ad55' : '#f56565'}; font-weight: bold;">
                                ${usageRate}%
                            </span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashValue.toLocaleString()}Ïõê</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointValue.toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <button onclick="showCorporateDetail(${corporate.customerId || corporate.id}, '${corporate.name}')" class="btn btn-sm" style="background: #4299e1; color: white; padding: 5px 10px; font-size: 12px;">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Update summary statistics
            const overallUsageRate = totalIssued > 0 ? Math.round((totalUsed / totalIssued) * 100) : 0;
            
            document.getElementById('totalCorporates').textContent = totalCorporates.toLocaleString();
            document.getElementById('totalIssuedCoupons').textContent = totalIssued.toLocaleString();
            document.getElementById('totalUsedCoupons').textContent = totalUsed.toLocaleString();
            document.getElementById('overallUsageRate').textContent = overallUsageRate + '%';
        }

        // Show corporate detail modal
        async function showCorporateDetail(corporateId, corporateName) {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }

            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            document.getElementById('corporateDetailTitle').textContent = `${corporateName} ÏÉÅÏÑ∏ ÌÜµÍ≥Ñ`;
            document.getElementById('corporateDetailContent').innerHTML = '<div style="text-align: center; padding: 40px;"><span class="loading"></span> Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>';
            document.getElementById('corporateDetailModal').style.display = 'block';

            try {
                const data = await sendApiRequest('GET', `/api/statistics/corporate/${corporateId}?startDate=${startDate}&endDate=${endDate}`);
                
                let employees = [];
                if (Array.isArray(data)) {
                    employees = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    employees = data.data;
                } else if (data && data.employees && Array.isArray(data.employees)) {
                    employees = data.employees;
                }
                
                displayCorporateDetail(employees, corporateName);
                
            } catch (error) {
                document.getElementById('corporateDetailContent').innerHTML = `<div style="text-align: center; padding: 40px; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</div>`;
                logMessage('Í±∞ÎûòÏ≤ò ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Display corporate detail data
        function displayCorporateDetail(employees, corporateName) {
            if (!employees || employees.length === 0) {
                document.getElementById('corporateDetailContent').innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Ìï¥Îãπ Í±∞ÎûòÏ≤òÏùò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = `
                <div style="max-height: 500px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: left;">ÏßÅÏõêÎ™Ö</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">Î∞úÌñâ</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÇ¨Ïö©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÎØ∏ÏÇ¨Ïö©</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">ÏÇ¨Ïö©Î•†</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">ÌòÑÍ∏à ÏûîÏï°</th>
                                <th style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">Ìè¨Ïù∏Ìä∏ ÏûîÏï°</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            employees.forEach(employee => {
                const issued = employee.issuedCoupons || 0;
                const used = employee.usedCoupons || 0;
                const unused = issued - used;
                const usageRate = issued > 0 ? Math.round((used / issued) * 100) : 0;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${employee.name || employee.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${issued}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${used}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${unused}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">
                            <span style="color: ${usageRate >= 70 ? '#48bb78' : usageRate >= 40 ? '#f6ad55' : '#f56565'}; font-weight: bold;">
                                ${usageRate}%
                            </span>
                        </td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${(employee.cashBalance || 0).toLocaleString()}Ïõê</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${(employee.pointBalance || 0).toLocaleString()}P</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('corporateDetailContent').innerHTML = html;
        }

        // Close corporate detail modal
        function closeCorporateDetailModal() {
            document.getElementById('corporateDetailModal').style.display = 'none';
        }

        // Export statistics to Excel
        function exportStatsToExcel() {
            const table = document.getElementById('corporateStatsTable');
            const tbody = document.getElementById('corporateStatsBody');
            
            if (!tbody.children.length || tbody.innerHTML.includes('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏÑ∏Ïöî') || tbody.innerHTML.includes('Ïò§Î•ò')) {
                alert('Î®ºÏ†Ä ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÏÑ∏Ïöî.');
                return;
            }
            
            let csv = '\uFEFF'; // BOM for Korean characters
            csv += 'Í±∞ÎûòÏ≤òÎ™Ö,ÏßÅÏõê Ïàò,Î∞úÌñâ,ÏÇ¨Ïö©,ÎØ∏ÏÇ¨Ïö©,ÏÇ¨Ïö©Î•†,ÌòÑÍ∏à Í∞ÄÏπò,Ìè¨Ïù∏Ìä∏ Í∞ÄÏπò\n';
            
            Array.from(tbody.children).forEach(row => {
                if (row.children.length >= 8) {
                    const cols = Array.from(row.children).slice(0, 8);
                    csv += cols.map(col => {
                        let text = col.textContent.trim();
                        // Remove commas from numbers and add quotes for CSV
                        if (text.includes(',') || text.includes('"')) {
                            text = '"' + text.replace(/"/g, '""') + '"';
                        }
                        return text;
                    }).join(',') + '\n';
                }
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Í±∞ÎûòÏ≤òÎ≥Ñ_ÌÜµÍ≥Ñ_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logMessage('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º CSV ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÉàÏäµÎãàÎã§.', 'success');
        }

        // Initialize monthly report tab
        function initializeMonthlyReport() {
            // Populate year dropdown
            const yearSelect = document.getElementById('reportYear');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = currentYear; year >= currentYear - 5; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ÎÖÑ';
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            // Set current month
            const monthSelect = document.getElementById('reportMonth');
            monthSelect.value = new Date().getMonth() + 1;
            
            // Load corporates for filter
            loadCorporatesForMonthlyReport();
        }

        // Load corporates for monthly report filter
        async function loadCorporatesForMonthlyReport() {
            if (!androidServerConnected) return;
            
            try {
                const data = await sendApiRequest('GET', '/api/corporates');
                
                let corporates = [];
                if (Array.isArray(data)) {
                    corporates = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    corporates = data.data;
                }
                
                const select = document.getElementById('reportCorporateFilter');
                select.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';
                
                corporates.forEach(corporate => {
                    const option = document.createElement('option');
                    option.value = corporate.customerId || corporate.id;
                    option.textContent = corporate.name;
                    select.appendChild(option);
                });
                
            } catch (error) {
                logMessage('ÏõîÍ∞ÑÎ≥¥Í≥†ÏÑúÏö© Í±∞ÎûòÏ≤ò Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // Load monthly report
        async function loadMonthlyReport() {
            if (!androidServerConnected) {
                alert('Î®ºÏ†Ä Android ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.');
                return;
            }
            
            const year = document.getElementById('reportYear').value;
            const month = document.getElementById('reportMonth').value;
            const corporateId = document.getElementById('reportCorporateFilter').value;
            
            const tbody = document.getElementById('monthlyReportBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;"><span class="loading"></span> Î≥¥Í≥†ÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td></tr>';
            
            try {
                let url = `/api/monthly-report?year=${year}&month=${month}`;
                if (corporateId) {
                    url += `&corporateId=${corporateId}`;
                }
                
                const data = await sendApiRequest('GET', url);
                
                let reportData = [];
                if (Array.isArray(data)) {
                    reportData = data;
                } else if (data && data.data && Array.isArray(data.data)) {
                    reportData = data.data;
                } else if (data && data.report && Array.isArray(data.report)) {
                    reportData = data.report;
                }
                
                displayMonthlyReport(reportData);
                logMessage(`ÏõîÍ∞ÑÎ≥¥Í≥†ÏÑú Îç∞Ïù¥ÌÑ∞ ${reportData.length}Í∞ú Î°úÎìú`, 'success');
                
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 20px; color: #f56565;">‚ùå Ïò§Î•ò: ${error.message}</td></tr>`;
                logMessage('ÏõîÍ∞ÑÎ≥¥Í≥†ÏÑú Î°úÎìú Ïò§Î•ò: ' + error.message, 'error');
                
                // Reset summary on error
                resetMonthlySummary();
            }
        }

        // Display monthly report
        function displayMonthlyReport(reportData) {
            const tbody = document.getElementById('monthlyReportBody');
            
            if (!reportData || reportData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">ÏÑ†ÌÉùÌïú Ï°∞Í±¥Ïóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                resetMonthlySummary();
                return;
            }
            
            let totalUsageCount = 0;
            let totalCashDeducted = 0;
            let totalPointsDeducted = 0;
            let totalRemainingCash = 0;
            let totalRemainingPoints = 0;
            
            let html = '';
            
            reportData.forEach(item => {
                const usageCount = item.usageCount || 0;
                const cashDeducted = item.cashDeducted || 0;
                const pointsDeducted = item.pointsDeducted || 0;
                const cashBalance = item.remainingCash || 0;
                const pointBalance = item.remainingPoints || 0;
                
                totalUsageCount += usageCount;
                totalCashDeducted += cashDeducted;
                totalPointsDeducted += pointsDeducted;
                totalRemainingCash += cashBalance;
                totalRemainingPoints += pointBalance;
                
                html += `
                    <tr>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${item.corporateName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px;">${item.employeeName || '-'}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: center;">${usageCount.toLocaleString()}</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashDeducted.toLocaleString()}Ïõê</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointsDeducted.toLocaleString()}P</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${cashBalance.toLocaleString()}Ïõê</td>
                        <td style="border: 1px solid #e0e0e0; padding: 12px; text-align: right;">${pointBalance.toLocaleString()}P</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Update summary
            document.getElementById('monthlyUsageCount').textContent = totalUsageCount.toLocaleString();
            document.getElementById('monthlyTotalCashDeducted').textContent = totalCashDeducted.toLocaleString() + 'Ïõê';
            document.getElementById('monthlyTotalPointsDeducted').textContent = totalPointsDeducted.toLocaleString() + 'P';
            document.getElementById('monthlyRemainingCash').textContent = totalRemainingCash.toLocaleString() + 'Ïõê';
            document.getElementById('monthlyRemainingPoints').textContent = totalRemainingPoints.toLocaleString() + 'P';
        }

        // Reset monthly summary
        function resetMonthlySummary() {
            document.getElementById('monthlyUsageCount').textContent = '0';
            document.getElementById('monthlyTotalCashDeducted').textContent = '0Ïõê';
            document.getElementById('monthlyTotalPointsDeducted').textContent = '0P';
            document.getElementById('monthlyRemainingCash').textContent = '0Ïõê';
            document.getElementById('monthlyRemainingPoints').textContent = '0P';
        }

        // Enhanced showSection function for management info
        const originalShowSection = showSection;
        showSection = function(sectionName) {
            originalShowSection.call(this, sectionName);
            
            if (sectionName === 'managementInfo') {
                // Set current month as default date range
                setCurrentMonth();
            }
        };

        // Add search input event listener
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchCorporates();
                    }
                });
            }
        });
    </script>
</body>
</html>